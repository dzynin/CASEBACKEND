{"ast":null,"code":"/* eslint-disable */\nimport { HelperMethods, ParagraphWidget, TableWidget, CONTROL_CHARACTERS, SectionBreakType, ListTextElementBox, ShapeElementBox, FootnoteElementBox, CommentElementBox, CommentCharacterElementBox, FieldElementBox, WCharacterFormat, ImageElementBox, WParagraphFormat, WTableFormat, WRowFormat, WCellFormat, WSectionFormat, listIdProperty, abstractListsProperty, listsProperty, abstractListIdProperty, nsidProperty } from '../../index';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { createElement } from '@syncfusion/ej2-base';\n/**\n * Module to handle collaborative editing.\n */\nvar CollaborativeEditingHandler = /** @class */function () {\n  function CollaborativeEditingHandler(documentEditor) {\n    //TODO need to prevent document change on collaborative editing session i.e. New document, select new document\n    //#region SignalR collabrative editing\n    this.version = 0;\n    this.userMap = {};\n    this.connectionId = '';\n    this.pendingOps = [];\n    this.commentsStart = [];\n    this.commentsEnd = [];\n    this.deletedComments = [];\n    this.serviceUrl = '';\n    this.isSyncServerChanges = false;\n    this.logEventEnabled = true;\n    this.message = '';\n    this.documentEditor = documentEditor;\n  }\n  ;\n  /**\n   * Get module name.\n   * @returns - Returns the module name\n   */\n  CollaborativeEditingHandler.prototype.getModuleName = function () {\n    return 'CollaborativeEditingHandler';\n  };\n  /**\n   * This function updates the room information and server url of the collaborative editing session.\n   * @param roomName - Specifies the current collaborative editing room name.\n   * @param version - Specifies the current version of the document.\n   * @param serviceUrl - Specifies the base url of the collaborative editing service.\n   */\n  CollaborativeEditingHandler.prototype.updateRoomInfo = function (roomName, version, serviceUrl) {\n    this.roomName = roomName;\n    this.serviceUrl = serviceUrl;\n    this.version = version;\n  };\n  /**\n   * Send the current action to the server.\n   * @param args - Specified the current action.\n   * @returns\n   */\n  CollaborativeEditingHandler.prototype.sendActionToServer = function (operations) {\n    if (!isNullOrUndefined(operations) && operations.length === 0) {\n      return;\n    }\n    var lastPendingOp = this.pendingOps[this.pendingOps.length - 1];\n    if (!lastPendingOp || !this.checkAndCombineOperation(lastPendingOp, operations)) {\n      this.pendingOps.push(operations);\n    }\n    if (!this.isAcknowledgePending()) {\n      this.sendLocalOperation();\n    }\n    this.transformRemoteCursor(this.connectionId, operations[0], operations[0].offset);\n  };\n  CollaborativeEditingHandler.prototype.checkAndCombineOperation = function (lastAction, currentAction) {\n    if (lastAction.length !== 1 || currentAction.length !== 1) {\n      return false;\n    }\n    var lastOperation = lastAction[0];\n    var currentOperation = currentAction[0];\n    if (this.isSameOperation(lastOperation, currentOperation) && this.canCombineOperation(lastOperation, currentOperation)) {\n      if (lastOperation.action === 'Insert' && lastOperation.offset + lastOperation.length === currentOperation.offset || lastOperation.action === 'Delete' && lastOperation.offset === currentOperation.offset) {\n        lastOperation.length += currentOperation.length;\n        lastOperation.text += currentOperation.text;\n        return true;\n      } else if (lastOperation.action === 'Delete' && currentOperation.offset + currentOperation.length === lastOperation.offset) {\n        lastOperation.text = currentOperation.text + lastOperation.text;\n        lastOperation.offset = currentOperation.offset;\n        lastOperation.length += currentOperation.length;\n        return true;\n      }\n    }\n    return false;\n  };\n  CollaborativeEditingHandler.prototype.canCombineOperation = function (lastOperation, currentOperation) {\n    return lastOperation.format === currentOperation.format && !this.isControlCharacter(lastOperation.text) && !this.isControlCharacter(currentOperation.text) && isNullOrUndefined(lastOperation.markerData) && isNullOrUndefined(currentOperation.markerData);\n  };\n  CollaborativeEditingHandler.prototype.isSameOperation = function (lastOperation, currentOperation) {\n    return lastOperation.action === currentOperation.action;\n  };\n  CollaborativeEditingHandler.prototype.isControlCharacter = function (text) {\n    var controlCharacters = [CONTROL_CHARACTERS.Table, CONTROL_CHARACTERS.Row, CONTROL_CHARACTERS.Cell, CONTROL_CHARACTERS.Image, CONTROL_CHARACTERS.PageBreak, CONTROL_CHARACTERS.ColumnBreak, CONTROL_CHARACTERS.Section_Break, CONTROL_CHARACTERS.Table, CONTROL_CHARACTERS.Field_Separator, CONTROL_CHARACTERS.Marker_Start, CONTROL_CHARACTERS.Marker_End, CONTROL_CHARACTERS.Tab, CONTROL_CHARACTERS.LineBreak];\n    return controlCharacters.indexOf(text) !== -1;\n  };\n  /**\n   * Apply the remote operation to the current document.\n   * @param action - Specifies the remote action type.\n   * @param data - Specifies the remote operation data.\n   */\n  CollaborativeEditingHandler.prototype.applyRemoteAction = function (action, data) {\n    switch (action) {\n      case 'connectionId':\n        this.connectionId = data;\n        break;\n      case 'removeUser':\n        this.removeCarets(data);\n        break;\n      case 'action':\n        this.dataReceived(data);\n        break;\n    }\n  };\n  CollaborativeEditingHandler.prototype.isAcknowledgePending = function () {\n    return !isNullOrUndefined(this.acknowledgmentPending);\n  };\n  CollaborativeEditingHandler.prototype.handleAcknowledgementReceived = function (action) {\n    var versionDiff = this.getVersionDifference(action);\n    if (versionDiff > 1) {\n      this.checkAndRetriveChangesFromServer();\n    } else {\n      this.logMessage('Ack received: ' + action.version);\n      this.logMessage('Ack version diff: ' + versionDiff);\n      if (action.version > this.version) {\n        this.updateVersion(action.version);\n        this.acknowledgementReceived();\n        this.sendLocalOperation();\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.updateVersion = function (version) {\n    if (version > this.version) {\n      this.version = version;\n    }\n  };\n  CollaborativeEditingHandler.prototype.acknowledgementReceived = function () {\n    this.acknowledgmentPending = undefined;\n  };\n  //Send the local operation to server\n  CollaborativeEditingHandler.prototype.sendLocalOperation = function () {\n    var _this = this;\n    if (this.pendingOps.length > 0) {\n      var operations = this.pendingOps.shift();\n      var changes = {};\n      changes.currentUser = this.documentEditor.currentUser;\n      changes.roomName = this.roomName;\n      changes.connectionId = this.connectionId;\n      changes.version = this.version;\n      changes.operations = operations;\n      this.acknowledgmentPending = operations;\n      var httpRequest = new XMLHttpRequest();\n      httpRequest.open('Post', this.serviceUrl + 'UpdateAction', true);\n      httpRequest.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n      this.setCustomAjaxHeaders(httpRequest);\n      httpRequest.onreadystatechange = function () {\n        if (httpRequest.readyState === 4) {\n          if (httpRequest.status === 200 || httpRequest.status === 304) {\n            var dataObject = JSON.parse(httpRequest.responseText);\n            if (!_this.isSyncServerChanges) {\n              _this.handleAcknowledgementReceived(dataObject);\n            }\n          } else {\n            alert('Failed to save the changes');\n          }\n        }\n      };\n      this.logMessage('Sent: ' + JSON.stringify(changes));\n      httpRequest.send(JSON.stringify(changes));\n    }\n  };\n  CollaborativeEditingHandler.prototype.dataReceived = function (action) {\n    if (action.connectionId === this.connectionId && !this.documentEditor.editorModule.isIncrementalSave || this.isSyncServerChanges) {\n      this.logMessage(this.isSyncServerChanges ? 'SignalR Server sync' + action.version : 'SignalR Same user sync:' + action.version);\n      return;\n    }\n    var versionDiff = this.getVersionDifference(action);\n    if (versionDiff <= 0 && !this.documentEditor.editorModule.isIncrementalSave) {\n      this.logMessage('SignalR return diff:<=0' + action.version);\n      return;\n    }\n    if (versionDiff > 1 && !this.documentEditor.editorModule.isIncrementalSave) {\n      this.logMessage('SignalR return diff:>=1' + action.version);\n      this.checkAndRetriveChangesFromServer();\n      return;\n    }\n    this.logMessage('SignalR ack: ' + action.version);\n    // try {\n    this.logMessage('Received: ' + JSON.stringify(action));\n    this.handleRemoteOperation(action);\n    // } catch (e) {\n    //     if (e instanceof Error) {\n    //         this.logMessage('Error while handling remote operation: ' + e);\n    //         this.logMessage('Error while handling remote operation: ' + e.stack);\n    //     } else {\n    //         this.logMessage('Error while handling remote operation: ' + e);\n    //     }\n    // }\n  };\n  CollaborativeEditingHandler.prototype.getVersionDifference = function (action) {\n    return action.version - this.version;\n  };\n  CollaborativeEditingHandler.prototype.handleRemoteOperation = function (action) {\n    //To Prevent the content change event while applying the remote operation\n    this.documentEditor.editorModule.isRemoteAction = true;\n    //TODO: Need to handle backward selection.\n    var localStartOffset = this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(this.documentEditor.selectionModule.start);\n    var selectionLength = this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(this.documentEditor.selectionModule.end) - localStartOffset;\n    if (!isNullOrUndefined(this.acknowledgmentPending)) {\n      this.logMessage('Acknowledge transform:' + this.acknowledgmentPending[0].text + 'version:' + action.version);\n      this.transform([this.acknowledgmentPending], action.operations);\n    }\n    if (this.pendingOps.length > 0) {\n      this.logMessage('Pending transform:' + this.pendingOps.length + 'version:' + action.version);\n    }\n    this.transform(this.pendingOps, action.operations);\n    this.applyRemoteOperation(action, localStartOffset, selectionLength);\n    this.updateVersion(action.version);\n    this.documentEditor.editorModule.isRemoteAction = false;\n    if (this.documentEditor.editorHistoryModule.canUndo()) {\n      this.documentEditor.editorHistoryModule.undoStack.length = 0;\n    }\n    if (this.documentEditor.editorHistoryModule.canRedo()) {\n      this.documentEditor.editorHistoryModule.redoStack.length = 0;\n    }\n  };\n  CollaborativeEditingHandler.prototype.transform = function (operation, remoteOperation) {\n    for (var i = 0; i < remoteOperation.length; i++) {\n      var remoteData = remoteOperation[i];\n      if (operation.length > 0) {\n        for (var j = 0; j < operation.length; j++) {\n          for (var k = 0; k < operation[j].length; k++) {\n            var localOperation = operation[j][k];\n            this.transformSelectionOperation(localOperation, remoteData);\n            var previousOffset = remoteData.offset;\n            this.transformOperation(localOperation, remoteData, remoteOperation);\n            this.logMessage('Transformed offset:' + (remoteData.offset - previousOffset));\n          }\n        }\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.skipAction = function (remoteOperation) {\n    for (var i = 0; i < remoteOperation.length; i++) {\n      var data = remoteOperation[i];\n      data.length = 0;\n      data.skipOperation = true;\n    }\n  };\n  CollaborativeEditingHandler.prototype.applyRemoteOperation = function (action, offset, selectionLength) {\n    var currentUser = this.documentEditor.currentUser;\n    var bookmarks = [];\n    var currentEditMode = this.documentEditor.commentReviewPane.commentPane.isEditMode;\n    var currenteditorHistory = this.documentEditor.editorHistoryModule.lastOperation;\n    var currentTextArea;\n    if (!isNullOrUndefined(this.documentEditor.commentReviewPane.commentPane.currentEditingComment)) {\n      currentTextArea = this.documentEditor.commentReviewPane.commentPane.currentEditingComment.textArea;\n    }\n    for (var i = 0; i < action.operations.length; i++) {\n      var markerData = action.operations[i].markerData;\n      var tableLength = undefined;\n      var trackingCurrentValue = this.documentEditor.enableTrackChanges;\n      if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.author)) {\n        this.documentEditor.currentUser = markerData.author;\n      }\n      if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.isSkipTracking) && markerData.isSkipTracking && this.documentEditor.enableTrackChanges) {\n        this.documentEditor.skipSettingsOps = true;\n        this.documentEditor.enableTrackChanges = false;\n      }\n      if (action.operations[i].skipOperation || !isNullOrUndefined(action.operations[i].markerData) && action.operations[i].markerData.skipOperation) {\n        continue;\n      }\n      if (action.operations[i].action === 'Update') {\n        if (!isNullOrUndefined(action.operations[i].styleData)) {\n          var styleData = JSON.parse(action.operations[i].styleData);\n          this.documentEditor.editor.updateStyleObject(styleData);\n        }\n        continue;\n      }\n      var startOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset, false, false, false);\n      // Code for Comparing the offset calculated using old approach and optimized approach\n      // this.documentEditor.selection.isNewApproach = true;\n      // let newStartOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset, false, false, false);\n      // this.documentEditor.selection.isNewApproach = false;\n      // throwCustomError(startOffset !== newStartOffset, \"New StartIndex \" + newStartOffset + \" and old StartIndex \" + startOffset + \" doesnot match\");\n      var op2 = action.operations[i];\n      var endOffset = startOffset;\n      if (isNullOrUndefined(action.operations[i].action)) {\n        this.documentSettings(action.operations[i]);\n        continue;\n      }\n      if (action.operations[i].action === 'Delete' || action.operations[i].action === 'Format') {\n        //Update endOffset\n        if (!(op2.action === 'Format' && op2.length === 0)) {\n          this.documentEditor.selectionModule.isEndOffset = true;\n        }\n        endOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset + action.operations[i].length, false, false, false);\n        this.documentEditor.selectionModule.isEndOffset = false;\n        // Code for Comparing the offset calculated using old approach and optimized approach\n        // this.documentEditor.selection.isNewApproach = true;\n        // let newEndOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset + action.operations[i].length, false, false, false);\n        // this.documentEditor.selection.isNewApproach = false;\n        // throwCustomError(endOffset !== newEndOffset, \"New EndIndex \" + newEndOffset + \" and old EndIndex \" + endOffset + \" doesnot match\");\n      }\n      if (op2.action === 'Insert' && op2.text !== CONTROL_CHARACTERS.Row && op2.text !== CONTROL_CHARACTERS.Cell && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n        this.documentEditor.selectionModule.select(startOffset, endOffset);\n      } else if (op2.action === 'Delete' && op2.text !== CONTROL_CHARACTERS.Cell && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n        this.documentEditor.selectionModule.select(startOffset, endOffset);\n      } else if (op2.action === 'Format' && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n        this.documentEditor.selectionModule.select(startOffset, endOffset);\n      }\n      if (!isNullOrUndefined(op2.markerData)) {\n        if (!isNullOrUndefined(op2.markerData.revisionForFootnoteEndnoteContent) || !isNullOrUndefined(op2.markerData.revisionId)) {\n          this.documentEditor.editorModule.revisionData = [];\n        }\n        if (!isNullOrUndefined(op2.markerData.revisionForFootnoteEndnoteContent)) {\n          this.documentEditor.editorModule.revisionData.push(op2.markerData.revisionForFootnoteEndnoteContent);\n        }\n        if (!isNullOrUndefined(op2.markerData.revisionId)) {\n          this.documentEditor.editorModule.revisionData.push(op2.markerData);\n        }\n        if (!isNullOrUndefined(op2.markerData.splittedRevisions) && op2.markerData.splittedRevisions.length > 0) {\n          this.documentEditor.editorModule.revisionData = this.documentEditor.editorModule.revisionData.concat(op2.markerData.splittedRevisions);\n        }\n      }\n      if (!isNullOrUndefined(op2.markerData) && !isNullOrUndefined(op2.markerData.isAcceptOrReject) && op2.markerData.isAcceptOrReject !== '') {\n        var revision = this.documentEditor.editorModule.getRevision(op2.markerData.revisionId);\n        if (revision) {\n          if (op2.markerData.isAcceptOrReject === 'Accept') {\n            revision.accept();\n          } else if (op2.markerData.isAcceptOrReject === 'Reject') {\n            revision.reject();\n          }\n        }\n        continue;\n      }\n      if (op2.action === 'Insert') {\n        if (op2.type === 'Paste') {\n          this.documentEditor.editorModule.isPasteListUpdated = false;\n          this.documentEditor.editorModule.pasteContents(HelperMethods.getSfdtDocument(op2.pasteContent));\n        } else if (op2.type === 'PasteToc') {\n          this.documentEditor.editorModule.isInsertingTOC = true;\n          this.documentEditor.editorModule.pasteContents(HelperMethods.getSfdtDocument(op2.pasteContent));\n          this.documentEditor.editorModule.isInsertingTOC = false;\n        } else if (op2.text === CONTROL_CHARACTERS.Image.toString()) {\n          this.insertImage(op2.imageData);\n        } else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'NewPage') {\n          this.documentEditor.editorModule.insertSectionBreak();\n        } else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'Continuous') {\n          this.documentEditor.editorModule.insertSectionBreak(SectionBreakType.Continuous);\n        } else if (markerData && (op2.text === CONTROL_CHARACTERS.Marker_Start || op2.text === CONTROL_CHARACTERS.Marker_End || op2.text === CONTROL_CHARACTERS.Field_Separator)) {\n          var element = void 0;\n          if (markerData.type && markerData.type === 'Bookmark') {\n            if (op2.text === CONTROL_CHARACTERS.Marker_Start) {\n              bookmarks = this.documentEditor.editorModule.createBookmarkElements(markerData.bookmarkName);\n              element = bookmarks[0];\n              this.documentEditor.documentHelper.isBookmarkInserted = false;\n              this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n            } else {\n              var bookmark = bookmarks[0];\n              if (bookmark) {\n                element = bookmark.reference;\n                this.documentEditor.documentHelper.isBookmarkInserted = true;\n                this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n                this.documentEditor.selectionModule.selectBookmark(markerData.bookmarkName);\n                bookmark.properties = this.documentEditor.selectionModule.getBookmarkProperties(bookmark);\n                element.properties = this.documentEditor.selectionModule.getBookmarkProperties(element);\n              }\n            }\n          } else if (markerData.type && markerData.type === 'EditRange') {\n            var user = markerData.user;\n            var id = markerData.editRangeId;\n            if (op2.text === CONTROL_CHARACTERS.Marker_Start) {\n              if (this.documentEditor.documentHelper.restrictEditingPane) {\n                this.documentEditor.documentHelper.restrictEditingPane.addUserDialog.bindListData(user);\n              }\n              element = this.documentEditor.editorModule.addEditElement(user, id);\n              element.columnFirst = parseInt(markerData.columnFirst);\n              element.columnLast = parseInt(markerData.columnLast);\n              element.line = this.documentEditor.selectionModule.start.currentWidget;\n            } else {\n              var editRanges = this.documentEditor.documentHelper.editRanges.get(user);\n              for (var _i = 0, editRanges_1 = editRanges; _i < editRanges_1.length; _i++) {\n                var editStart = editRanges_1[_i];\n                if (editStart.editRangeId === id) {\n                  element = editStart.editRangeEnd;\n                  element.line = this.documentEditor.selectionModule.start.currentWidget;\n                  break;\n                }\n              }\n            }\n            this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n            this.documentEditor.editorModule.fireContentChange();\n          } else if (markerData.type && markerData.type === 'Field') {\n            this.documentEditor.editor.isFieldOperation = true;\n            var type = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : op2.text === CONTROL_CHARACTERS.Marker_End ? 1 : op2.text === CONTROL_CHARACTERS.Field_Separator ? 2 : undefined;\n            if (!isNullOrUndefined(type) && isNullOrUndefined(markerData.checkBoxValue)) {\n              var field = new FieldElementBox(type);\n              if (type === 0 && !isNullOrUndefined(markerData.formFieldData)) {\n                var formFieldData = this.documentEditor.editorModule.getFormFieldData(op2.type);\n                this.documentEditor.parser.parseFormFieldData(0, JSON.parse(markerData.formFieldData), formFieldData);\n                field.formFieldData = formFieldData;\n              }\n              var characterFormat = new WCharacterFormat();\n              if (op2.format) {\n                var data_1 = JSON.parse(op2.format);\n                this.documentEditor.parser.parseCharacterFormat(0, data_1, characterFormat);\n              }\n              field.characterFormat.copyFormat(characterFormat);\n              this.documentEditor.editorModule.initInsertInline(field);\n            } else {\n              var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n              var inline = inlineObj.element;\n              if (inline instanceof FieldElementBox) {\n                this.documentEditor.editorModule.toggleCheckBoxFormField(inline, true, markerData.checkBoxValue);\n              }\n            }\n          } else if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.commentId)) {\n            var commentType = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : 1;\n            var deleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.deletedComments, markerData.commentId);\n            var ownerDeleteComment = undefined;\n            if (isNullOrUndefined(deleteComment)) {\n              deleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.documentEditor.documentHelper.comments, markerData.commentId);\n              if (isNullOrUndefined(deleteComment) && !isNullOrUndefined(markerData.ownerCommentId)) {\n                ownerDeleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.documentEditor.documentHelper.comments, markerData.ownerCommentId);\n                deleteComment = this.documentEditor.documentHelper.layout.getCommentById(ownerDeleteComment.replyComments, markerData.commentId);\n              }\n            }\n            if (!isNullOrUndefined(deleteComment)) {\n              var item = new CommentCharacterElementBox(commentType);\n              item.commentId = markerData.commentId;\n              this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [item]);\n              item.comment = deleteComment;\n              var index = this.documentEditor.selectionModule.start.currentWidget.children.indexOf(item);\n              deleteComment.commentStart = this.documentEditor.selectionModule.start.currentWidget.children[index];\n            } else {\n              var item = new CommentCharacterElementBox(commentType);\n              item.commentId = markerData.commentId;\n              this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [item]);\n              commentType === 0 ? this.commentsStart.push(item) : this.commentsEnd.push(item);\n            }\n          } else if (!isNullOrUndefined(op2.markerData.type) && (op2.markerData.type === 'Footnote' || op2.markerData.type === 'Endnote')) {\n            if (op2.markerData.type === 'Footnote') {\n              this.documentEditor.editorModule.insertFootnote();\n            } else if (op2.markerData.type === 'Endnote') {\n              this.documentEditor.editorModule.insertEndnote();\n            }\n          }\n        } else if (markerData && !isNullOrUndefined(markerData.dropDownIndex) && op2.type === 'DropDown') {\n          var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n          var inline = inlineObj.element;\n          if (inline instanceof FieldElementBox) {\n            this.documentEditor.editorModule.updateFormField(inline, markerData.dropDownIndex, false);\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'NewPage') {\n          this.documentEditor.editorModule.insertSectionBreak();\n        } else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'Continuous') {\n          this.documentEditor.editorModule.insertSectionBreak(SectionBreakType.Continuous);\n        } else if (op2.text === CONTROL_CHARACTERS.Table) {\n          i = action.operations.length;\n          this.buildTable(action.operations);\n          tableLength = this.getOperationLength(action.operations);\n        } else if (op2.text === CONTROL_CHARACTERS.Row) {\n          i = action.operations.length;\n          if (isNullOrUndefined(op2.format)) {\n            action.operations.reverse();\n          }\n          this.buildRow(action.operations);\n          tableLength = this.getOperationLength(action.operations);\n        } else if (op2.text === CONTROL_CHARACTERS.Cell) {\n          var paraFormat = undefined;\n          var charFormat = undefined;\n          if (op2.type === 'CellFormat') {\n            if (op2.length > 0) {\n              paraFormat = action.operations[i - 1].format;\n              charFormat = action.operations[i - 2].format;\n            }\n            this.buildCell(op2, paraFormat, charFormat);\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.PageBreak.toString()) {\n          this.documentEditor.editorModule.insertPageBreak();\n        } else if (op2.text === CONTROL_CHARACTERS.ColumnBreak.toString()) {\n          this.documentEditor.editorModule.insertColumnBreak();\n        } else {\n          if (op2.format) {\n            var characterFormat = new WCharacterFormat();\n            var data = JSON.parse(op2.format);\n            this.documentEditor.parser.parseCharacterFormat(0, data, characterFormat);\n            this.documentEditor.selectionModule.characterFormat.copyFormat(characterFormat);\n          }\n          this.documentEditor.editorModule.insertText(op2.text);\n        }\n      } else if (op2.action === 'Delete') {\n        // if (this.documentEditor.selection.isEmpty && this.documentEditor.selection.start.currentWidget.isLastLine()\n        //     && this.documentEditor.selection.start.offset === this.documentEditor.selection.getLineLength(this.documentEditor.selection.start.currentWidget) + 1) {\n        //     this.documentEditor.selection.start.offset--;\n        //     this.documentEditor.selection.end.offset--;\n        //     //Delete pargaraph marker\n        //     this.documentEditor.editor.delete();\n        // } else {\n        if (op2.text === CONTROL_CHARACTERS.Marker_Start || op2.text === CONTROL_CHARACTERS.Marker_End) {\n          if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.commentId)) {\n            var selection = this.documentEditor.selectionModule;\n            var commentType = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : 1;\n            var deleteComment = void 0;\n            if (this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element instanceof CommentCharacterElementBox) {\n              deleteComment = this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element;\n            }\n            if (commentType === 1) {\n              var commentEnd = deleteComment;\n              if (commentEnd.indexInOwner !== -1) {\n                this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, selection.start.offset);\n              }\n            } else {\n              var commentStart = deleteComment;\n              if (commentStart.indexInOwner !== -1) {\n                this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, selection.start.offset);\n              }\n              commentStart.removeCommentMark();\n            }\n          } else {\n            var selection = this.documentEditor.selectionModule;\n            var offset_1 = selection.start.offset - 1;\n            this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, offset_1);\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.Cell) {\n          this.buildDeleteCells(op2);\n        } else {\n          this.documentEditor.editorModule.onBackSpace();\n        }\n        //}\n      } else if (op2.action === 'Format') {\n        if (op2.text === CONTROL_CHARACTERS.Marker_Start.toString() + CONTROL_CHARACTERS.Marker_End.toString()) {\n          this.updateOperation(op2);\n        } else if (!isNullOrUndefined(op2.markerData) && !isNullOrUndefined(op2.markerData.revisionId)) {\n          if (!isNullOrUndefined(op2.markerData.revisionType)) {\n            if (op2.markerData.revisionType === 'Deletion') {\n              if (op2.text === CONTROL_CHARACTERS.Row) {\n                var data_2 = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n                if (!isNullOrUndefined(data_2.rowWidget)) {\n                  var row = data_2.rowWidget;\n                  this.documentEditor.editorModule.trackRowDeletion(row);\n                  this.documentEditor.trackChangesPane.updateTrackChanges();\n                  continue;\n                }\n              }\n              this.documentEditor.editorModule.onBackSpace();\n            }\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.Row) {\n          var data_3 = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n          if (!isNullOrUndefined(data_3.rowWidget)) {\n            var table = data_3.rowWidget.ownerTable;\n            var rowData = JSON.parse(op2.format);\n            this.documentEditor.documentHelper.owner.parser.parseRowFormat(rowData, data_3.rowWidget.rowFormat, 0);\n            table.calculateGrid(false);\n            this.documentEditor.documentHelper.layout.reLayoutTable(table);\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.Cell) {\n          if (op2.type === 'TableFormat') {\n            var tableData = this.getRelativePositionFromAbsolutePosition(op2.offset, true, false, false);\n            var table = JSON.parse(op2.format);\n            this.documentEditor.documentHelper.owner.parser.parseTableFormat(table, tableData.tableWidget.tableFormat, 0);\n            tableData.tableWidget.calculateGrid(false);\n            this.documentEditor.documentHelper.layout.reLayoutTable(tableData.tableWidget);\n          }\n          if (op2.type === 'RowFormat') {\n            var rowData = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n            var row = JSON.parse(op2.format);\n            this.documentEditor.documentHelper.owner.parser.parseRowFormat(row, rowData.rowWidget.rowFormat, 0);\n          }\n          if (op2.type === 'CellFormat') {\n            var cellData = this.getRelativePositionFromAbsolutePosition(op2.offset, false, false, true);\n            var cell = JSON.parse(op2.format);\n            this.documentEditor.documentHelper.owner.parser.parseCellFormat(cell, cellData.cellWidget.cellFormat, 0);\n          }\n        } else if (op2.text === CONTROL_CHARACTERS.Image) {\n          var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n          var inline = inlineObj.element;\n          if (inline instanceof ImageElementBox) {\n            this.documentEditor.editorModule.onImageFormat(inline, HelperMethods.convertPointToPixel(op2.imageData.width), HelperMethods.convertPointToPixel(op2.imageData.height), op2.imageData.alternativeText);\n          }\n        } else if (op2.type === 'ListFormat') {\n          var paragraphFormat = JSON.parse(op2.format);\n          var format = new WParagraphFormat(undefined);\n          this.documentEditor.parser.parseParagraphFormat(0, paragraphFormat, format);\n          this.updateList(op2, format);\n          var list = this.documentEditor.documentHelper.getListById(paragraphFormat.listFormat.nsid, true);\n          if (!isNullOrUndefined(list)) {\n            format.listFormat.listId = list.listId;\n            format.listFormat.list = list;\n          }\n          this.documentEditor.editorModule.onApplyParagraphFormat(op2.text, format.listFormat, false, false);\n        } else if (op2.type === 'RestartNumbering') {\n          var nsid = this.updateList(op2);\n          var list = this.documentEditor.documentHelper.getListById(nsid, true);\n          this.documentEditor.editorModule.restartListAtInternal(this.documentEditor.selectionModule, list.listId, list.nsid);\n        } else if (op2.type === 'ContinueNumbering') {\n          var paragraphFormat = JSON.parse(op2.format);\n          var format = new WParagraphFormat(undefined);\n          this.documentEditor.parser.parseParagraphFormat(0, paragraphFormat, format);\n          var list = this.documentEditor.documentHelper.getListById(format.listFormat.nsid, true);\n          if (!isNullOrUndefined(list)) {\n            format.listFormat.listId = list.listId;\n            format.listFormat.list = list;\n          }\n          this.documentEditor.editorModule.applyContinueNumberingInternal(this.documentEditor.selectionModule, format);\n        } else if (op2.type === 'CharacterFormat') {\n          this.insertCharaterFormat(op2.type, op2.format);\n        } else if (op2.type === 'ParagraphFormat') {\n          this.insertParagraphFormat(op2, op2.format);\n        } else if (op2.type === 'TableFormat') {\n          this.insertTableFormat(op2.text, op2.format, op2.offset);\n        } else if (op2.type === 'SectionFormat') {\n          this.insertSectionFormat(op2.text, op2.format);\n        } else if (op2.type === 'RowFormat') {\n          this.insertRowFormat(op2.text, op2.format);\n        } else if (op2.type === 'CellFormat') {\n          this.insertCellFormat(op2.format);\n        }\n      }\n      this.documentEditor.editorModule.revisionData = undefined;\n      if (this.documentEditor.enableTrackChanges != trackingCurrentValue) {\n        this.documentEditor.skipSettingsOps = true;\n        this.documentEditor.enableTrackChanges = trackingCurrentValue;\n      }\n      this.documentEditor.currentUser = currentUser;\n      var newOffset = this.documentEditor.selectionModule.startOffset;\n      //op2.offset = newOffset;\n      this.updateRemoteSelection(action, this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(newOffset));\n      if (!isNullOrUndefined(tableLength)) {\n        var temp = op2.length;\n        op2.length = tableLength;\n        tableLength = temp;\n      }\n      var tranformedOffset = this.transformSection(op2.action, op2, offset)[1];\n      //TODO: Need to handle backward selection.\n      //TODO: Need to optimize the code. Need to transform selection end length based on remove content\n      var tranformedEndOffset = this.transformSection(op2.action, op2, offset + selectionLength)[1];\n      offset = tranformedOffset;\n      this.documentEditor.selectionModule.select(this.getRelativePositionFromAbsolutePosition(tranformedOffset, false, false, false), this.getRelativePositionFromAbsolutePosition(tranformedEndOffset, false, false, false));\n      if (!isNullOrUndefined(tableLength)) {\n        op2.length = tableLength;\n      }\n      this.transformRemoteCursor(action.connectionId, op2, op2.offset);\n      if (!isNullOrUndefined(this.documentEditor.searchModule) && !isNullOrUndefined(this.documentEditor.optionsPaneModule) && this.documentEditor.searchModule.searchResults.length > 0 && this.documentEditor.optionsPaneModule.isOptionsPaneShow) {\n        this.documentEditor.optionsPaneModule.searchIconClickInternal();\n      }\n    }\n    if (this.documentEditor.editor.isFieldOperation) {\n      this.documentEditor.editorModule.layoutWholeDocument();\n      this.documentEditor.editor.isFieldOperation = false;\n    }\n    if (!isNullOrUndefined(this.rowWidget)) {\n      var ownerTable = this.rowWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n      ownerTable.updateRowIndex(0);\n      ownerTable.calculateGrid(true);\n      this.documentEditor.documentHelper.layout.reLayoutTable(ownerTable);\n      this.documentEditor.editorModule.reLayout(this.documentEditor.selectionModule);\n      this.rowWidget = undefined;\n    }\n    if (!isNullOrUndefined(this.table)) {\n      this.table.calculateGrid();\n      this.documentEditor.editorModule.updateTable(this.table);\n      this.documentEditor.editorModule.reLayout(this.documentEditor.selectionModule, true);\n      this.table = undefined;\n    }\n    this.documentEditor.currentUser = currentUser;\n    this.documentEditor.commentReviewPane.commentPane.isEditMode = currentEditMode;\n    this.documentEditor.editorHistoryModule.lastOperation = currenteditorHistory;\n    if (!isNullOrUndefined(this.documentEditor.commentReviewPane.commentPane.currentEditingComment)) {\n      this.documentEditor.commentReviewPane.commentPane.currentEditingComment.textArea = currentTextArea;\n    }\n  };\n  CollaborativeEditingHandler.prototype.updateOperation = function (operation) {\n    var markerData = operation.markerData;\n    if (operation.text === CONTROL_CHARACTERS.Marker_Start.toString() + CONTROL_CHARACTERS.Marker_End.toString()) {\n      var ownerComment = undefined;\n      var commentToDelete = undefined;\n      if (this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element instanceof CommentCharacterElementBox && operation.offset > 0) {\n        var commentID = this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element.commentId;\n        commentToDelete = this.getComment(commentID);\n      }\n      if (!isNullOrUndefined(commentToDelete) && !(!isNullOrUndefined(markerData.done) && isNullOrUndefined(markerData.date)) && isNullOrUndefined(markerData.isReply)) {\n        if (commentToDelete.text !== markerData.text) {\n          var commentView = this.documentEditor.commentReviewPane.commentPane.comments.get(commentToDelete);\n          commentView.commentText.innerText = markerData.text;\n          commentToDelete.text = markerData.text;\n          return;\n        }\n      }\n      if (!isNullOrUndefined(commentToDelete)) {\n        if (!isNullOrUndefined(markerData.done) && isNullOrUndefined(markerData.commentAction)) {\n          if (markerData.done) {\n            this.documentEditor.editorModule.resolveComment(commentToDelete);\n          } else {\n            this.documentEditor.editorModule.reopenComment(commentToDelete);\n          }\n          return;\n        }\n        if (markerData.commentAction === \"remove\") {\n          var commentView = this.documentEditor.commentReviewPane.commentPane.comments.get(!isNullOrUndefined(ownerComment) ? ownerComment : commentToDelete);\n          commentView.showDrawer();\n          this.documentEditor.editorModule.deleteCommentWidget(commentToDelete);\n          this.deletedComments.push(commentToDelete);\n          commentView.hideDrawer();\n        } else {\n          var item = new CommentElementBox(markerData.date);\n          item.commentId = markerData.commentId;\n          var commentStart = this.getObjectByCommentId(this.commentsStart, item.commentId);\n          var commentEnd = this.getObjectByCommentId(this.commentsEnd, item.commentId);\n          if (!isNullOrUndefined(commentStart) && !isNullOrUndefined(commentEnd)) {\n            this.documentEditor.editorModule.updateCommentElement(item, commentStart, commentEnd, markerData);\n            item.ownerComment = commentToDelete;\n            commentToDelete.replyComments.splice(markerData.commentIndex, 0, item);\n            this.documentEditor.commentReviewPane.addReply(item, false, false);\n          }\n        }\n      } else {\n        var item = new CommentElementBox(markerData.date);\n        item.commentId = markerData.commentId;\n        var commentStart = this.getObjectByCommentId(this.commentsStart, item.commentId);\n        var commentEnd = this.getObjectByCommentId(this.commentsEnd, item.commentId);\n        if (!isNullOrUndefined(commentStart) && !isNullOrUndefined(commentEnd)) {\n          this.documentEditor.editorModule.updateCommentElement(item, commentStart, commentEnd, markerData);\n          this.documentEditor.editorModule.addCommentWidget(item, true, true, false);\n          this.commentsStart.splice(this.commentsStart.indexOf(commentStart), 1);\n          this.commentsEnd.splice(this.commentsEnd.indexOf(commentEnd), 1);\n          var comment = this.documentEditor.commentReviewPane.commentPane.comments.get(item);\n          comment.postComment();\n        }\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.getComment = function (commentID) {\n    var collection = this.documentEditor.documentHelper.comments;\n    for (var i = 0; i < collection.length; i++) {\n      var comment = this.documentEditor.documentHelper.layout.getCommentById(collection, commentID);\n      if (isNullOrUndefined(comment)) {\n        for (var j = 0; j < collection[i].replyComments.length; j++) {\n          var replyComment = this.documentEditor.documentHelper.layout.getCommentById(collection[i].replyComments, commentID);\n          if (!isNullOrUndefined(replyComment)) {\n            return replyComment;\n          }\n        }\n      } else {\n        return comment;\n      }\n    }\n    return null;\n  };\n  CollaborativeEditingHandler.prototype.updateList = function (operation, format) {\n    var nsid = -1;\n    if (operation.listData) {\n      var listData = JSON.parse(operation.listData);\n      if (listData.hasOwnProperty('optimizeSfdt')) {\n        this.documentEditor.parser.keywordIndex = listData.optimizeSfdt ? 1 : 0;\n      }\n      if (!isNullOrUndefined(format)) {\n        var list = this.documentEditor.documentHelper.getListById(format.listFormat.nsid, true);\n        if (isNullOrUndefined(list)) {\n          this.updateListCollection(listData, this.documentEditor.parser.keywordIndex);\n        } else {\n          var abstractLists = [];\n          this.documentEditor.parser.parseAbstractList(listData, abstractLists);\n          if (!isNullOrUndefined(list.abstractList)) {\n            if (list.abstractList.levels.length < format.listFormat.listLevelNumber) {\n              list.abstractList.levels = [];\n              for (var i = 0; i < abstractLists[0].levels.length; i++) {\n                list.abstractList.levels.push(abstractLists[0].levels[i]);\n              }\n            }\n          }\n        }\n      } else {\n        if (listData.hasOwnProperty(nsidProperty)) {\n          nsid = listData[nsidProperty];\n        }\n        this.updateListCollection(listData, this.documentEditor.parser.keywordIndex);\n      }\n    }\n    return nsid;\n  };\n  CollaborativeEditingHandler.prototype.getOperationLength = function (operations) {\n    var length = 0;\n    for (var i = 0; i < operations.length; i++) {\n      if (operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Table || operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Row || operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Cell) length += operations[parseInt(i.toString(), 10)].length;\n    }\n    return length;\n  };\n  CollaborativeEditingHandler.prototype.updateListCollection = function (listData, keywordIndex) {\n    var uniqueListId = this.documentEditor.editorModule.getUniqueListOrAbstractListId(true);\n    var uniqueAbsLstId = this.documentEditor.editorModule.getUniqueListOrAbstractListId(false);\n    var _loop_1 = function (k) {\n      var list = listData[listsProperty[keywordIndex]][k];\n      var abstractList = listData[abstractListsProperty[keywordIndex]].filter(function (obj) {\n        return obj[abstractListIdProperty[keywordIndex]] === list[abstractListIdProperty[keywordIndex]];\n      })[0];\n      if (!isNullOrUndefined(abstractList)) {\n        abstractList[abstractListIdProperty[keywordIndex]] = uniqueAbsLstId;\n        list[listIdProperty[keywordIndex]] = uniqueListId;\n        list[abstractListIdProperty[keywordIndex]] = uniqueAbsLstId;\n        uniqueListId++;\n        uniqueAbsLstId++;\n      }\n    };\n    for (var k = 0; k < listData[listsProperty[keywordIndex]].length; k++) {\n      _loop_1(k);\n    }\n    this.documentEditor.parser.parseAbstractList(listData, this.documentEditor.documentHelper.abstractLists);\n    this.documentEditor.parser.parseList(listData, this.documentEditor.documentHelper.lists);\n  };\n  CollaborativeEditingHandler.prototype.getObjectByCommentId = function (collection, commentId) {\n    for (var _i = 0, collection_1 = collection; _i < collection_1.length; _i++) {\n      var obj = collection_1[_i];\n      if (obj.commentId === commentId) {\n        return obj;\n      }\n    }\n    return undefined;\n  };\n  CollaborativeEditingHandler.prototype.transformOperation = function (operation1, operation2, action) {\n    if (operation1.action === 'Insert' && (operation2.action === 'Insert' || operation2.action === 'Format')) {\n      if (operation1.offset < operation2.offset) {\n        operation2.offset = operation2.offset + operation1.length;\n        return [operation1, operation2];\n      } else if (operation1.offset >= operation2.offset && operation2.action !== 'Format') {\n        operation1.offset = operation1.offset + operation2.length;\n        return [operation1, operation2];\n      }\n    } else if (operation1.action === 'Delete' && (operation2.action === 'Delete' || operation2.action === 'Format')) {\n      if (operation1.offset < operation2.offset) {\n        operation2.offset = operation2.offset - operation1.length;\n        return [operation1, operation2];\n      } else if (operation1.offset > operation2.offset && operation2.action !== 'Format') {\n        operation1.offset = operation1.offset - operation2.length;\n        return [operation1, operation2];\n      }\n    } else if (operation1.action === 'Insert' && (operation2.action === 'Delete' || operation2.action === 'Format')) {\n      if (operation1.offset <= operation2.offset) {\n        operation2.offset = operation2.offset + operation1.length;\n        return [operation1, operation2];\n      } else if (operation1.offset >= operation2.offset + operation2.length && operation2.action !== 'Format') {\n        operation1.offset = operation1.offset - operation2.length;\n        return [operation1, operation2];\n      }\n      // Local selection fully encompasses the conflicting selection\n      else if (operation1.offset > operation2.offset && operation1.offset < operation2.offset + operation2.length) {\n        operation2.length += operation1.length;\n      }\n    } else if (operation1.action === 'Delete' && (operation2.action === 'Insert' || operation2.action === 'Format')) {\n      if (operation1.offset <= operation2.offset && operation1.offset + operation1.length <= operation2.offset) {\n        operation2.offset = operation2.offset - operation1.length;\n      } else if (operation1.offset < operation2.offset && operation1.offset + operation1.length >= operation2.offset + operation2.length) {\n        if (!isNullOrUndefined(operation2.markerData) && !isNullOrUndefined(operation2.markerData.type) && operation2.markerData.type !== 'Field' && (operation2.text === CONTROL_CHARACTERS.Marker_End || operation2.text === CONTROL_CHARACTERS.Marker_Start)) {\n          if (!isNullOrUndefined(operation2.markerData.commentId) && operation2.text === CONTROL_CHARACTERS.Marker_End) {\n            this.skipAction(action);\n            return [operation1, operation2];\n          }\n          var conflictLenth = operation2.offset - operation1.offset;\n          operation2.offset -= conflictLenth;\n        } else {\n          //Skip insert operation\n          operation2.length = 0;\n          operation2.skipOperation = true;\n          if (!isNullOrUndefined(operation2.markerData) && !isNullOrUndefined(operation2.markerData.type) && operation2.markerData.type === 'Field' && (operation2.text === CONTROL_CHARACTERS.Marker_Start || operation2.text === CONTROL_CHARACTERS.Marker_End)) {\n            this.skipAction(action);\n          }\n        }\n      } else if (operation1.offset <= operation2.offset && operation2.action == \"Insert\" && operation1.offset + operation1.length >= operation2.offset) {\n        this.skipAction(action);\n      } else if (operation1.offset > operation2.offset && operation2.action !== 'Format') {\n        operation1.offset = operation1.offset + operation2.length;\n      }\n    }\n    // else {\n    //     throw new Error(`Invalid operation types: ${operation1.action}, ${operation2.action}`);\n    // }\n    return [operation1, operation2];\n  };\n  CollaborativeEditingHandler.prototype.transformSection = function (action, operation1, operation2) {\n    if (action === 'Insert') {\n      if (operation1.offset < operation2) {\n        return [operation1.offset, operation2 + operation1.length];\n      }\n      // else if (operation1.offset > operation2.offset) {\n      //     return [\n      //         operation1.offset + operation2.length,\n      //         operation2.offset,\n      //     ];\n      // }\n    } else if (action === 'Delete') {\n      if (operation1.offset <= operation2) {\n        return [operation1.offset, operation2 - operation1.length];\n      }\n    }\n    return [operation1.offset, operation2];\n  };\n  CollaborativeEditingHandler.prototype.transformRemoteCursor = function (connectionId, operation, offset) {\n    if (this.documentEditor.editorModule.isIncrementalSave) {\n      return;\n    }\n    this.updateCaretPosition(connectionId, operation);\n  };\n  /**\n   * @private\n   * @returns {void}\n  */\n  CollaborativeEditingHandler.prototype.updateCaretPosition = function (connectionId, operation) {\n    var keys = Object.keys(this.userMap);\n    var tranformedOffset;\n    //For loop to iterate over the keys\n    for (var i = 0; i < keys.length; i++) {\n      var key = keys[i];\n      if (key === connectionId) {\n        continue;\n      }\n      if (!isNullOrUndefined(operation)) {\n        var remoteOffset = this.userMap[key].offset;\n        tranformedOffset = this.transformSection(operation.action, operation, remoteOffset)[1];\n        this.userMap[key].offset = tranformedOffset;\n      } else {\n        tranformedOffset = this.userMap[key].offset;\n      }\n      this.updateCaretPositionInteral(this.userMap[key].caret, tranformedOffset);\n    }\n  };\n  CollaborativeEditingHandler.prototype.updateRemoteSelection = function (data, removeOffset) {\n    if (this.documentEditor.editorModule.isIncrementalSave) {\n      return;\n    }\n    if (data.connectionId) {\n      var color = '';\n      var caret = void 0;\n      if (this.userMap[data.connectionId] !== undefined) {\n        color = this.userMap[data.connectionId].color;\n        caret = this.userMap[data.connectionId].caret;\n      } else {\n        color = this.getColorForMember(Math.random() * 100);\n        caret = createElement('div', {\n          className: 'e-de-blink-cursor',\n          styles: 'position:absolute;border-left: 2px solid ' + color\n        });\n        this.userMap[data.connectionId] = new CaretInfo(color, caret, removeOffset, data.currentUser);\n      }\n      this.userMap[data.connectionId].offset = removeOffset;\n      this.updateCaretPositionInteral(caret, removeOffset);\n    }\n  };\n  CollaborativeEditingHandler.prototype.removeCarets = function (connectionId) {\n    if (this.userMap[connectionId] !== undefined) {\n      this.userMap[connectionId].caret.remove();\n      delete this.userMap[connectionId];\n    }\n  };\n  CollaborativeEditingHandler.prototype.getColorForMember = function (randonNumber) {\n    var colorValue = randonNumber % 20;\n    return \"hsl(\" + colorValue * 360 / 7 % 360 + \", 100%, 35%)\";\n  };\n  CollaborativeEditingHandler.prototype.updateCaretPositionInteral = function (caret, start) {\n    var zoomFactor = this.documentEditor.zoomFactor;\n    var selection = this.documentEditor.selectionModule;\n    var startPos = selection.getTextPosBasedOnLogicalIndex(this.getRelativePositionFromAbsolutePosition(start, false, false, false));\n    //let endPos: TextPosition = selection.getTextPosBasedOnLogicalIndex(end);\n    var caretPosition = startPos.location;\n    //if (startPos.isInSameParagraph(endPos)) {\n    caret.style.display = 'block';\n    if (!caret.parentElement) {\n      this.documentEditor.documentHelper.viewerContainer.appendChild(caret);\n    }\n    var page = selection.getSelectionPage(startPos);\n    if (page) {\n      caret.style.left = page.boundingRectangle.x + Math.round(caretPosition.x) * zoomFactor + 'px';\n      var caretInfo = selection.updateCaretSize(startPos);\n      var topMargin = caretInfo.topMargin;\n      caret.style.height = caretInfo.height * zoomFactor + 'px';\n      var pageTop = selection.getPageTop(page);\n      caret.style.top = pageTop + Math.round(caretPosition.y + topMargin) * zoomFactor + 'px';\n      if (selection.characterFormat.baselineAlignment === 'Subscript') {\n        caret.style.top = parseFloat(caret.style.top) + parseFloat(caret.style.height) / 2 + 'px';\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.getBlockPosition = function (offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted) {\n    var paragraph;\n    if (block instanceof ParagraphWidget) {\n      // let paraLength: number = block.length;\n      // Code for Comparing the offset calculated using old approach and optimized approach\n      // if (this.documentEditor.selection.getParagraphLength(block) + 1 == block.length && currentLength + paraLength < offset && currentLength + paraLength + 1 < offset && this.documentEditor.selection.isNewApproach) {\n      //     currentLength += paraLength;\n      // } else {\n      var absoluteData = this.getBlockTotalLength(offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted);\n      // length = block.getTotalLength() + 1;\n      // paragraph = block;\n      if (completed.done) {\n        completed.done = true;\n        return absoluteData;\n      } else {\n        //Add paragraph mark length\n        currentLength = absoluteData.currentLength;\n        offset = absoluteData.offset;\n        paragraph = absoluteData.paragraph;\n      }\n      // }\n    } else if (block instanceof TableWidget) {\n      // Table start mark length\n      offset -= 1;\n      if (offset === currentLength) {\n        if (isTableInserted || this.documentEditor.selectionModule.isEndOffset) {\n          completed.done = true;\n          return {\n            'offset': offset,\n            'currentLength': currentLength,\n            'paragraph': paragraph,\n            'tableWidget': block\n          };\n        }\n      }\n      var row = block.firstChild;\n      while (row) {\n        // Row mark length\n        offset -= 1;\n        if (offset === currentLength) {\n          if (isRowInserted || this.documentEditor.selectionModule.isEndOffset) {\n            completed.done = true;\n            var index = row.index;\n            return {\n              'offset': offset,\n              'currentLength': currentLength,\n              'paragraph': paragraph,\n              'rowOrCellIndex': index,\n              'rowWidget': row\n            };\n          } else if (isCellInserted) {\n            completed.done = true;\n            var cellWidget = paragraph.associatedCell;\n            var index = cellWidget.cellIndex + 1;\n            return {\n              'offset': offset,\n              'currentLength': currentLength,\n              'paragraph': paragraph,\n              'rowOrCellIndex': index,\n              'cellWidget': cellWidget\n            };\n          }\n        }\n        var cell = row.firstChild;\n        while (cell) {\n          // Cell mark length\n          offset -= 1;\n          if (offset === currentLength) {\n            if (isCellInserted) {\n              completed.done = true;\n              var index = cell.cellIndex;\n              return {\n                'offset': offset,\n                'currentLength': currentLength,\n                'paragraph': paragraph,\n                'rowOrCellIndex': index,\n                'cellWidget': cell\n              };\n            }\n          }\n          var childBlock = cell.firstChild;\n          while (childBlock) {\n            var data = this.getBlockPosition(offset, currentLength, childBlock, completed, isTableInserted, isRowInserted, isCellInserted);\n            if (completed.done) {\n              if (isRowInserted && isNullOrUndefined(data.rowWidget)) {\n                completed.done = true;\n                var rowWidget = cell.ownerRow;\n                var index = rowWidget.index + 1;\n                return {\n                  'offset': offset,\n                  'currentLength': currentLength,\n                  'paragraph': paragraph,\n                  'rowOrCellIndex': index,\n                  'rowWidget': rowWidget\n                };\n              } else if (isCellInserted && isNullOrUndefined(data.cellWidget)) {\n                completed.done = true;\n                var cellWidget = cell;\n                var index = cellWidget.cellIndex + 1;\n                return {\n                  'offset': offset,\n                  'currentLength': currentLength,\n                  'paragraph': paragraph,\n                  'rowOrCellIndex': index,\n                  'cellWidget': cellWidget\n                };\n              } else {\n                return data;\n              }\n            } else {\n              offset = data.offset;\n              currentLength = data.currentLength;\n              paragraph = data.paragraph;\n            }\n            childBlock = childBlock.getSplitWidgets().pop().nextRenderedWidget;\n          }\n          cell = cell.nextWidget;\n        }\n        var tableIndex = row.ownerTable.index;\n        row = row.getSplitWidgets().pop().nextRenderedWidget;\n        if (row && row.ownerTable.index !== tableIndex) {\n          row = undefined;\n        }\n      }\n    }\n    return {\n      'offset': offset,\n      'currentLength': currentLength,\n      'paragraph': paragraph\n    };\n  };\n  CollaborativeEditingHandler.prototype.getBlockTotalLength = function (offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted) {\n    var splittedWidget = block.getSplitWidgets();\n    //Paragraph start offset\n    var paragraphStartLength = 1;\n    var length = 0;\n    if (currentLength + paragraphStartLength >= offset) {\n      completed.done = true;\n      return {\n        'offset': offset - 1,\n        'currentLength': currentLength,\n        'paragraph': block\n      };\n    }\n    var childBlockLength = 0;\n    for (var i = 0; i < splittedWidget.length; i++) {\n      for (var j = 0; j < splittedWidget[i].childWidgets.length; j++) {\n        var line = splittedWidget[i].childWidgets[j];\n        for (var k = 0; k < line.children.length; k++) {\n          var element = line.children[k];\n          if (element instanceof ListTextElementBox) {\n            continue;\n          }\n          if (element instanceof ShapeElementBox && !isNullOrUndefined(element.textFrame) && element.textFrame.childWidgets.length > 0 || element instanceof FootnoteElementBox) {\n            var absoluteData = void 0;\n            if (element instanceof ShapeElementBox) {\n              var currentLengthValue = currentLength + childBlockLength + length + paragraphStartLength;\n              for (var i_1 = 0; i_1 < element.textFrame.childWidgets.length; i_1++) {\n                absoluteData = this.getBlockPosition(offset, currentLengthValue, element.textFrame.childWidgets[i_1], completed, isTableInserted, isRowInserted, isCellInserted);\n                currentLengthValue = absoluteData.currentLength;\n                offset = absoluteData.offset;\n              }\n            } else {\n              var currentLengthValue = currentLength + childBlockLength + length + paragraphStartLength;\n              for (var m = 0; m < element.bodyWidget.childWidgets.length && !completed.done; m++) {\n                absoluteData = this.getBlockPosition(offset, currentLengthValue, element.bodyWidget.childWidgets[m], completed, isTableInserted, isRowInserted, isCellInserted);\n                currentLengthValue = absoluteData.currentLength;\n                offset = absoluteData.offset;\n              }\n            }\n            offset = absoluteData.offset;\n            childBlockLength += absoluteData.currentLength - (currentLength + length + paragraphStartLength + childBlockLength);\n            if (completed.done) {\n              currentLength = absoluteData.currentLength;\n              return absoluteData;\n            }\n          }\n          length += element.length;\n          // this element is present in the widget. so for select insermenting the lenth to offset\n          offset += element.skipformFieldLength ? element.length : 0;\n          if (currentLength + childBlockLength + length + paragraphStartLength >= offset) {\n            completed.done = true;\n            return {\n              'offset': offset - 1,\n              'currentLength': currentLength + childBlockLength,\n              'paragraph': block\n            };\n          }\n        }\n      }\n    }\n    if (currentLength + childBlockLength + length + paragraphStartLength + 1 == offset && this.documentEditor.selection.isEndOffset) {\n      completed.done = true;\n      return {\n        'offset': offset - 1,\n        'currentLength': currentLength + childBlockLength,\n        'paragraph': block\n      };\n    } else {\n      currentLength += length + childBlockLength + paragraphStartLength;\n      return {\n        'offset': offset,\n        'currentLength': currentLength,\n        'paragraph': block\n      };\n    }\n  };\n  CollaborativeEditingHandler.prototype.getRelativePositionFromAbsolutePosition = function (offset, isTableInserted, isRowInserted, isCellInserted) {\n    var documentEditor = this.documentEditor;\n    var block = this.documentEditor.documentHelper.pages[0].bodyWidgets[0].childWidgets[0];\n    var currentLength = 0;\n    var positionInfo = {\n      done: false\n    };\n    var blockObj = this.getBlockByIndex(block, offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n    if (positionInfo.done) {\n      var paraOffset = blockObj.offset - blockObj.currentLength;\n      if (paraOffset < 0) {\n        paraOffset = 0;\n      }\n      var paragraphInfo = {\n        paragraph: blockObj.paragraph,\n        offset: paraOffset\n      };\n      if (isTableInserted || isRowInserted || isCellInserted) {\n        return blockObj;\n      } else {\n        return documentEditor.selectionModule.getHierarchicalIndex(paragraphInfo.paragraph, paragraphInfo.offset.toString());\n      }\n    } else if (blockObj.offset === blockObj.currentLength + 1 && this.documentEditor.selection.isEndOffset) {\n      var length_1 = this.documentEditor.selection.getParagraphLength(blockObj.paragraph);\n      currentLength = blockObj.currentLength - length_1;\n      return documentEditor.selection.getHierarchicalIndex(blockObj.paragraph, (blockObj.offset - currentLength).toString());\n    }\n    var blockObj1 = this.getBlockIndexFromHeaderFooter(blockObj.offset, blockObj.currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n    if (positionInfo.done) {\n      var paraOffset = blockObj1.offset - blockObj1.currentLength;\n      if (paraOffset < 0) {\n        paraOffset = 0;\n      }\n      var paragraphInfo = {\n        paragraph: blockObj1.paragraph,\n        offset: paraOffset\n      };\n      if (isTableInserted || isRowInserted || isCellInserted) {\n        return blockObj1;\n      } else {\n        return documentEditor.selectionModule.getHierarchicalIndex(paragraphInfo.paragraph, paragraphInfo.offset.toString());\n      }\n    }\n    return '';\n  };\n  CollaborativeEditingHandler.prototype.getBlockIndexFromHeaderFooter = function (offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted) {\n    //Iterate header/footer content;\n    var blockObj;\n    var headersFooters = this.documentEditor.documentHelper.headersFooters;\n    for (var _i = 0, headersFooters_1 = headersFooters; _i < headersFooters_1.length; _i++) {\n      var headerFooter = headersFooters_1[_i];\n      for (var i = 0; i < 6; i++) {\n        var currentHeaderFooter = headerFooter[i];\n        if (currentHeaderFooter) {\n          blockObj = this.getBlockByIndex(currentHeaderFooter.childWidgets[0], offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n          currentLength = blockObj.currentLength;\n          offset = blockObj.offset;\n          if (positionInfo.done) {\n            return blockObj;\n          }\n        } else {\n          if (currentLength + 1 >= offset) {\n            positionInfo.done = true;\n            return blockObj;\n          }\n          //Insert new header footer and paragraph to existing collection.\n          currentLength++;\n          blockObj.currentLength = currentLength;\n        }\n      }\n    }\n    return blockObj;\n  };\n  CollaborativeEditingHandler.prototype.getBlockByIndex = function (block, offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted) {\n    var blockObj;\n    do {\n      blockObj = this.getBlockPosition(offset, currentLength, block, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n      currentLength = blockObj.currentLength;\n      offset = blockObj.offset;\n      if (positionInfo.done) {\n        return blockObj;\n      }\n      block = block.getSplitWidgets().pop().nextRenderedWidget;\n    } while (block);\n    return blockObj;\n  };\n  CollaborativeEditingHandler.prototype.insertImage = function (imageData) {\n    if (isNullOrUndefined(imageData.metaString)) {\n      this.documentEditor.editorModule.insertImageInternal(imageData.imageString, true, HelperMethods.convertPointToPixel(imageData.width), HelperMethods.convertPointToPixel(imageData.height), imageData.alternativeText);\n    } else {\n      this.documentEditor.editorModule.isImageInsert = true;\n      this.documentEditor.editorModule.insertImageInternal(imageData.metaString, true, HelperMethods.convertPointToPixel(imageData.width), HelperMethods.convertPointToPixel(imageData.height), imageData.alternativeText);\n    }\n  };\n  CollaborativeEditingHandler.prototype.buildTable = function (operations) {\n    var rows = 0;\n    var columns = 0;\n    for (var i = 0; i < operations.length; i++) {\n      if (operations[i].text === CONTROL_CHARACTERS.Row) {\n        if (!isNullOrUndefined(operations[i].markerData)) {\n          if (isNullOrUndefined(this.documentEditor.editorModule.revisionData)) {\n            this.documentEditor.editorModule.revisionData = [];\n          }\n          this.documentEditor.editorModule.revisionData.push(operations[i].markerData);\n        }\n        rows++;\n      }\n    }\n    for (var i = 0; i < operations.length; i++) {\n      if (operations[i].text === CONTROL_CHARACTERS.Cell) {\n        i += 2;\n        columns++;\n      }\n      if (operations[i].text !== CONTROL_CHARACTERS.Table && (isNullOrUndefined(operations[i + 1]) || operations[i + 1].text === CONTROL_CHARACTERS.Row)) {\n        break;\n      }\n    }\n    this.documentEditor.editorModule.insertTable(rows, columns);\n    this.documentEditor.editorModule.revisionData = undefined;\n  };\n  CollaborativeEditingHandler.prototype.buildRow = function (operations) {\n    var rowData;\n    var cellDatas = [];\n    var paragraphDatas = [];\n    var characterDatas = [];\n    var cellCount = 0;\n    var insertRow = 0;\n    var data = this.getRelativePositionFromAbsolutePosition(operations[0].offset, false, true, false);\n    var tableWidget = data.rowWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n    if (!isNullOrUndefined(operations[0].markerData)) {\n      if (isNullOrUndefined(operations[0].format)) {\n        var row = data.rowWidget;\n        if (row.rowFormat.revisions.length > 0) {\n          var revision = row.rowFormat.revisions[0];\n          revision.accept();\n          return;\n        }\n      }\n    }\n    for (var i = 0; i < operations.length; i++) {\n      var operation = operations[i];\n      if (operation.text === CONTROL_CHARACTERS.Cell) {\n        cellCount++;\n        cellDatas.push(JSON.parse(operation.format));\n        paragraphDatas.push(JSON.parse(operations[i + 1].format));\n        characterDatas.push(JSON.parse(operations[i + 2].format));\n        i += 2;\n      }\n      if (isNullOrUndefined(operations[i + 1]) || operations[i + 1].text === CONTROL_CHARACTERS.Row) {\n        break;\n      }\n    }\n    for (var i = 0; i < operations.length; i++) {\n      if (operations[i].text === CONTROL_CHARACTERS.Row) {\n        if (!isNullOrUndefined(operations[i].markerData)) {\n          if (isNullOrUndefined(this.documentEditor.editorModule.revisionData)) {\n            this.documentEditor.editorModule.revisionData = [];\n          }\n          this.documentEditor.editorModule.revisionData.push(operations[i].markerData);\n        }\n        insertRow++;\n        rowData = JSON.parse(operations[i].format);\n      }\n    }\n    this.documentEditor.editorModule.rowInsertionForCE(data.rowOrCellIndex, cellCount, insertRow, tableWidget, rowData, cellDatas, paragraphDatas, characterDatas);\n    cellDatas = [];\n    paragraphDatas = [];\n    characterDatas = [];\n    this.documentEditor.editorModule.revisionData = undefined;\n  };\n  CollaborativeEditingHandler.prototype.buildCell = function (operation, paraFormt, charFormat) {\n    var data = this.getRelativePositionFromAbsolutePosition(operation.offset, false, false, true);\n    if (operation.length > 0) {\n      this.rowWidget = data.cellWidget.ownerRow;\n      this.documentEditor.editorModule.cellInsertionForCE(data.rowOrCellIndex, this.rowWidget, JSON.parse(operation.format), JSON.parse(paraFormt), JSON.parse(charFormat));\n    } else {\n      this.documentEditor.documentHelper.owner.parser.parseCellFormat(JSON.parse(operation.format), data.cellWidget.cellFormat, 0);\n    }\n  };\n  CollaborativeEditingHandler.prototype.buildDeleteCells = function (operation) {\n    var data = this.getRelativePositionFromAbsolutePosition(operation.offset, false, false, true);\n    if (!isNullOrUndefined(data.cellWidget)) {\n      var firstPara = this.documentEditor.selectionModule.getFirstParagraph(data.cellWidget);\n      var lastPara = this.documentEditor.selectionModule.getLastParagraph(data.cellWidget);\n      if (!isNullOrUndefined(firstPara) && !isNullOrUndefined(lastPara)) {\n        this.documentEditor.selectionModule.start.setPosition(firstPara.firstChild, true);\n        this.documentEditor.selectionModule.end.setPositionParagraph(lastPara.lastChild, lastPara.lastChild.getEndOffset() + 1);\n      }\n      this.documentEditor.editorModule.checkAndRemoveComments();\n      this.table = data.cellWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n      var paragraph = undefined;\n      if (data.cellWidget.nextWidget) {\n        var nextCell = data.cellWidget.nextWidget;\n        paragraph = this.documentEditor.selectionModule.getFirstParagraph(nextCell);\n      } else if (data.cellWidget.previousWidget) {\n        var previousCell = data.cellWidget.previousWidget;\n        paragraph = this.documentEditor.selectionModule.getFirstParagraph(previousCell);\n      }\n      if (isNullOrUndefined(paragraph)) {\n        paragraph = this.documentEditor.editorModule.getParagraphForSelection(this.table);\n      }\n      operation.length += this.documentEditor.editorModule.onDeleteColumn(this.table, [data.cellWidget]);\n      this.table.updateRowIndex(0);\n      this.documentEditor.selectionModule.selectParagraphInternal(paragraph, true);\n    }\n  };\n  CollaborativeEditingHandler.prototype.transformSelectionOperation = function (operation, conflictingOperation) {\n    if (operation.action === 'Delete' && conflictingOperation.action === 'Delete') {\n      var previousStart = conflictingOperation.offset;\n      var conflictingSelection = conflictingOperation;\n      // Case 1: No overlap, no conflict\n      if (operation.offset + operation.length <= conflictingSelection.offset || operation.offset >= conflictingSelection.offset + conflictingSelection.length) {\n        return;\n      }\n      // Case 2: Local selection is completely within the conflicting selection\n      if (operation.offset >= conflictingSelection.offset && operation.offset + operation.length <= conflictingSelection.offset + conflictingSelection.length) {\n        conflictingOperation.offset = conflictingOperation.offset;\n        conflictingOperation.length -= operation.length;\n        if (conflictingOperation.length <= 0) {\n          conflictingOperation.skipOperation = true;\n        }\n        return;\n      }\n      // Case 3: Local selection overlaps from the left side\n      if (operation.offset < conflictingSelection.offset && operation.offset + operation.length <= conflictingSelection.offset + conflictingSelection.length) {\n        conflictingOperation.offset = operation.offset + operation.length;\n        conflictingOperation.length -= conflictingOperation.offset - previousStart;\n        //return transformedOperation;\n        return;\n      }\n      // Case 4: Local selection overlaps from the right side\n      if (operation.offset >= conflictingSelection.offset && operation.offset + operation.length > conflictingSelection.offset + conflictingSelection.length) {\n        conflictingOperation.length -= conflictingOperation.offset + conflictingOperation.length - operation.offset;\n        return;\n      }\n      // Case 5: Local selection fully encompasses the conflicting selection\n      if (operation.offset < conflictingSelection.offset && operation.offset + operation.length > conflictingSelection.offset + conflictingSelection.length) {\n        conflictingSelection.offset = operation.offset;\n        conflictingSelection.length = 0;\n        conflictingOperation.skipOperation = true;\n        return;\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.documentSettings = function (operation) {\n    this.documentEditor.skipSettingsOps = true;\n    switch (operation.text) {\n      case 'enableTrackChanges':\n        this.documentEditor.enableTrackChanges = operation.enableTrackChanges;\n        break;\n      case 'protection':\n        this.documentEditor.documentHelper.restrictEditingPane.showHideRestrictPane(true);\n        if (!isNullOrUndefined(operation.protectionData.saltValue)) {\n          if (operation.protectionData.hashValue === '' && operation.protectionData.saltValue === '') {\n            this.documentEditor.editorModule.protectDocument(operation.protectionData.protectionType);\n          } else {\n            this.documentEditor.editorModule.enforceProtectionAssign(operation.protectionData.saltValue, operation.protectionData.hashValue, operation.protectionData.protectionType);\n          }\n        } else {\n          if (isNullOrUndefined(operation.protectionData.hashValue)) {\n            this.documentEditor.editorModule.unProtectDocument();\n          } else {\n            this.documentEditor.editorModule.validateHashValue(operation.protectionData.hashValue);\n          }\n        }\n        break;\n    }\n  };\n  CollaborativeEditingHandler.prototype.checkAndRetriveChangesFromServer = function () {\n    var _this = this;\n    if (!this.isSyncServerChanges) {\n      var action = {\n        version: this.version,\n        connectionId: this.connectionId,\n        roomName: this.roomName\n      };\n      var httpRequest = new XMLHttpRequest();\n      httpRequest.open('Post', this.serviceUrl + 'GetActionsFromServer', true);\n      httpRequest.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n      this.setCustomAjaxHeaders(httpRequest);\n      httpRequest.onreadystatechange = function () {\n        if (httpRequest.readyState === 4) {\n          if (httpRequest.status === 200 || httpRequest.status === 304) {\n            _this.applyChangesFromServer(httpRequest.responseText);\n          } else {\n            alert('Fail to load the document');\n          }\n        }\n      };\n      httpRequest.send(JSON.stringify(action));\n      this.isSyncServerChanges = true;\n    }\n  };\n  CollaborativeEditingHandler.prototype.applyChangesFromServer = function (data) {\n    var dataObject = JSON.parse(data);\n    if (dataObject.length > 0) {\n      for (var i = 0; i < dataObject.length; i++) {\n        var data_4 = dataObject[i];\n        if (data_4.connectionId === this.connectionId) {\n          this.acknowledgementReceived();\n          this.logMessage(this.isSyncServerChanges ? 'SignalR Server sync' + data_4.version : 'SignalR Same user sync:' + data_4.version);\n        } else {\n          this.handleRemoteOperation(data_4);\n          this.logMessage('Received: ' + JSON.stringify(JSON.stringify(data_4)));\n        }\n        this.updateVersion(data_4.version);\n        this.logMessage('Server sync ack:' + data_4.version);\n      }\n      this.updateVersion(dataObject[dataObject.length - 1].version);\n    }\n    this.isSyncServerChanges = false;\n    if (!this.isAcknowledgePending()) {\n      this.acknowledgementReceived();\n    }\n    this.sendLocalOperation();\n  };\n  CollaborativeEditingHandler.prototype.insertCharaterFormat = function (type, characterData) {\n    var format = new WCharacterFormat(undefined);\n    var characterFormat = JSON.parse(characterData);\n    var keys = Object.keys(characterFormat);\n    this.documentEditor.documentHelper.owner.parser.parseCharacterFormat(0, characterFormat, format);\n    if (keys.length > 1) {\n      this.documentEditor.documentHelper.owner.fontDialogModule.onCharacterFormat(this.documentEditor.selectionModule, format);\n      this.documentEditor.editorModule.onApplyCharacterFormat('CharacterFormat', format);\n    } else if (keys.length === 1) {\n      if (keys.indexOf('styleName') !== -1) {\n        this.documentEditor.editorModule.applyStyle(characterFormat.styleName, true);\n      } else if (keys.indexOf('allCaps') !== -1) {\n        this.documentEditor.editorModule.changeCase('allCaps');\n      } else if (keys.indexOf('Uppercase') !== -1 || keys.indexOf('Lowercase') !== -1 || keys.indexOf('SentenceCase') !== -1 || keys.indexOf('ToggleCase') !== -1 || keys.indexOf('CapitalizeEachWord') !== -1) {\n        this.documentEditor.editorModule.changeCase(keys[0]);\n      } else {\n        if (type === 'increment' || type === 'decrement') {\n          this.documentEditor.editorModule.onApplyCharacterFormat(keys[0], type, true);\n        } else {\n          this.documentEditor.editorModule.onApplyCharacterFormat(keys[0], characterFormat[keys[0]]);\n        }\n      }\n    } else {\n      this.documentEditor.editorModule.clearFormatting();\n    }\n  };\n  CollaborativeEditingHandler.prototype.insertParagraphFormat = function (operation, paragraphData) {\n    var format = new WParagraphFormat(undefined);\n    var paragraphFormat = JSON.parse(paragraphData);\n    var update = false;\n    if (!isNullOrUndefined(paragraphFormat.isFirstParaForList)) {\n      delete paragraphFormat.isFirstParaForList;\n      update = true;\n    }\n    var keys = Object.keys(paragraphFormat);\n    this.documentEditor.documentHelper.owner.parser.parseParagraphFormat(0, paragraphFormat, format);\n    if (keys.length === 1) {\n      if (keys.indexOf('styleName') !== -1) {\n        this.documentEditor.editorModule.applyStyle(paragraphFormat.styleName, true);\n      } else {\n        if (keys[0] === 'borders') {\n          this.documentEditor.editorModule.onApplyParagraphFormat(keys[0], format.borders, false, false);\n        } else if (keys[0] === 'listFormat') {\n          this.updateList(operation, format);\n          var list = this.documentEditor.documentHelper.getListById(paragraphFormat.listFormat.nsid, true);\n          if (!isNullOrUndefined(list)) {\n            format.listFormat.listId = list.listId;\n            format.listFormat.list = list;\n          }\n          this.documentEditor.editorModule.onApplyParagraphFormat('listFormat', format.listFormat, false, false);\n        } else {\n          this.documentEditor.editorModule.onApplyParagraphFormat(keys[0], paragraphFormat[keys[0]], update, false);\n        }\n      }\n    } else {\n      this.documentEditor.documentHelper.owner.paragraphDialogModule.onParagraphFormat(format);\n    }\n  };\n  CollaborativeEditingHandler.prototype.insertTableFormat = function (type, tableData, offset) {\n    var format = new WTableFormat(undefined);\n    var tableFormat = JSON.parse(tableData);\n    var keys = Object.keys(tableFormat);\n    this.documentEditor.documentHelper.owner.parser.parseTableFormat(tableFormat, format, 0);\n    var data = this.getRelativePositionFromAbsolutePosition(offset, true, false, false);\n    var sourceTable = data.tableWidget;\n    if (!isNullOrUndefined(type)) {\n      var typeValue = type === 'TableAutoFitToContents' ? 'FitToContents' : type === 'TableAutoFitToWindow' ? 'FitToWindow' : 'FixedColumnWidth';\n      this.documentEditor.editorModule.insertAutoFitTable(typeValue, sourceTable);\n      return;\n    }\n    if (keys.length === 1) {\n      this.documentEditor.editorModule.onApplyTableFormat(keys[0], tableFormat[keys[0]], sourceTable);\n    } else {\n      if (keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n        this.documentEditor.editorModule.isBordersAndShadingDialog = true;\n        this.documentEditor.editorModule.onTableFormat(format, true, sourceTable);\n        this.documentEditor.editorModule.isBordersAndShadingDialog = false;\n      } else if (keys.indexOf('cellSpacing') !== -1 || keys.indexOf('leftMargin') !== -1 || keys.indexOf('topMargin') !== -1 || keys.indexOf('rightMargin') !== -1 || keys.indexOf('bottomMargin') !== -1) {\n        this.documentEditor.documentHelper.owner.tableOptionsDialogModule.applySubTableOptions(format, sourceTable);\n      } else {\n        this.documentEditor.editorModule.onTableFormat(format, false, sourceTable);\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.insertRowFormat = function (property, rowData) {\n    var format = new WRowFormat(undefined);\n    var rowFormat = JSON.parse(rowData);\n    var keys = Object.keys(rowFormat);\n    this.documentEditor.documentHelper.owner.parser.parseRowFormat(rowFormat, format, 0);\n    if (keys.length === 1) {\n      this.documentEditor.editorModule.onApplyTableRowFormat(keys[0], rowFormat[keys[0]]);\n    } else {\n      this.documentEditor.editorModule.onRowFormat(format);\n    }\n  };\n  CollaborativeEditingHandler.prototype.insertCellFormat = function (cellData) {\n    if (!this.documentEditor.selectionModule.start.paragraph.isInsideTable) {\n      return;\n    }\n    var format = new WCellFormat(undefined);\n    var formatCell = JSON.parse(cellData);\n    var keys = Object.keys(formatCell);\n    this.documentEditor.documentHelper.owner.parser.parseCellFormat(formatCell, format, 0);\n    var cellFormat = this.documentEditor.selectionModule.start.paragraph.associatedCell.cellFormat;\n    if (keys.length === 1) {\n      if (keys[0] === 'shading') {\n        this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], format.shading, cellFormat);\n      } else if (keys[0] === 'borders') {\n        this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], format.borders, cellFormat);\n      } else {\n        this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], cellFormat[keys[0]], cellFormat);\n      }\n    } else {\n      if (keys.indexOf('preferredWidth') !== -1 || keys.indexOf('preferredWidthType') !== -1 || keys.indexOf('verticalAlignment') !== -1 || keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n        if (keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n          this.documentEditor.editorModule.isBordersAndShadingDialog = true;\n        }\n        this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, undefined, format, cellFormat);\n        this.documentEditor.editorModule.isBordersAndShadingDialog = false;\n      } else {\n        this.documentEditor.documentHelper.owner.cellOptionsDialogModule.applySubCellOptions(format);\n      }\n    }\n  };\n  CollaborativeEditingHandler.prototype.insertSectionFormat = function (property, sectionData) {\n    var data = JSON.parse(sectionData);\n    var keys = Object.keys(data);\n    if (keys[0] === 'linkToPrevious') {\n      var headerFooterWidget = this.documentEditor.selectionModule.start.paragraph.bodyWidget;\n      var sectionIndex = headerFooterWidget.sectionIndex;\n      var headerFooterType = headerFooterWidget.headerFooterType;\n      this.documentEditor.editorModule.removeInlineHeaderFooterWidget(sectionIndex, headerFooterType, property, data['linkToPrevious']);\n    } else if (keys.length > 1) {\n      var sectionFormat = new WSectionFormat();\n      this.documentEditor.documentHelper.owner.parser.parseSectionFormat(0, data, sectionFormat);\n      this.documentEditor.editorModule.onApplySectionFormat(undefined, sectionFormat);\n    } else {\n      this.documentEditor.editorModule.onApplySectionFormat(Object.keys(data)[0], data[Object.keys(data)[0]]);\n    }\n  };\n  CollaborativeEditingHandler.prototype.logMessage = function (event) {\n    if (this.logEventEnabled) {\n      this.message += event + ' ' + '\\n';\n    }\n  };\n  CollaborativeEditingHandler.prototype.setCustomAjaxHeaders = function (xmlHttpRequest) {\n    for (var i = 0; i < this.documentEditor.headers.length; i++) {\n      var header = this.documentEditor.headers[i];\n      for (var _i = 0, _a = Object.keys(header); _i < _a.length; _i++) {\n        var key = _a[_i];\n        xmlHttpRequest.setRequestHeader(key, header[key]);\n      }\n    }\n  };\n  /**\n   * Destory collaborative editing module.\n   * @private\n   */\n  CollaborativeEditingHandler.prototype.destroy = function () {\n    this.version = undefined;\n    this.documentEditor = undefined;\n    this.roomName = undefined;\n    this.userMap = undefined;\n    this.connectionId = undefined;\n    this.acknowledgmentPending = undefined;\n    this.pendingOps = undefined;\n    this.serviceUrl = undefined;\n    this.isSyncServerChanges = undefined;\n    this.message = undefined;\n    this.rowWidget = undefined;\n  };\n  return CollaborativeEditingHandler;\n}();\nexport { CollaborativeEditingHandler };\n/**\n * @private\n */\nvar CaretInfo = /** @class */function () {\n  function CaretInfo(color, caret, offset, userName) {\n    this.color = color;\n    this.caret = caret;\n    this.offset = offset;\n    this.userName = userName;\n    this.initializeElement();\n  }\n  /**\n   * @private\n   */\n  CaretInfo.prototype.initializeElement = function () {\n    this.hoverDiv = createElement('div', {\n      className: 'e-de-user-info e-de-user-name-collapse',\n      styles: 'z-index: 1; visibility: hidden;left:-4px;position:absolute;width:20px;height:20px;pointer-events:all;'\n    });\n    this.userViewContainer = createElement('div');\n    this.spanViewContainer = createElement('div', {\n      styles: 'background-color:' + this.color + ';left: 0px; top: 15px; visibility: visible;'\n    });\n    this.spanView = createElement('span', {\n      styles: 'background-color:' + this.color + '; left: 0px;top:-4px;pointer:default'\n    });\n    this.spanViewContainer.appendChild(this.spanView);\n    this.userViewContainer.appendChild(this.spanViewContainer);\n    this.hoverDiv.appendChild(this.userViewContainer);\n    this.caret.appendChild(this.hoverDiv);\n    this.hoverDiv.addEventListener('mouseenter', this.onMouseEnter.bind(this));\n    this.hoverDiv.addEventListener('mouseleave', this.onMouseLeave.bind(this));\n  };\n  CaretInfo.prototype.onMouseEnter = function () {\n    this.hoverDiv.classList.remove('e-de-user-name-collapse');\n    this.hoverDiv.classList.add('e-de-user-name-expended');\n    this.spanView.innerText = this.userName;\n  };\n  CaretInfo.prototype.onMouseLeave = function () {\n    this.hoverDiv.classList.add('e-de-user-name-collapse');\n    this.hoverDiv.classList.remove('e-de-user-name-expended');\n    this.spanView.innerText = '';\n  };\n  return CaretInfo;\n}();","map":{"version":3,"names":["HelperMethods","ParagraphWidget","TableWidget","CONTROL_CHARACTERS","SectionBreakType","ListTextElementBox","ShapeElementBox","FootnoteElementBox","CommentElementBox","CommentCharacterElementBox","FieldElementBox","WCharacterFormat","ImageElementBox","WParagraphFormat","WTableFormat","WRowFormat","WCellFormat","WSectionFormat","listIdProperty","abstractListsProperty","listsProperty","abstractListIdProperty","nsidProperty","isNullOrUndefined","createElement","CollaborativeEditingHandler","documentEditor","version","userMap","connectionId","pendingOps","commentsStart","commentsEnd","deletedComments","serviceUrl","isSyncServerChanges","logEventEnabled","message","prototype","getModuleName","updateRoomInfo","roomName","sendActionToServer","operations","length","lastPendingOp","checkAndCombineOperation","push","isAcknowledgePending","sendLocalOperation","transformRemoteCursor","offset","lastAction","currentAction","lastOperation","currentOperation","isSameOperation","canCombineOperation","action","text","format","isControlCharacter","markerData","controlCharacters","Table","Row","Cell","Image","PageBreak","ColumnBreak","Section_Break","Field_Separator","Marker_Start","Marker_End","Tab","LineBreak","indexOf","applyRemoteAction","data","removeCarets","dataReceived","acknowledgmentPending","handleAcknowledgementReceived","versionDiff","getVersionDifference","checkAndRetriveChangesFromServer","logMessage","updateVersion","acknowledgementReceived","undefined","_this","shift","changes","currentUser","httpRequest","XMLHttpRequest","open","setRequestHeader","setCustomAjaxHeaders","onreadystatechange","readyState","status","dataObject","JSON","parse","responseText","alert","stringify","send","editorModule","isIncrementalSave","handleRemoteOperation","isRemoteAction","localStartOffset","selectionModule","getAbsolutePositionFromRelativePosition","start","selectionLength","end","transform","applyRemoteOperation","editorHistoryModule","canUndo","undoStack","canRedo","redoStack","operation","remoteOperation","i","remoteData","j","k","localOperation","transformSelectionOperation","previousOffset","transformOperation","skipAction","skipOperation","bookmarks","currentEditMode","commentReviewPane","commentPane","isEditMode","currenteditorHistory","currentTextArea","currentEditingComment","textArea","tableLength","trackingCurrentValue","enableTrackChanges","author","isSkipTracking","skipSettingsOps","styleData","editor","updateStyleObject","startOffset","getRelativePositionFromAbsolutePosition","op2","endOffset","documentSettings","isEndOffset","isAcceptOrReject","select","revisionForFootnoteEndnoteContent","revisionId","revisionData","splittedRevisions","concat","revision","getRevision","accept","reject","type","isPasteListUpdated","pasteContents","getSfdtDocument","pasteContent","isInsertingTOC","toString","insertImage","imageData","insertSectionBreak","Continuous","element","createBookmarkElements","bookmarkName","documentHelper","isBookmarkInserted","insertElementsInternal","bookmark","reference","selectBookmark","properties","getBookmarkProperties","user","id","editRangeId","restrictEditingPane","addUserDialog","bindListData","addEditElement","columnFirst","parseInt","columnLast","line","currentWidget","editRanges","get","_i","editRanges_1","editStart","editRangeEnd","fireContentChange","isFieldOperation","checkBoxValue","field","formFieldData","getFormFieldData","parser","parseFormFieldData","characterFormat","data_1","parseCharacterFormat","copyFormat","initInsertInline","inlineObj","getInline","inline","toggleCheckBoxFormField","commentId","commentType","deleteComment","layout","getCommentById","ownerDeleteComment","comments","ownerCommentId","replyComments","item","comment","index","children","commentStart","insertFootnote","insertEndnote","dropDownIndex","updateFormField","buildTable","getOperationLength","reverse","buildRow","paraFormat","charFormat","buildCell","insertPageBreak","insertColumnBreak","insertText","selection","getElementInfo","commentEnd","indexInOwner","removeAtOffset","removeCommentMark","offset_1","buildDeleteCells","onBackSpace","updateOperation","revisionType","data_2","rowWidget","row","trackRowDeletion","trackChangesPane","updateTrackChanges","data_3","table","ownerTable","rowData","owner","parseRowFormat","rowFormat","calculateGrid","reLayoutTable","tableData","parseTableFormat","tableWidget","tableFormat","cellData","cell","parseCellFormat","cellWidget","cellFormat","onImageFormat","convertPointToPixel","width","height","alternativeText","paragraphFormat","parseParagraphFormat","updateList","list","getListById","listFormat","nsid","listId","onApplyParagraphFormat","restartListAtInternal","applyContinueNumberingInternal","insertCharaterFormat","insertParagraphFormat","insertTableFormat","insertSectionFormat","insertRowFormat","insertCellFormat","newOffset","updateRemoteSelection","temp","tranformedOffset","transformSection","tranformedEndOffset","searchModule","optionsPaneModule","searchResults","isOptionsPaneShow","searchIconClickInternal","layoutWholeDocument","combineWidget","viewer","updateRowIndex","reLayout","updateTable","ownerComment","commentToDelete","commentID","getComment","done","date","isReply","commentView","commentText","innerText","commentAction","resolveComment","reopenComment","showDrawer","deleteCommentWidget","hideDrawer","getObjectByCommentId","updateCommentElement","splice","commentIndex","addReply","addCommentWidget","postComment","collection","replyComment","listData","hasOwnProperty","keywordIndex","optimizeSfdt","updateListCollection","abstractLists","parseAbstractList","abstractList","levels","listLevelNumber","uniqueListId","getUniqueListOrAbstractListId","uniqueAbsLstId","_loop_1","filter","obj","parseList","lists","collection_1","operation1","operation2","conflictLenth","updateCaretPosition","keys","Object","key","remoteOffset","updateCaretPositionInteral","caret","removeOffset","color","getColorForMember","Math","random","className","styles","CaretInfo","remove","randonNumber","colorValue","zoomFactor","startPos","getTextPosBasedOnLogicalIndex","caretPosition","location","style","display","parentElement","viewerContainer","appendChild","page","getSelectionPage","left","boundingRectangle","x","round","caretInfo","updateCaretSize","topMargin","pageTop","getPageTop","top","y","baselineAlignment","parseFloat","getBlockPosition","currentLength","block","completed","isTableInserted","isRowInserted","isCellInserted","paragraph","absoluteData","getBlockTotalLength","firstChild","associatedCell","cellIndex","childBlock","ownerRow","getSplitWidgets","pop","nextRenderedWidget","nextWidget","tableIndex","splittedWidget","paragraphStartLength","childBlockLength","childWidgets","textFrame","currentLengthValue","i_1","m","bodyWidget","skipformFieldLength","pages","bodyWidgets","positionInfo","blockObj","getBlockByIndex","paraOffset","paragraphInfo","getHierarchicalIndex","length_1","getParagraphLength","blockObj1","getBlockIndexFromHeaderFooter","headersFooters","headersFooters_1","headerFooter","currentHeaderFooter","metaString","insertImageInternal","imageString","isImageInsert","rows","columns","insertTable","cellDatas","paragraphDatas","characterDatas","cellCount","insertRow","revisions","rowInsertionForCE","rowOrCellIndex","paraFormt","cellInsertionForCE","firstPara","getFirstParagraph","lastPara","getLastParagraph","setPosition","setPositionParagraph","lastChild","getEndOffset","checkAndRemoveComments","nextCell","previousWidget","previousCell","getParagraphForSelection","onDeleteColumn","selectParagraphInternal","conflictingOperation","previousStart","conflictingSelection","showHideRestrictPane","protectionData","saltValue","hashValue","protectDocument","protectionType","enforceProtectionAssign","unProtectDocument","validateHashValue","applyChangesFromServer","data_4","characterData","fontDialogModule","onCharacterFormat","onApplyCharacterFormat","applyStyle","styleName","changeCase","clearFormatting","paragraphData","update","isFirstParaForList","borders","paragraphDialogModule","onParagraphFormat","sourceTable","typeValue","insertAutoFitTable","onApplyTableFormat","isBordersAndShadingDialog","onTableFormat","tableOptionsDialogModule","applySubTableOptions","property","onApplyTableRowFormat","onRowFormat","isInsideTable","formatCell","applyCellPropertyValue","shading","cellOptionsDialogModule","applySubCellOptions","sectionData","headerFooterWidget","sectionIndex","headerFooterType","removeInlineHeaderFooterWidget","sectionFormat","parseSectionFormat","onApplySectionFormat","event","xmlHttpRequest","headers","header","_a","destroy","userName","initializeElement","hoverDiv","userViewContainer","spanViewContainer","spanView","addEventListener","onMouseEnter","bind","onMouseLeave","classList","add"],"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/collaboration/collaboration.js"],"sourcesContent":["/* eslint-disable */\nimport { HelperMethods, ParagraphWidget, TableWidget, CONTROL_CHARACTERS, SectionBreakType, ListTextElementBox, ShapeElementBox, FootnoteElementBox, CommentElementBox, CommentCharacterElementBox, FieldElementBox, WCharacterFormat, ImageElementBox, WParagraphFormat, WTableFormat, WRowFormat, WCellFormat, WSectionFormat, listIdProperty, abstractListsProperty, listsProperty, abstractListIdProperty, nsidProperty } from '../../index';\nimport { isNullOrUndefined } from '@syncfusion/ej2-base';\nimport { createElement } from '@syncfusion/ej2-base';\n/**\n * Module to handle collaborative editing.\n */\nvar CollaborativeEditingHandler = /** @class */ (function () {\n    function CollaborativeEditingHandler(documentEditor) {\n        //TODO need to prevent document change on collaborative editing session i.e. New document, select new document\n        //#region SignalR collabrative editing\n        this.version = 0;\n        this.userMap = {};\n        this.connectionId = '';\n        this.pendingOps = [];\n        this.commentsStart = [];\n        this.commentsEnd = [];\n        this.deletedComments = [];\n        this.serviceUrl = '';\n        this.isSyncServerChanges = false;\n        this.logEventEnabled = true;\n        this.message = '';\n        this.documentEditor = documentEditor;\n    }\n    ;\n    /**\n     * Get module name.\n     * @returns - Returns the module name\n     */\n    CollaborativeEditingHandler.prototype.getModuleName = function () {\n        return 'CollaborativeEditingHandler';\n    };\n    /**\n     * This function updates the room information and server url of the collaborative editing session.\n     * @param roomName - Specifies the current collaborative editing room name.\n     * @param version - Specifies the current version of the document.\n     * @param serviceUrl - Specifies the base url of the collaborative editing service.\n     */\n    CollaborativeEditingHandler.prototype.updateRoomInfo = function (roomName, version, serviceUrl) {\n        this.roomName = roomName;\n        this.serviceUrl = serviceUrl;\n        this.version = version;\n    };\n    /**\n     * Send the current action to the server.\n     * @param args - Specified the current action.\n     * @returns\n     */\n    CollaborativeEditingHandler.prototype.sendActionToServer = function (operations) {\n        if (!isNullOrUndefined(operations) && operations.length === 0) {\n            return;\n        }\n        var lastPendingOp = this.pendingOps[this.pendingOps.length - 1];\n        if (!lastPendingOp || !this.checkAndCombineOperation(lastPendingOp, operations)) {\n            this.pendingOps.push(operations);\n        }\n        if (!this.isAcknowledgePending()) {\n            this.sendLocalOperation();\n        }\n        this.transformRemoteCursor(this.connectionId, operations[0], operations[0].offset);\n    };\n    CollaborativeEditingHandler.prototype.checkAndCombineOperation = function (lastAction, currentAction) {\n        if (lastAction.length !== 1 || currentAction.length !== 1) {\n            return false;\n        }\n        var lastOperation = lastAction[0];\n        var currentOperation = currentAction[0];\n        if (this.isSameOperation(lastOperation, currentOperation) && this.canCombineOperation(lastOperation, currentOperation)) {\n            if ((lastOperation.action === 'Insert' && lastOperation.offset + lastOperation.length === currentOperation.offset) ||\n                (lastOperation.action === 'Delete' && (lastOperation.offset === currentOperation.offset))) {\n                lastOperation.length += currentOperation.length;\n                lastOperation.text += currentOperation.text;\n                return true;\n            }\n            else if (lastOperation.action === 'Delete' && currentOperation.offset + currentOperation.length === lastOperation.offset) {\n                lastOperation.text = currentOperation.text + lastOperation.text;\n                lastOperation.offset = currentOperation.offset;\n                lastOperation.length += currentOperation.length;\n                return true;\n            }\n        }\n        return false;\n    };\n    CollaborativeEditingHandler.prototype.canCombineOperation = function (lastOperation, currentOperation) {\n        return lastOperation.format === currentOperation.format &&\n            !this.isControlCharacter(lastOperation.text) &&\n            !this.isControlCharacter(currentOperation.text) &&\n            isNullOrUndefined(lastOperation.markerData) &&\n            isNullOrUndefined(currentOperation.markerData);\n    };\n    CollaborativeEditingHandler.prototype.isSameOperation = function (lastOperation, currentOperation) {\n        return lastOperation.action === currentOperation.action;\n    };\n    CollaborativeEditingHandler.prototype.isControlCharacter = function (text) {\n        var controlCharacters = [\n            CONTROL_CHARACTERS.Table,\n            CONTROL_CHARACTERS.Row,\n            CONTROL_CHARACTERS.Cell,\n            CONTROL_CHARACTERS.Image,\n            CONTROL_CHARACTERS.PageBreak,\n            CONTROL_CHARACTERS.ColumnBreak,\n            CONTROL_CHARACTERS.Section_Break,\n            CONTROL_CHARACTERS.Table,\n            CONTROL_CHARACTERS.Field_Separator,\n            CONTROL_CHARACTERS.Marker_Start,\n            CONTROL_CHARACTERS.Marker_End,\n            CONTROL_CHARACTERS.Tab,\n            CONTROL_CHARACTERS.LineBreak\n        ];\n        return controlCharacters.indexOf(text) !== -1;\n    };\n    /**\n     * Apply the remote operation to the current document.\n     * @param action - Specifies the remote action type.\n     * @param data - Specifies the remote operation data.\n     */\n    CollaborativeEditingHandler.prototype.applyRemoteAction = function (action, data) {\n        switch (action) {\n            case 'connectionId':\n                this.connectionId = data;\n                break;\n            case 'removeUser':\n                this.removeCarets(data);\n                break;\n            case 'action':\n                this.dataReceived(data);\n                break;\n        }\n    };\n    CollaborativeEditingHandler.prototype.isAcknowledgePending = function () {\n        return !isNullOrUndefined(this.acknowledgmentPending);\n    };\n    CollaborativeEditingHandler.prototype.handleAcknowledgementReceived = function (action) {\n        var versionDiff = this.getVersionDifference(action);\n        if (versionDiff > 1) {\n            this.checkAndRetriveChangesFromServer();\n        }\n        else {\n            this.logMessage('Ack received: ' + action.version);\n            this.logMessage('Ack version diff: ' + versionDiff);\n            if (action.version > this.version) {\n                this.updateVersion(action.version);\n                this.acknowledgementReceived();\n                this.sendLocalOperation();\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.updateVersion = function (version) {\n        if (version > this.version) {\n            this.version = version;\n        }\n    };\n    CollaborativeEditingHandler.prototype.acknowledgementReceived = function () {\n        this.acknowledgmentPending = undefined;\n    };\n    //Send the local operation to server\n    CollaborativeEditingHandler.prototype.sendLocalOperation = function () {\n        var _this = this;\n        if (this.pendingOps.length > 0) {\n            var operations = this.pendingOps.shift();\n            var changes = {};\n            changes.currentUser = this.documentEditor.currentUser;\n            changes.roomName = this.roomName;\n            changes.connectionId = this.connectionId;\n            changes.version = this.version;\n            changes.operations = operations;\n            this.acknowledgmentPending = operations;\n            var httpRequest = new XMLHttpRequest();\n            httpRequest.open('Post', this.serviceUrl + 'UpdateAction', true);\n            httpRequest.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n            this.setCustomAjaxHeaders(httpRequest);\n            httpRequest.onreadystatechange = function () {\n                if (httpRequest.readyState === 4) {\n                    if (httpRequest.status === 200 || httpRequest.status === 304) {\n                        var dataObject = JSON.parse(httpRequest.responseText);\n                        if (!_this.isSyncServerChanges) {\n                            _this.handleAcknowledgementReceived(dataObject);\n                        }\n                    }\n                    else {\n                        alert('Failed to save the changes');\n                    }\n                }\n            };\n            this.logMessage('Sent: ' + JSON.stringify(changes));\n            httpRequest.send(JSON.stringify(changes));\n        }\n    };\n    CollaborativeEditingHandler.prototype.dataReceived = function (action) {\n        if ((action.connectionId === this.connectionId && !this.documentEditor.editorModule.isIncrementalSave) || this.isSyncServerChanges) {\n            this.logMessage(this.isSyncServerChanges ? 'SignalR Server sync' + action.version : 'SignalR Same user sync:' + action.version);\n            return;\n        }\n        var versionDiff = this.getVersionDifference(action);\n        if (versionDiff <= 0 && !this.documentEditor.editorModule.isIncrementalSave) {\n            this.logMessage('SignalR return diff:<=0' + action.version);\n            return;\n        }\n        if (versionDiff > 1 && !this.documentEditor.editorModule.isIncrementalSave) {\n            this.logMessage('SignalR return diff:>=1' + action.version);\n            this.checkAndRetriveChangesFromServer();\n            return;\n        }\n        this.logMessage('SignalR ack: ' + action.version);\n        // try {\n        this.logMessage('Received: ' + JSON.stringify(action));\n        this.handleRemoteOperation(action);\n        // } catch (e) {\n        //     if (e instanceof Error) {\n        //         this.logMessage('Error while handling remote operation: ' + e);\n        //         this.logMessage('Error while handling remote operation: ' + e.stack);\n        //     } else {\n        //         this.logMessage('Error while handling remote operation: ' + e);\n        //     }\n        // }\n    };\n    CollaborativeEditingHandler.prototype.getVersionDifference = function (action) {\n        return action.version - this.version;\n    };\n    CollaborativeEditingHandler.prototype.handleRemoteOperation = function (action) {\n        //To Prevent the content change event while applying the remote operation\n        this.documentEditor.editorModule.isRemoteAction = true;\n        //TODO: Need to handle backward selection.\n        var localStartOffset = this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(this.documentEditor.selectionModule.start);\n        var selectionLength = this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(this.documentEditor.selectionModule.end) - localStartOffset;\n        if (!isNullOrUndefined(this.acknowledgmentPending)) {\n            this.logMessage('Acknowledge transform:' + this.acknowledgmentPending[0].text + 'version:' + action.version);\n            this.transform([this.acknowledgmentPending], action.operations);\n        }\n        if (this.pendingOps.length > 0) {\n            this.logMessage('Pending transform:' + this.pendingOps.length + 'version:' + action.version);\n        }\n        this.transform(this.pendingOps, action.operations);\n        this.applyRemoteOperation(action, localStartOffset, selectionLength);\n        this.updateVersion(action.version);\n        this.documentEditor.editorModule.isRemoteAction = false;\n        if (this.documentEditor.editorHistoryModule.canUndo()) {\n            this.documentEditor.editorHistoryModule.undoStack.length = 0;\n        }\n        if (this.documentEditor.editorHistoryModule.canRedo()) {\n            this.documentEditor.editorHistoryModule.redoStack.length = 0;\n        }\n    };\n    CollaborativeEditingHandler.prototype.transform = function (operation, remoteOperation) {\n        for (var i = 0; i < remoteOperation.length; i++) {\n            var remoteData = remoteOperation[i];\n            if (operation.length > 0) {\n                for (var j = 0; j < operation.length; j++) {\n                    for (var k = 0; k < operation[j].length; k++) {\n                        var localOperation = operation[j][k];\n                        this.transformSelectionOperation(localOperation, remoteData);\n                        var previousOffset = remoteData.offset;\n                        this.transformOperation(localOperation, remoteData, remoteOperation);\n                        this.logMessage('Transformed offset:' + (remoteData.offset - previousOffset));\n                    }\n                }\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.skipAction = function (remoteOperation) {\n        for (var i = 0; i < remoteOperation.length; i++) {\n            var data = remoteOperation[i];\n            data.length = 0;\n            data.skipOperation = true;\n        }\n    };\n    CollaborativeEditingHandler.prototype.applyRemoteOperation = function (action, offset, selectionLength) {\n        var currentUser = this.documentEditor.currentUser;\n        var bookmarks = [];\n        var currentEditMode = this.documentEditor.commentReviewPane.commentPane.isEditMode;\n        var currenteditorHistory = this.documentEditor.editorHistoryModule.lastOperation;\n        var currentTextArea;\n        if (!isNullOrUndefined(this.documentEditor.commentReviewPane.commentPane.currentEditingComment)) {\n            currentTextArea = this.documentEditor.commentReviewPane.commentPane.currentEditingComment.textArea;\n        }\n        for (var i = 0; i < action.operations.length; i++) {\n            var markerData = action.operations[i].markerData;\n            var tableLength = undefined;\n            var trackingCurrentValue = this.documentEditor.enableTrackChanges;\n            if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.author)) {\n                this.documentEditor.currentUser = markerData.author;\n            }\n            if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.isSkipTracking) && markerData.isSkipTracking && this.documentEditor.enableTrackChanges) {\n                this.documentEditor.skipSettingsOps = true;\n                this.documentEditor.enableTrackChanges = false;\n            }\n            if (action.operations[i].skipOperation || (!isNullOrUndefined(action.operations[i].markerData) && action.operations[i].markerData.skipOperation)) {\n                continue;\n            }\n            if (action.operations[i].action === 'Update') {\n                if (!isNullOrUndefined(action.operations[i].styleData)) {\n                    var styleData = JSON.parse(action.operations[i].styleData);\n                    this.documentEditor.editor.updateStyleObject(styleData);\n                }\n                continue;\n            }\n            var startOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset, false, false, false);\n            // Code for Comparing the offset calculated using old approach and optimized approach\n            // this.documentEditor.selection.isNewApproach = true;\n            // let newStartOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset, false, false, false);\n            // this.documentEditor.selection.isNewApproach = false;\n            // throwCustomError(startOffset !== newStartOffset, \"New StartIndex \" + newStartOffset + \" and old StartIndex \" + startOffset + \" doesnot match\");\n            var op2 = action.operations[i];\n            var endOffset = startOffset;\n            if (isNullOrUndefined(action.operations[i].action)) {\n                this.documentSettings(action.operations[i]);\n                continue;\n            }\n            if (action.operations[i].action === 'Delete' || action.operations[i].action === 'Format') {\n                //Update endOffset\n                if (!(op2.action === 'Format' && op2.length === 0)) {\n                    this.documentEditor.selectionModule.isEndOffset = true;\n                }\n                endOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset + action.operations[i].length, false, false, false);\n                this.documentEditor.selectionModule.isEndOffset = false;\n                // Code for Comparing the offset calculated using old approach and optimized approach\n                // this.documentEditor.selection.isNewApproach = true;\n                // let newEndOffset = this.getRelativePositionFromAbsolutePosition(action.operations[i].offset + action.operations[i].length, false, false, false);\n                // this.documentEditor.selection.isNewApproach = false;\n                // throwCustomError(endOffset !== newEndOffset, \"New EndIndex \" + newEndOffset + \" and old EndIndex \" + endOffset + \" doesnot match\");\n            }\n            if (op2.action === 'Insert' && (op2.text !== CONTROL_CHARACTERS.Row && op2.text !== CONTROL_CHARACTERS.Cell) && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n                this.documentEditor.selectionModule.select(startOffset, endOffset);\n            }\n            else if (op2.action === 'Delete' && op2.text !== CONTROL_CHARACTERS.Cell && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n                this.documentEditor.selectionModule.select(startOffset, endOffset);\n            }\n            else if (op2.action === 'Format' && (isNullOrUndefined(op2.markerData) || isNullOrUndefined(op2.markerData.isAcceptOrReject))) {\n                this.documentEditor.selectionModule.select(startOffset, endOffset);\n            }\n            if (!isNullOrUndefined(op2.markerData)) {\n                if (!isNullOrUndefined(op2.markerData.revisionForFootnoteEndnoteContent) || !isNullOrUndefined(op2.markerData.revisionId)) {\n                    this.documentEditor.editorModule.revisionData = [];\n                }\n                if (!isNullOrUndefined(op2.markerData.revisionForFootnoteEndnoteContent)) {\n                    this.documentEditor.editorModule.revisionData.push(op2.markerData.revisionForFootnoteEndnoteContent);\n                }\n                if (!isNullOrUndefined(op2.markerData.revisionId)) {\n                    this.documentEditor.editorModule.revisionData.push(op2.markerData);\n                }\n                if (!isNullOrUndefined(op2.markerData.splittedRevisions) && op2.markerData.splittedRevisions.length > 0) {\n                    this.documentEditor.editorModule.revisionData = this.documentEditor.editorModule.revisionData.concat(op2.markerData.splittedRevisions);\n                }\n            }\n            if (!isNullOrUndefined(op2.markerData) && !isNullOrUndefined(op2.markerData.isAcceptOrReject) && op2.markerData.isAcceptOrReject !== '') {\n                var revision = this.documentEditor.editorModule.getRevision(op2.markerData.revisionId);\n                if (revision) {\n                    if (op2.markerData.isAcceptOrReject === 'Accept') {\n                        revision.accept();\n                    }\n                    else if (op2.markerData.isAcceptOrReject === 'Reject') {\n                        revision.reject();\n                    }\n                }\n                continue;\n            }\n            if (op2.action === 'Insert') {\n                if (op2.type === 'Paste') {\n                    this.documentEditor.editorModule.isPasteListUpdated = false;\n                    this.documentEditor.editorModule.pasteContents(HelperMethods.getSfdtDocument(op2.pasteContent));\n                }\n                else if (op2.type === 'PasteToc') {\n                    this.documentEditor.editorModule.isInsertingTOC = true;\n                    this.documentEditor.editorModule.pasteContents(HelperMethods.getSfdtDocument(op2.pasteContent));\n                    this.documentEditor.editorModule.isInsertingTOC = false;\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Image.toString()) {\n                    this.insertImage(op2.imageData);\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'NewPage') {\n                    this.documentEditor.editorModule.insertSectionBreak();\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'Continuous') {\n                    this.documentEditor.editorModule.insertSectionBreak(SectionBreakType.Continuous);\n                }\n                else if (markerData && (op2.text === CONTROL_CHARACTERS.Marker_Start || op2.text === CONTROL_CHARACTERS.Marker_End || op2.text === CONTROL_CHARACTERS.Field_Separator)) {\n                    var element = void 0;\n                    if (markerData.type && markerData.type === 'Bookmark') {\n                        if (op2.text === CONTROL_CHARACTERS.Marker_Start) {\n                            bookmarks = this.documentEditor.editorModule.createBookmarkElements(markerData.bookmarkName);\n                            element = bookmarks[0];\n                            this.documentEditor.documentHelper.isBookmarkInserted = false;\n                            this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n                        }\n                        else {\n                            var bookmark = bookmarks[0];\n                            if (bookmark) {\n                                element = bookmark.reference;\n                                this.documentEditor.documentHelper.isBookmarkInserted = true;\n                                this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n                                this.documentEditor.selectionModule.selectBookmark(markerData.bookmarkName);\n                                bookmark.properties = this.documentEditor.selectionModule.getBookmarkProperties(bookmark);\n                                element.properties = this.documentEditor.selectionModule.getBookmarkProperties(element);\n                            }\n                        }\n                    }\n                    else if (markerData.type && markerData.type === 'EditRange') {\n                        var user = markerData.user;\n                        var id = markerData.editRangeId;\n                        if (op2.text === CONTROL_CHARACTERS.Marker_Start) {\n                            if (this.documentEditor.documentHelper.restrictEditingPane) {\n                                this.documentEditor.documentHelper.restrictEditingPane.addUserDialog.bindListData(user);\n                            }\n                            element = this.documentEditor.editorModule.addEditElement(user, id);\n                            element.columnFirst = parseInt(markerData.columnFirst);\n                            element.columnLast = parseInt(markerData.columnLast);\n                            element.line = this.documentEditor.selectionModule.start.currentWidget;\n                        }\n                        else {\n                            var editRanges = this.documentEditor.documentHelper.editRanges.get(user);\n                            for (var _i = 0, editRanges_1 = editRanges; _i < editRanges_1.length; _i++) {\n                                var editStart = editRanges_1[_i];\n                                if (editStart.editRangeId === id) {\n                                    element = editStart.editRangeEnd;\n                                    element.line = this.documentEditor.selectionModule.start.currentWidget;\n                                    break;\n                                }\n                            }\n                        }\n                        this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [element]);\n                        this.documentEditor.editorModule.fireContentChange();\n                    }\n                    else if (markerData.type && markerData.type === 'Field') {\n                        this.documentEditor.editor.isFieldOperation = true;\n                        var type = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : op2.text === CONTROL_CHARACTERS.Marker_End ? 1 : op2.text === CONTROL_CHARACTERS.Field_Separator ? 2 : undefined;\n                        if (!isNullOrUndefined(type) && isNullOrUndefined(markerData.checkBoxValue)) {\n                            var field = new FieldElementBox(type);\n                            if (type === 0 && !isNullOrUndefined(markerData.formFieldData)) {\n                                var formFieldData = this.documentEditor.editorModule.getFormFieldData(op2.type);\n                                this.documentEditor.parser.parseFormFieldData(0, JSON.parse(markerData.formFieldData), formFieldData);\n                                field.formFieldData = formFieldData;\n                            }\n                            var characterFormat = new WCharacterFormat();\n                            if (op2.format) {\n                                var data_1 = JSON.parse(op2.format);\n                                this.documentEditor.parser.parseCharacterFormat(0, data_1, characterFormat);\n                            }\n                            field.characterFormat.copyFormat(characterFormat);\n                            this.documentEditor.editorModule.initInsertInline(field);\n                        }\n                        else {\n                            var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n                            var inline = inlineObj.element;\n                            if (inline instanceof FieldElementBox) {\n                                this.documentEditor.editorModule.toggleCheckBoxFormField(inline, true, markerData.checkBoxValue);\n                            }\n                        }\n                    }\n                    else if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.commentId)) {\n                        var commentType = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : 1;\n                        var deleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.deletedComments, markerData.commentId);\n                        var ownerDeleteComment = undefined;\n                        if (isNullOrUndefined(deleteComment)) {\n                            deleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.documentEditor.documentHelper.comments, markerData.commentId);\n                            if (isNullOrUndefined(deleteComment) && !isNullOrUndefined(markerData.ownerCommentId)) {\n                                ownerDeleteComment = this.documentEditor.documentHelper.layout.getCommentById(this.documentEditor.documentHelper.comments, markerData.ownerCommentId);\n                                deleteComment = this.documentEditor.documentHelper.layout.getCommentById(ownerDeleteComment.replyComments, markerData.commentId);\n                            }\n                        }\n                        if (!isNullOrUndefined(deleteComment)) {\n                            var item = new CommentCharacterElementBox(commentType);\n                            item.commentId = markerData.commentId;\n                            this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [item]);\n                            item.comment = deleteComment;\n                            var index = this.documentEditor.selectionModule.start.currentWidget.children.indexOf(item);\n                            deleteComment.commentStart = this.documentEditor.selectionModule.start.currentWidget.children[index];\n                        }\n                        else {\n                            var item = new CommentCharacterElementBox(commentType);\n                            item.commentId = markerData.commentId;\n                            this.documentEditor.editorModule.insertElementsInternal(this.documentEditor.selectionModule.start, [item]);\n                            commentType === 0 ? this.commentsStart.push(item) : this.commentsEnd.push(item);\n                        }\n                    }\n                    else if (!isNullOrUndefined(op2.markerData.type) && (op2.markerData.type === 'Footnote' || op2.markerData.type === 'Endnote')) {\n                        if (op2.markerData.type === 'Footnote') {\n                            this.documentEditor.editorModule.insertFootnote();\n                        }\n                        else if (op2.markerData.type === 'Endnote') {\n                            this.documentEditor.editorModule.insertEndnote();\n                        }\n                    }\n                }\n                else if (markerData && !isNullOrUndefined(markerData.dropDownIndex) && op2.type === 'DropDown') {\n                    var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n                    var inline = inlineObj.element;\n                    if (inline instanceof FieldElementBox) {\n                        this.documentEditor.editorModule.updateFormField(inline, markerData.dropDownIndex, false);\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'NewPage') {\n                    this.documentEditor.editorModule.insertSectionBreak();\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Section_Break.toString() && op2.type === 'Continuous') {\n                    this.documentEditor.editorModule.insertSectionBreak(SectionBreakType.Continuous);\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Table) {\n                    i = action.operations.length;\n                    this.buildTable(action.operations);\n                    tableLength = this.getOperationLength(action.operations);\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Row) {\n                    i = action.operations.length;\n                    if (isNullOrUndefined(op2.format)) {\n                        action.operations.reverse();\n                    }\n                    this.buildRow(action.operations);\n                    tableLength = this.getOperationLength(action.operations);\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Cell) {\n                    var paraFormat = undefined;\n                    var charFormat = undefined;\n                    if (op2.type === 'CellFormat') {\n                        if (op2.length > 0) {\n                            paraFormat = action.operations[i - 1].format;\n                            charFormat = action.operations[i - 2].format;\n                        }\n                        this.buildCell(op2, paraFormat, charFormat);\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.PageBreak.toString()) {\n                    this.documentEditor.editorModule.insertPageBreak();\n                }\n                else if (op2.text === CONTROL_CHARACTERS.ColumnBreak.toString()) {\n                    this.documentEditor.editorModule.insertColumnBreak();\n                }\n                else {\n                    if (op2.format) {\n                        var characterFormat = new WCharacterFormat();\n                        var data = JSON.parse(op2.format);\n                        this.documentEditor.parser.parseCharacterFormat(0, data, characterFormat);\n                        this.documentEditor.selectionModule.characterFormat.copyFormat(characterFormat);\n                    }\n                    this.documentEditor.editorModule.insertText(op2.text);\n                }\n            }\n            else if (op2.action === 'Delete') {\n                // if (this.documentEditor.selection.isEmpty && this.documentEditor.selection.start.currentWidget.isLastLine()\n                //     && this.documentEditor.selection.start.offset === this.documentEditor.selection.getLineLength(this.documentEditor.selection.start.currentWidget) + 1) {\n                //     this.documentEditor.selection.start.offset--;\n                //     this.documentEditor.selection.end.offset--;\n                //     //Delete pargaraph marker\n                //     this.documentEditor.editor.delete();\n                // } else {\n                if (op2.text === CONTROL_CHARACTERS.Marker_Start || op2.text === CONTROL_CHARACTERS.Marker_End) {\n                    if (!isNullOrUndefined(markerData) && !isNullOrUndefined(markerData.commentId)) {\n                        var selection = this.documentEditor.selectionModule;\n                        var commentType = op2.text === CONTROL_CHARACTERS.Marker_Start ? 0 : 1;\n                        var deleteComment = void 0;\n                        if (this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element instanceof CommentCharacterElementBox) {\n                            deleteComment = this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element;\n                        }\n                        if (commentType === 1) {\n                            var commentEnd = deleteComment;\n                            if (commentEnd.indexInOwner !== -1) {\n                                this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, selection.start.offset);\n                            }\n                        }\n                        else {\n                            var commentStart = deleteComment;\n                            if (commentStart.indexInOwner !== -1) {\n                                this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, selection.start.offset);\n                            }\n                            commentStart.removeCommentMark();\n                        }\n                    }\n                    else {\n                        var selection = this.documentEditor.selectionModule;\n                        var offset_1 = selection.start.offset - 1;\n                        this.documentEditor.editorModule.removeAtOffset(selection.start.currentWidget, this.documentEditor.selectionModule, offset_1);\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Cell) {\n                    this.buildDeleteCells(op2);\n                }\n                else {\n                    this.documentEditor.editorModule.onBackSpace();\n                }\n                //}\n            }\n            else if (op2.action === 'Format') {\n                if (op2.text === (CONTROL_CHARACTERS.Marker_Start.toString() + CONTROL_CHARACTERS.Marker_End.toString())) {\n                    this.updateOperation(op2);\n                }\n                else if (!isNullOrUndefined(op2.markerData) && !isNullOrUndefined(op2.markerData.revisionId)) {\n                    if (!isNullOrUndefined(op2.markerData.revisionType)) {\n                        if (op2.markerData.revisionType === 'Deletion') {\n                            if (op2.text === CONTROL_CHARACTERS.Row) {\n                                var data_2 = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n                                if (!isNullOrUndefined(data_2.rowWidget)) {\n                                    var row = data_2.rowWidget;\n                                    this.documentEditor.editorModule.trackRowDeletion(row);\n                                    this.documentEditor.trackChangesPane.updateTrackChanges();\n                                    continue;\n                                }\n                            }\n                            this.documentEditor.editorModule.onBackSpace();\n                        }\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Row) {\n                    var data_3 = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n                    if (!isNullOrUndefined(data_3.rowWidget)) {\n                        var table = data_3.rowWidget.ownerTable;\n                        var rowData = JSON.parse(op2.format);\n                        this.documentEditor.documentHelper.owner.parser.parseRowFormat(rowData, data_3.rowWidget.rowFormat, 0);\n                        table.calculateGrid(false);\n                        this.documentEditor.documentHelper.layout.reLayoutTable(table);\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Cell) {\n                    if (op2.type === 'TableFormat') {\n                        var tableData = this.getRelativePositionFromAbsolutePosition(op2.offset, true, false, false);\n                        var table = JSON.parse(op2.format);\n                        this.documentEditor.documentHelper.owner.parser.parseTableFormat(table, tableData.tableWidget.tableFormat, 0);\n                        tableData.tableWidget.calculateGrid(false);\n                        this.documentEditor.documentHelper.layout.reLayoutTable(tableData.tableWidget);\n                    }\n                    if (op2.type === 'RowFormat') {\n                        var rowData = this.getRelativePositionFromAbsolutePosition(op2.offset, false, true, false);\n                        var row = JSON.parse(op2.format);\n                        this.documentEditor.documentHelper.owner.parser.parseRowFormat(row, rowData.rowWidget.rowFormat, 0);\n                    }\n                    if (op2.type === 'CellFormat') {\n                        var cellData = this.getRelativePositionFromAbsolutePosition(op2.offset, false, false, true);\n                        var cell = JSON.parse(op2.format);\n                        this.documentEditor.documentHelper.owner.parser.parseCellFormat(cell, cellData.cellWidget.cellFormat, 0);\n                    }\n                }\n                else if (op2.text === CONTROL_CHARACTERS.Image) {\n                    var inlineObj = this.documentEditor.selectionModule.start.currentWidget.getInline(this.documentEditor.selectionModule.start.offset, 0);\n                    var inline = inlineObj.element;\n                    if (inline instanceof ImageElementBox) {\n                        this.documentEditor.editorModule.onImageFormat(inline, HelperMethods.convertPointToPixel(op2.imageData.width), HelperMethods.convertPointToPixel(op2.imageData.height), op2.imageData.alternativeText);\n                    }\n                }\n                else if (op2.type === 'ListFormat') {\n                    var paragraphFormat = JSON.parse(op2.format);\n                    var format = new WParagraphFormat(undefined);\n                    this.documentEditor.parser.parseParagraphFormat(0, paragraphFormat, format);\n                    this.updateList(op2, format);\n                    var list = this.documentEditor.documentHelper.getListById(paragraphFormat.listFormat.nsid, true);\n                    if (!isNullOrUndefined(list)) {\n                        format.listFormat.listId = list.listId;\n                        format.listFormat.list = list;\n                    }\n                    this.documentEditor.editorModule.onApplyParagraphFormat(op2.text, format.listFormat, false, false);\n                }\n                else if (op2.type === 'RestartNumbering') {\n                    var nsid = this.updateList(op2);\n                    var list = this.documentEditor.documentHelper.getListById(nsid, true);\n                    this.documentEditor.editorModule.restartListAtInternal(this.documentEditor.selectionModule, list.listId, list.nsid);\n                }\n                else if (op2.type === 'ContinueNumbering') {\n                    var paragraphFormat = JSON.parse(op2.format);\n                    var format = new WParagraphFormat(undefined);\n                    this.documentEditor.parser.parseParagraphFormat(0, paragraphFormat, format);\n                    var list = this.documentEditor.documentHelper.getListById(format.listFormat.nsid, true);\n                    if (!isNullOrUndefined(list)) {\n                        format.listFormat.listId = list.listId;\n                        format.listFormat.list = list;\n                    }\n                    this.documentEditor.editorModule.applyContinueNumberingInternal(this.documentEditor.selectionModule, format);\n                }\n                else if (op2.type === 'CharacterFormat') {\n                    this.insertCharaterFormat(op2.type, op2.format);\n                }\n                else if (op2.type === 'ParagraphFormat') {\n                    this.insertParagraphFormat(op2, op2.format);\n                }\n                else if (op2.type === 'TableFormat') {\n                    this.insertTableFormat(op2.text, op2.format, op2.offset);\n                }\n                else if (op2.type === 'SectionFormat') {\n                    this.insertSectionFormat(op2.text, op2.format);\n                }\n                else if (op2.type === 'RowFormat') {\n                    this.insertRowFormat(op2.text, op2.format);\n                }\n                else if (op2.type === 'CellFormat') {\n                    this.insertCellFormat(op2.format);\n                }\n            }\n            this.documentEditor.editorModule.revisionData = undefined;\n            if (this.documentEditor.enableTrackChanges != trackingCurrentValue) {\n                this.documentEditor.skipSettingsOps = true;\n                this.documentEditor.enableTrackChanges = trackingCurrentValue;\n            }\n            this.documentEditor.currentUser = currentUser;\n            var newOffset = this.documentEditor.selectionModule.startOffset;\n            //op2.offset = newOffset;\n            this.updateRemoteSelection(action, this.documentEditor.selectionModule.getAbsolutePositionFromRelativePosition(newOffset));\n            if (!isNullOrUndefined(tableLength)) {\n                var temp = op2.length;\n                op2.length = tableLength;\n                tableLength = temp;\n            }\n            var tranformedOffset = this.transformSection(op2.action, op2, offset)[1];\n            //TODO: Need to handle backward selection.\n            //TODO: Need to optimize the code. Need to transform selection end length based on remove content\n            var tranformedEndOffset = this.transformSection(op2.action, op2, offset + selectionLength)[1];\n            offset = tranformedOffset;\n            this.documentEditor.selectionModule.select(this.getRelativePositionFromAbsolutePosition(tranformedOffset, false, false, false), this.getRelativePositionFromAbsolutePosition(tranformedEndOffset, false, false, false));\n            if (!isNullOrUndefined(tableLength)) {\n                op2.length = tableLength;\n            }\n            this.transformRemoteCursor(action.connectionId, op2, op2.offset);\n            if (!isNullOrUndefined(this.documentEditor.searchModule) && !isNullOrUndefined(this.documentEditor.optionsPaneModule) && this.documentEditor.searchModule.searchResults.length > 0 && this.documentEditor.optionsPaneModule.isOptionsPaneShow) {\n                this.documentEditor.optionsPaneModule.searchIconClickInternal();\n            }\n        }\n        if (this.documentEditor.editor.isFieldOperation) {\n            this.documentEditor.editorModule.layoutWholeDocument();\n            this.documentEditor.editor.isFieldOperation = false;\n        }\n        if (!isNullOrUndefined(this.rowWidget)) {\n            var ownerTable = this.rowWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n            ownerTable.updateRowIndex(0);\n            ownerTable.calculateGrid(true);\n            this.documentEditor.documentHelper.layout.reLayoutTable(ownerTable);\n            this.documentEditor.editorModule.reLayout(this.documentEditor.selectionModule);\n            this.rowWidget = undefined;\n        }\n        if (!isNullOrUndefined(this.table)) {\n            this.table.calculateGrid();\n            this.documentEditor.editorModule.updateTable(this.table);\n            this.documentEditor.editorModule.reLayout(this.documentEditor.selectionModule, true);\n            this.table = undefined;\n        }\n        this.documentEditor.currentUser = currentUser;\n        this.documentEditor.commentReviewPane.commentPane.isEditMode = currentEditMode;\n        this.documentEditor.editorHistoryModule.lastOperation = currenteditorHistory;\n        if (!isNullOrUndefined(this.documentEditor.commentReviewPane.commentPane.currentEditingComment)) {\n            this.documentEditor.commentReviewPane.commentPane.currentEditingComment.textArea = currentTextArea;\n        }\n    };\n    CollaborativeEditingHandler.prototype.updateOperation = function (operation) {\n        var markerData = operation.markerData;\n        if (operation.text === (CONTROL_CHARACTERS.Marker_Start.toString() + CONTROL_CHARACTERS.Marker_End.toString())) {\n            var ownerComment = undefined;\n            var commentToDelete = undefined;\n            if (this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element instanceof CommentCharacterElementBox && operation.offset > 0) {\n                var commentID = this.documentEditor.selection.getElementInfo(this.documentEditor.selection.end.currentWidget, this.documentEditor.selection.end.offset).element.commentId;\n                commentToDelete = this.getComment(commentID);\n            }\n            if (!isNullOrUndefined(commentToDelete) && !(!isNullOrUndefined(markerData.done) && isNullOrUndefined(markerData.date)) && isNullOrUndefined(markerData.isReply)) {\n                if (commentToDelete.text !== markerData.text) {\n                    var commentView = this.documentEditor.commentReviewPane.commentPane.comments.get(commentToDelete);\n                    commentView.commentText.innerText = markerData.text;\n                    commentToDelete.text = markerData.text;\n                    return;\n                }\n            }\n            if (!isNullOrUndefined(commentToDelete)) {\n                if (!isNullOrUndefined(markerData.done) && isNullOrUndefined(markerData.commentAction)) {\n                    if (markerData.done) {\n                        this.documentEditor.editorModule.resolveComment(commentToDelete);\n                    }\n                    else {\n                        this.documentEditor.editorModule.reopenComment(commentToDelete);\n                    }\n                    return;\n                }\n                if (markerData.commentAction === \"remove\") {\n                    var commentView = this.documentEditor.commentReviewPane.commentPane.comments.get(!isNullOrUndefined(ownerComment) ? ownerComment : commentToDelete);\n                    commentView.showDrawer();\n                    this.documentEditor.editorModule.deleteCommentWidget(commentToDelete);\n                    this.deletedComments.push(commentToDelete);\n                    commentView.hideDrawer();\n                }\n                else {\n                    var item = new CommentElementBox(markerData.date);\n                    item.commentId = markerData.commentId;\n                    var commentStart = this.getObjectByCommentId(this.commentsStart, item.commentId);\n                    var commentEnd = this.getObjectByCommentId(this.commentsEnd, item.commentId);\n                    if (!isNullOrUndefined(commentStart) && !isNullOrUndefined(commentEnd)) {\n                        this.documentEditor.editorModule.updateCommentElement(item, commentStart, commentEnd, markerData);\n                        item.ownerComment = commentToDelete;\n                        commentToDelete.replyComments.splice(markerData.commentIndex, 0, item);\n                        this.documentEditor.commentReviewPane.addReply(item, false, false);\n                    }\n                }\n            }\n            else {\n                var item = new CommentElementBox(markerData.date);\n                item.commentId = markerData.commentId;\n                var commentStart = this.getObjectByCommentId(this.commentsStart, item.commentId);\n                var commentEnd = this.getObjectByCommentId(this.commentsEnd, item.commentId);\n                if (!isNullOrUndefined(commentStart) && !isNullOrUndefined(commentEnd)) {\n                    this.documentEditor.editorModule.updateCommentElement(item, commentStart, commentEnd, markerData);\n                    this.documentEditor.editorModule.addCommentWidget(item, true, true, false);\n                    this.commentsStart.splice(this.commentsStart.indexOf(commentStart), 1);\n                    this.commentsEnd.splice(this.commentsEnd.indexOf(commentEnd), 1);\n                    var comment = this.documentEditor.commentReviewPane.commentPane.comments.get(item);\n                    comment.postComment();\n                }\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.getComment = function (commentID) {\n        var collection = this.documentEditor.documentHelper.comments;\n        for (var i = 0; i < collection.length; i++) {\n            var comment = this.documentEditor.documentHelper.layout.getCommentById(collection, commentID);\n            if (isNullOrUndefined(comment)) {\n                for (var j = 0; j < collection[i].replyComments.length; j++) {\n                    var replyComment = this.documentEditor.documentHelper.layout.getCommentById(collection[i].replyComments, commentID);\n                    if (!isNullOrUndefined(replyComment)) {\n                        return replyComment;\n                    }\n                }\n            }\n            else {\n                return comment;\n            }\n        }\n        return null;\n    };\n    CollaborativeEditingHandler.prototype.updateList = function (operation, format) {\n        var nsid = -1;\n        if (operation.listData) {\n            var listData = JSON.parse(operation.listData);\n            if (listData.hasOwnProperty('optimizeSfdt')) {\n                this.documentEditor.parser.keywordIndex = listData.optimizeSfdt ? 1 : 0;\n            }\n            if (!isNullOrUndefined(format)) {\n                var list = this.documentEditor.documentHelper.getListById(format.listFormat.nsid, true);\n                if (isNullOrUndefined(list)) {\n                    this.updateListCollection(listData, this.documentEditor.parser.keywordIndex);\n                }\n                else {\n                    var abstractLists = [];\n                    this.documentEditor.parser.parseAbstractList(listData, abstractLists);\n                    if (!isNullOrUndefined(list.abstractList)) {\n                        if (list.abstractList.levels.length < format.listFormat.listLevelNumber) {\n                            list.abstractList.levels = [];\n                            for (var i = 0; i < abstractLists[0].levels.length; i++) {\n                                list.abstractList.levels.push(abstractLists[0].levels[i]);\n                            }\n                        }\n                    }\n                }\n            }\n            else {\n                if (listData.hasOwnProperty(nsidProperty)) {\n                    nsid = listData[nsidProperty];\n                }\n                this.updateListCollection(listData, this.documentEditor.parser.keywordIndex);\n            }\n        }\n        return nsid;\n    };\n    CollaborativeEditingHandler.prototype.getOperationLength = function (operations) {\n        var length = 0;\n        for (var i = 0; i < operations.length; i++) {\n            if (operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Table || operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Row || operations[parseInt(i.toString(), 10)].text === CONTROL_CHARACTERS.Cell)\n                length += operations[parseInt(i.toString(), 10)].length;\n        }\n        return length;\n    };\n    CollaborativeEditingHandler.prototype.updateListCollection = function (listData, keywordIndex) {\n        var uniqueListId = this.documentEditor.editorModule.getUniqueListOrAbstractListId(true);\n        var uniqueAbsLstId = this.documentEditor.editorModule.getUniqueListOrAbstractListId(false);\n        var _loop_1 = function (k) {\n            var list = listData[listsProperty[keywordIndex]][k];\n            var abstractList = listData[abstractListsProperty[keywordIndex]].filter(function (obj) {\n                return obj[abstractListIdProperty[keywordIndex]] === list[abstractListIdProperty[keywordIndex]];\n            })[0];\n            if (!isNullOrUndefined(abstractList)) {\n                abstractList[abstractListIdProperty[keywordIndex]] = uniqueAbsLstId;\n                list[listIdProperty[keywordIndex]] = uniqueListId;\n                list[abstractListIdProperty[keywordIndex]] = uniqueAbsLstId;\n                uniqueListId++;\n                uniqueAbsLstId++;\n            }\n        };\n        for (var k = 0; k < listData[listsProperty[keywordIndex]].length; k++) {\n            _loop_1(k);\n        }\n        this.documentEditor.parser.parseAbstractList(listData, this.documentEditor.documentHelper.abstractLists);\n        this.documentEditor.parser.parseList(listData, this.documentEditor.documentHelper.lists);\n    };\n    CollaborativeEditingHandler.prototype.getObjectByCommentId = function (collection, commentId) {\n        for (var _i = 0, collection_1 = collection; _i < collection_1.length; _i++) {\n            var obj = collection_1[_i];\n            if (obj.commentId === commentId) {\n                return obj;\n            }\n        }\n        return undefined;\n    };\n    CollaborativeEditingHandler.prototype.transformOperation = function (operation1, operation2, action) {\n        if (operation1.action === 'Insert' && (operation2.action === 'Insert' || operation2.action === 'Format')) {\n            if (operation1.offset < operation2.offset) {\n                operation2.offset = operation2.offset + operation1.length;\n                return [operation1, operation2];\n            }\n            else if (operation1.offset >= operation2.offset && operation2.action !== 'Format') {\n                operation1.offset = operation1.offset + operation2.length;\n                return [operation1, operation2,];\n            }\n        }\n        else if (operation1.action === 'Delete' && (operation2.action === 'Delete' || operation2.action === 'Format')) {\n            if (operation1.offset < operation2.offset) {\n                operation2.offset = operation2.offset - operation1.length;\n                return [operation1, operation2];\n            }\n            else if (operation1.offset > operation2.offset && operation2.action !== 'Format') {\n                operation1.offset = operation1.offset - operation2.length;\n                return [operation1, operation2,];\n            }\n        }\n        else if (operation1.action === 'Insert' && (operation2.action === 'Delete' || operation2.action === 'Format')) {\n            if (operation1.offset <= operation2.offset) {\n                operation2.offset = operation2.offset + operation1.length;\n                return [operation1, operation2];\n            }\n            else if (operation1.offset >= operation2.offset + operation2.length && operation2.action !== 'Format') {\n                operation1.offset = operation1.offset - operation2.length;\n                return [operation1, operation2,];\n            }\n            // Local selection fully encompasses the conflicting selection\n            else if (operation1.offset > operation2.offset && operation1.offset < (operation2.offset + operation2.length)) {\n                operation2.length += operation1.length;\n            }\n        }\n        else if (operation1.action === 'Delete' && (operation2.action === 'Insert' || operation2.action === 'Format')) {\n            if (operation1.offset <= operation2.offset && (operation1.offset + operation1.length) <= operation2.offset) {\n                operation2.offset = operation2.offset - operation1.length;\n            }\n            else if (operation1.offset < operation2.offset && (operation1.offset + operation1.length) >= (operation2.offset + operation2.length)) {\n                if (!isNullOrUndefined(operation2.markerData) && !isNullOrUndefined(operation2.markerData.type) && operation2.markerData.type !== 'Field' && (operation2.text === CONTROL_CHARACTERS.Marker_End || operation2.text === CONTROL_CHARACTERS.Marker_Start)) {\n                    if (!isNullOrUndefined(operation2.markerData.commentId) && operation2.text === CONTROL_CHARACTERS.Marker_End) {\n                        this.skipAction(action);\n                        return [operation1, operation2];\n                    }\n                    var conflictLenth = operation2.offset - operation1.offset;\n                    operation2.offset -= conflictLenth;\n                }\n                else {\n                    //Skip insert operation\n                    operation2.length = 0;\n                    operation2.skipOperation = true;\n                    if (!isNullOrUndefined(operation2.markerData) && !isNullOrUndefined(operation2.markerData.type) && operation2.markerData.type === 'Field' && (operation2.text === CONTROL_CHARACTERS.Marker_Start || operation2.text === CONTROL_CHARACTERS.Marker_End)) {\n                        this.skipAction(action);\n                    }\n                }\n            }\n            else if (operation1.offset <= operation2.offset && operation2.action == \"Insert\" && (operation1.offset + operation1.length) >= operation2.offset) {\n                this.skipAction(action);\n            }\n            else if (operation1.offset > operation2.offset && operation2.action !== 'Format') {\n                operation1.offset = operation1.offset + operation2.length;\n            }\n        }\n        // else {\n        //     throw new Error(`Invalid operation types: ${operation1.action}, ${operation2.action}`);\n        // }\n        return [operation1, operation2];\n    };\n    CollaborativeEditingHandler.prototype.transformSection = function (action, operation1, operation2) {\n        if (action === 'Insert') {\n            if (operation1.offset < operation2) {\n                return [operation1.offset, operation2 + operation1.length];\n            }\n            // else if (operation1.offset > operation2.offset) {\n            //     return [\n            //         operation1.offset + operation2.length,\n            //         operation2.offset,\n            //     ];\n            // }\n        }\n        else if (action === 'Delete') {\n            if (operation1.offset <= operation2) {\n                return [operation1.offset, operation2 - operation1.length];\n            }\n        }\n        return [operation1.offset, operation2];\n    };\n    CollaborativeEditingHandler.prototype.transformRemoteCursor = function (connectionId, operation, offset) {\n        if (this.documentEditor.editorModule.isIncrementalSave) {\n            return;\n        }\n        this.updateCaretPosition(connectionId, operation);\n    };\n    /**\n     * @private\n     * @returns {void}\n    */\n    CollaborativeEditingHandler.prototype.updateCaretPosition = function (connectionId, operation) {\n        var keys = Object.keys(this.userMap);\n        var tranformedOffset;\n        //For loop to iterate over the keys\n        for (var i = 0; i < keys.length; i++) {\n            var key = keys[i];\n            if (key === connectionId) {\n                continue;\n            }\n            if (!isNullOrUndefined(operation)) {\n                var remoteOffset = this.userMap[key].offset;\n                tranformedOffset = this.transformSection(operation.action, operation, remoteOffset)[1];\n                this.userMap[key].offset = tranformedOffset;\n            }\n            else {\n                tranformedOffset = this.userMap[key].offset;\n            }\n            this.updateCaretPositionInteral(this.userMap[key].caret, tranformedOffset);\n        }\n    };\n    CollaborativeEditingHandler.prototype.updateRemoteSelection = function (data, removeOffset) {\n        if (this.documentEditor.editorModule.isIncrementalSave) {\n            return;\n        }\n        if (data.connectionId) {\n            var color = '';\n            var caret = void 0;\n            if (this.userMap[data.connectionId] !== undefined) {\n                color = this.userMap[data.connectionId].color;\n                caret = this.userMap[data.connectionId].caret;\n            }\n            else {\n                color = this.getColorForMember(Math.random() * 100);\n                caret = createElement('div', { className: 'e-de-blink-cursor', styles: ('position:absolute;border-left: 2px solid ' + color) });\n                this.userMap[data.connectionId] = new CaretInfo(color, caret, removeOffset, data.currentUser);\n            }\n            this.userMap[data.connectionId].offset = removeOffset;\n            this.updateCaretPositionInteral(caret, removeOffset);\n        }\n    };\n    CollaborativeEditingHandler.prototype.removeCarets = function (connectionId) {\n        if (this.userMap[connectionId] !== undefined) {\n            this.userMap[connectionId].caret.remove();\n            delete this.userMap[connectionId];\n        }\n    };\n    CollaborativeEditingHandler.prototype.getColorForMember = function (randonNumber) {\n        var colorValue = randonNumber % 20;\n        return \"hsl(\" + (colorValue * 360 / 7) % 360 + \", 100%, 35%)\";\n    };\n    CollaborativeEditingHandler.prototype.updateCaretPositionInteral = function (caret, start) {\n        var zoomFactor = this.documentEditor.zoomFactor;\n        var selection = this.documentEditor.selectionModule;\n        var startPos = selection.getTextPosBasedOnLogicalIndex(this.getRelativePositionFromAbsolutePosition(start, false, false, false));\n        //let endPos: TextPosition = selection.getTextPosBasedOnLogicalIndex(end);\n        var caretPosition = startPos.location;\n        //if (startPos.isInSameParagraph(endPos)) {\n        caret.style.display = 'block';\n        if (!caret.parentElement) {\n            this.documentEditor.documentHelper.viewerContainer.appendChild(caret);\n        }\n        var page = selection.getSelectionPage(startPos);\n        if (page) {\n            caret.style.left = page.boundingRectangle.x + (Math.round(caretPosition.x) * zoomFactor) + 'px';\n            var caretInfo = selection.updateCaretSize(startPos);\n            var topMargin = caretInfo.topMargin;\n            caret.style.height = (caretInfo.height * zoomFactor) + 'px';\n            var pageTop = selection.getPageTop(page);\n            caret.style.top = pageTop + Math.round(caretPosition.y + topMargin) * zoomFactor + 'px';\n            if (selection.characterFormat.baselineAlignment === 'Subscript') {\n                caret.style.top = parseFloat(caret.style.top) + (parseFloat(caret.style.height) / 2) + 'px';\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.getBlockPosition = function (offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted) {\n        var paragraph;\n        if (block instanceof ParagraphWidget) {\n            // let paraLength: number = block.length;\n            // Code for Comparing the offset calculated using old approach and optimized approach\n            // if (this.documentEditor.selection.getParagraphLength(block) + 1 == block.length && currentLength + paraLength < offset && currentLength + paraLength + 1 < offset && this.documentEditor.selection.isNewApproach) {\n            //     currentLength += paraLength;\n            // } else {\n            var absoluteData = this.getBlockTotalLength(offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted);\n            // length = block.getTotalLength() + 1;\n            // paragraph = block;\n            if (completed.done) {\n                completed.done = true;\n                return absoluteData;\n            }\n            else {\n                //Add paragraph mark length\n                currentLength = absoluteData.currentLength;\n                offset = absoluteData.offset;\n                paragraph = absoluteData.paragraph;\n            }\n            // }\n        }\n        else if (block instanceof TableWidget) {\n            // Table start mark length\n            offset -= 1;\n            if (offset === currentLength) {\n                if (isTableInserted || this.documentEditor.selectionModule.isEndOffset) {\n                    completed.done = true;\n                    return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'tableWidget': block };\n                }\n            }\n            var row = block.firstChild;\n            while (row) {\n                // Row mark length\n                offset -= 1;\n                if (offset === currentLength) {\n                    if (isRowInserted || this.documentEditor.selectionModule.isEndOffset) {\n                        completed.done = true;\n                        var index = row.index;\n                        return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'rowOrCellIndex': index, 'rowWidget': row };\n                    }\n                    else if (isCellInserted) {\n                        completed.done = true;\n                        var cellWidget = paragraph.associatedCell;\n                        var index = cellWidget.cellIndex + 1;\n                        return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'rowOrCellIndex': index, 'cellWidget': cellWidget };\n                    }\n                }\n                var cell = row.firstChild;\n                while (cell) {\n                    // Cell mark length\n                    offset -= 1;\n                    if (offset === currentLength) {\n                        if (isCellInserted) {\n                            completed.done = true;\n                            var index = cell.cellIndex;\n                            return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'rowOrCellIndex': index, 'cellWidget': cell };\n                        }\n                    }\n                    var childBlock = cell.firstChild;\n                    while (childBlock) {\n                        var data = this.getBlockPosition(offset, currentLength, childBlock, completed, isTableInserted, isRowInserted, isCellInserted);\n                        if (completed.done) {\n                            if (isRowInserted && isNullOrUndefined(data.rowWidget)) {\n                                completed.done = true;\n                                var rowWidget = cell.ownerRow;\n                                var index = rowWidget.index + 1;\n                                return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'rowOrCellIndex': index, 'rowWidget': rowWidget };\n                            }\n                            else if (isCellInserted && isNullOrUndefined(data.cellWidget)) {\n                                completed.done = true;\n                                var cellWidget = cell;\n                                var index = cellWidget.cellIndex + 1;\n                                return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph, 'rowOrCellIndex': index, 'cellWidget': cellWidget };\n                            }\n                            else {\n                                return data;\n                            }\n                        }\n                        else {\n                            offset = data.offset;\n                            currentLength = data.currentLength;\n                            paragraph = data.paragraph;\n                        }\n                        childBlock = childBlock.getSplitWidgets().pop().nextRenderedWidget;\n                    }\n                    cell = cell.nextWidget;\n                }\n                var tableIndex = row.ownerTable.index;\n                row = row.getSplitWidgets().pop().nextRenderedWidget;\n                if (row && row.ownerTable.index !== tableIndex) {\n                    row = undefined;\n                }\n            }\n        }\n        return { 'offset': offset, 'currentLength': currentLength, 'paragraph': paragraph };\n    };\n    CollaborativeEditingHandler.prototype.getBlockTotalLength = function (offset, currentLength, block, completed, isTableInserted, isRowInserted, isCellInserted) {\n        var splittedWidget = block.getSplitWidgets();\n        //Paragraph start offset\n        var paragraphStartLength = 1;\n        var length = 0;\n        if (currentLength + paragraphStartLength >= offset) {\n            completed.done = true;\n            return { 'offset': offset - 1, 'currentLength': currentLength, 'paragraph': block };\n        }\n        var childBlockLength = 0;\n        for (var i = 0; i < splittedWidget.length; i++) {\n            for (var j = 0; j < splittedWidget[i].childWidgets.length; j++) {\n                var line = splittedWidget[i].childWidgets[j];\n                for (var k = 0; k < line.children.length; k++) {\n                    var element = line.children[k];\n                    if (element instanceof ListTextElementBox) {\n                        continue;\n                    }\n                    if ((element instanceof ShapeElementBox && !isNullOrUndefined(element.textFrame) && element.textFrame.childWidgets.length > 0)\n                        || element instanceof FootnoteElementBox) {\n                        var absoluteData = void 0;\n                        if (element instanceof ShapeElementBox) {\n                            var currentLengthValue = currentLength + childBlockLength + length + paragraphStartLength;\n                            for (var i_1 = 0; i_1 < element.textFrame.childWidgets.length; i_1++) {\n                                absoluteData = this.getBlockPosition(offset, currentLengthValue, element.textFrame.childWidgets[i_1], completed, isTableInserted, isRowInserted, isCellInserted);\n                                currentLengthValue = absoluteData.currentLength;\n                                offset = absoluteData.offset;\n                            }\n                        }\n                        else {\n                            var currentLengthValue = currentLength + childBlockLength + length + paragraphStartLength;\n                            for (var m = 0; m < element.bodyWidget.childWidgets.length && !completed.done; m++) {\n                                absoluteData = this.getBlockPosition(offset, currentLengthValue, element.bodyWidget.childWidgets[m], completed, isTableInserted, isRowInserted, isCellInserted);\n                                currentLengthValue = absoluteData.currentLength;\n                                offset = absoluteData.offset;\n                            }\n                        }\n                        offset = absoluteData.offset;\n                        childBlockLength += (absoluteData.currentLength - (currentLength + length + paragraphStartLength + childBlockLength));\n                        if (completed.done) {\n                            currentLength = absoluteData.currentLength;\n                            return absoluteData;\n                        }\n                    }\n                    length += element.length;\n                    // this element is present in the widget. so for select insermenting the lenth to offset\n                    offset += element.skipformFieldLength ? element.length : 0;\n                    if (currentLength + childBlockLength + length + paragraphStartLength >= offset) {\n                        completed.done = true;\n                        return { 'offset': offset - 1, 'currentLength': currentLength + childBlockLength, 'paragraph': block };\n                    }\n                }\n            }\n        }\n        if (currentLength + childBlockLength + length + paragraphStartLength + 1 == offset && this.documentEditor.selection.isEndOffset) {\n            completed.done = true;\n            return { 'offset': offset - 1, 'currentLength': currentLength + childBlockLength, 'paragraph': block };\n        }\n        else {\n            currentLength += (length + childBlockLength + paragraphStartLength);\n            return { 'offset': offset, 'currentLength': currentLength, 'paragraph': block };\n        }\n    };\n    CollaborativeEditingHandler.prototype.getRelativePositionFromAbsolutePosition = function (offset, isTableInserted, isRowInserted, isCellInserted) {\n        var documentEditor = this.documentEditor;\n        var block = this.documentEditor.documentHelper.pages[0].bodyWidgets[0].childWidgets[0];\n        var currentLength = 0;\n        var positionInfo = { done: false };\n        var blockObj = this.getBlockByIndex(block, offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n        if (positionInfo.done) {\n            var paraOffset = blockObj.offset - blockObj.currentLength;\n            if (paraOffset < 0) {\n                paraOffset = 0;\n            }\n            var paragraphInfo = {\n                paragraph: blockObj.paragraph,\n                offset: paraOffset,\n            };\n            if (isTableInserted || isRowInserted || isCellInserted) {\n                return blockObj;\n            }\n            else {\n                return documentEditor.selectionModule.getHierarchicalIndex(paragraphInfo.paragraph, paragraphInfo.offset.toString());\n            }\n        }\n        else if (blockObj.offset === blockObj.currentLength + 1 && this.documentEditor.selection.isEndOffset) {\n            var length_1 = this.documentEditor.selection.getParagraphLength(blockObj.paragraph);\n            currentLength = blockObj.currentLength - length_1;\n            return documentEditor.selection.getHierarchicalIndex(blockObj.paragraph, (blockObj.offset - currentLength).toString());\n        }\n        var blockObj1 = this.getBlockIndexFromHeaderFooter(blockObj.offset, blockObj.currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n        if (positionInfo.done) {\n            var paraOffset = blockObj1.offset - blockObj1.currentLength;\n            if (paraOffset < 0) {\n                paraOffset = 0;\n            }\n            var paragraphInfo = {\n                paragraph: blockObj1.paragraph,\n                offset: paraOffset,\n            };\n            if (isTableInserted || isRowInserted || isCellInserted) {\n                return blockObj1;\n            }\n            else {\n                return documentEditor.selectionModule.getHierarchicalIndex(paragraphInfo.paragraph, paragraphInfo.offset.toString());\n            }\n        }\n        return '';\n    };\n    CollaborativeEditingHandler.prototype.getBlockIndexFromHeaderFooter = function (offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted) {\n        //Iterate header/footer content;\n        var blockObj;\n        var headersFooters = this.documentEditor.documentHelper.headersFooters;\n        for (var _i = 0, headersFooters_1 = headersFooters; _i < headersFooters_1.length; _i++) {\n            var headerFooter = headersFooters_1[_i];\n            for (var i = 0; i < 6; i++) {\n                var currentHeaderFooter = headerFooter[i];\n                if (currentHeaderFooter) {\n                    blockObj = this.getBlockByIndex(currentHeaderFooter.childWidgets[0], offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n                    currentLength = blockObj.currentLength;\n                    offset = blockObj.offset;\n                    if (positionInfo.done) {\n                        return blockObj;\n                    }\n                }\n                else {\n                    if (currentLength + 1 >= offset) {\n                        positionInfo.done = true;\n                        return blockObj;\n                    }\n                    //Insert new header footer and paragraph to existing collection.\n                    currentLength++;\n                    blockObj.currentLength = currentLength;\n                }\n            }\n        }\n        return blockObj;\n    };\n    CollaborativeEditingHandler.prototype.getBlockByIndex = function (block, offset, currentLength, positionInfo, isTableInserted, isRowInserted, isCellInserted) {\n        var blockObj;\n        do {\n            blockObj = this.getBlockPosition(offset, currentLength, block, positionInfo, isTableInserted, isRowInserted, isCellInserted);\n            currentLength = blockObj.currentLength;\n            offset = blockObj.offset;\n            if (positionInfo.done) {\n                return blockObj;\n            }\n            block = block.getSplitWidgets().pop().nextRenderedWidget;\n        } while (block);\n        return blockObj;\n    };\n    CollaborativeEditingHandler.prototype.insertImage = function (imageData) {\n        if (isNullOrUndefined(imageData.metaString)) {\n            this.documentEditor.editorModule.insertImageInternal(imageData.imageString, true, HelperMethods.convertPointToPixel(imageData.width), HelperMethods.convertPointToPixel(imageData.height), imageData.alternativeText);\n        }\n        else {\n            this.documentEditor.editorModule.isImageInsert = true;\n            this.documentEditor.editorModule.insertImageInternal(imageData.metaString, true, HelperMethods.convertPointToPixel(imageData.width), HelperMethods.convertPointToPixel(imageData.height), imageData.alternativeText);\n        }\n    };\n    CollaborativeEditingHandler.prototype.buildTable = function (operations) {\n        var rows = 0;\n        var columns = 0;\n        for (var i = 0; i < operations.length; i++) {\n            if (operations[i].text === CONTROL_CHARACTERS.Row) {\n                if (!isNullOrUndefined(operations[i].markerData)) {\n                    if (isNullOrUndefined(this.documentEditor.editorModule.revisionData)) {\n                        this.documentEditor.editorModule.revisionData = [];\n                    }\n                    this.documentEditor.editorModule.revisionData.push(operations[i].markerData);\n                }\n                rows++;\n            }\n        }\n        for (var i = 0; i < operations.length; i++) {\n            if (operations[i].text === CONTROL_CHARACTERS.Cell) {\n                i += 2;\n                columns++;\n            }\n            if (operations[i].text !== CONTROL_CHARACTERS.Table && (isNullOrUndefined(operations[i + 1]) || operations[i + 1].text === CONTROL_CHARACTERS.Row)) {\n                break;\n            }\n        }\n        this.documentEditor.editorModule.insertTable(rows, columns);\n        this.documentEditor.editorModule.revisionData = undefined;\n    };\n    CollaborativeEditingHandler.prototype.buildRow = function (operations) {\n        var rowData;\n        var cellDatas = [];\n        var paragraphDatas = [];\n        var characterDatas = [];\n        var cellCount = 0;\n        var insertRow = 0;\n        var data = this.getRelativePositionFromAbsolutePosition(operations[0].offset, false, true, false);\n        var tableWidget = data.rowWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n        if (!isNullOrUndefined(operations[0].markerData)) {\n            if (isNullOrUndefined(operations[0].format)) {\n                var row = data.rowWidget;\n                if (row.rowFormat.revisions.length > 0) {\n                    var revision = row.rowFormat.revisions[0];\n                    revision.accept();\n                    return;\n                }\n            }\n        }\n        for (var i = 0; i < operations.length; i++) {\n            var operation = operations[i];\n            if (operation.text === CONTROL_CHARACTERS.Cell) {\n                cellCount++;\n                cellDatas.push(JSON.parse(operation.format));\n                paragraphDatas.push(JSON.parse(operations[i + 1].format));\n                characterDatas.push(JSON.parse(operations[i + 2].format));\n                i += 2;\n            }\n            if (isNullOrUndefined(operations[i + 1]) || operations[i + 1].text === CONTROL_CHARACTERS.Row) {\n                break;\n            }\n        }\n        for (var i = 0; i < operations.length; i++) {\n            if (operations[i].text === CONTROL_CHARACTERS.Row) {\n                if (!isNullOrUndefined(operations[i].markerData)) {\n                    if (isNullOrUndefined(this.documentEditor.editorModule.revisionData)) {\n                        this.documentEditor.editorModule.revisionData = [];\n                    }\n                    this.documentEditor.editorModule.revisionData.push(operations[i].markerData);\n                }\n                insertRow++;\n                rowData = JSON.parse(operations[i].format);\n            }\n        }\n        this.documentEditor.editorModule.rowInsertionForCE(data.rowOrCellIndex, cellCount, insertRow, tableWidget, rowData, cellDatas, paragraphDatas, characterDatas);\n        cellDatas = [];\n        paragraphDatas = [];\n        characterDatas = [];\n        this.documentEditor.editorModule.revisionData = undefined;\n    };\n    CollaborativeEditingHandler.prototype.buildCell = function (operation, paraFormt, charFormat) {\n        var data = this.getRelativePositionFromAbsolutePosition(operation.offset, false, false, true);\n        if (operation.length > 0) {\n            this.rowWidget = data.cellWidget.ownerRow;\n            this.documentEditor.editorModule.cellInsertionForCE(data.rowOrCellIndex, this.rowWidget, JSON.parse(operation.format), JSON.parse(paraFormt), JSON.parse(charFormat));\n        }\n        else {\n            this.documentEditor.documentHelper.owner.parser.parseCellFormat(JSON.parse(operation.format), data.cellWidget.cellFormat, 0);\n        }\n    };\n    CollaborativeEditingHandler.prototype.buildDeleteCells = function (operation) {\n        var data = this.getRelativePositionFromAbsolutePosition(operation.offset, false, false, true);\n        if (!isNullOrUndefined(data.cellWidget)) {\n            var firstPara = this.documentEditor.selectionModule.getFirstParagraph(data.cellWidget);\n            var lastPara = this.documentEditor.selectionModule.getLastParagraph(data.cellWidget);\n            if (!isNullOrUndefined(firstPara) && !isNullOrUndefined(lastPara)) {\n                this.documentEditor.selectionModule.start.setPosition(firstPara.firstChild, true);\n                this.documentEditor.selectionModule.end.setPositionParagraph(lastPara.lastChild, lastPara.lastChild.getEndOffset() + 1);\n            }\n            this.documentEditor.editorModule.checkAndRemoveComments();\n            this.table = data.cellWidget.ownerTable.combineWidget(this.documentEditor.viewer);\n            var paragraph = undefined;\n            if (data.cellWidget.nextWidget) {\n                var nextCell = data.cellWidget.nextWidget;\n                paragraph = this.documentEditor.selectionModule.getFirstParagraph(nextCell);\n            }\n            else if (data.cellWidget.previousWidget) {\n                var previousCell = data.cellWidget.previousWidget;\n                paragraph = this.documentEditor.selectionModule.getFirstParagraph(previousCell);\n            }\n            if (isNullOrUndefined(paragraph)) {\n                paragraph = this.documentEditor.editorModule.getParagraphForSelection(this.table);\n            }\n            operation.length += this.documentEditor.editorModule.onDeleteColumn(this.table, [data.cellWidget]);\n            this.table.updateRowIndex(0);\n            this.documentEditor.selectionModule.selectParagraphInternal(paragraph, true);\n        }\n    };\n    CollaborativeEditingHandler.prototype.transformSelectionOperation = function (operation, conflictingOperation) {\n        if (operation.action === 'Delete' && conflictingOperation.action === 'Delete') {\n            var previousStart = conflictingOperation.offset;\n            var conflictingSelection = conflictingOperation;\n            // Case 1: No overlap, no conflict\n            if ((operation.offset + operation.length) <= conflictingSelection.offset || operation.offset >= (conflictingSelection.offset + conflictingSelection.length)) {\n                return;\n            }\n            // Case 2: Local selection is completely within the conflicting selection\n            if (operation.offset >= conflictingSelection.offset && (operation.offset + operation.length) <= (conflictingSelection.offset + conflictingSelection.length)) {\n                conflictingOperation.offset = conflictingOperation.offset;\n                conflictingOperation.length -= operation.length;\n                if (conflictingOperation.length <= 0) {\n                    conflictingOperation.skipOperation = true;\n                }\n                return;\n            }\n            // Case 3: Local selection overlaps from the left side\n            if (operation.offset < conflictingSelection.offset && (operation.offset + operation.length) <= (conflictingSelection.offset + conflictingSelection.length)) {\n                conflictingOperation.offset = operation.offset + operation.length;\n                conflictingOperation.length -= conflictingOperation.offset - previousStart;\n                //return transformedOperation;\n                return;\n            }\n            // Case 4: Local selection overlaps from the right side\n            if (operation.offset >= conflictingSelection.offset && (operation.offset + operation.length) > (conflictingSelection.offset + conflictingSelection.length)) {\n                conflictingOperation.length -= (conflictingOperation.offset + conflictingOperation.length) - operation.offset;\n                return;\n            }\n            // Case 5: Local selection fully encompasses the conflicting selection\n            if (operation.offset < conflictingSelection.offset && (operation.offset + operation.length) > (conflictingSelection.offset + conflictingSelection.length)) {\n                conflictingSelection.offset = operation.offset;\n                conflictingSelection.length = 0;\n                conflictingOperation.skipOperation = true;\n                return;\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.documentSettings = function (operation) {\n        this.documentEditor.skipSettingsOps = true;\n        switch (operation.text) {\n            case 'enableTrackChanges':\n                this.documentEditor.enableTrackChanges = operation.enableTrackChanges;\n                break;\n            case 'protection':\n                this.documentEditor.documentHelper.restrictEditingPane.showHideRestrictPane(true);\n                if (!isNullOrUndefined(operation.protectionData.saltValue)) {\n                    if (operation.protectionData.hashValue === '' && operation.protectionData.saltValue === '') {\n                        this.documentEditor.editorModule.protectDocument(operation.protectionData.protectionType);\n                    }\n                    else {\n                        this.documentEditor.editorModule.enforceProtectionAssign(operation.protectionData.saltValue, operation.protectionData.hashValue, operation.protectionData.protectionType);\n                    }\n                }\n                else {\n                    if (isNullOrUndefined(operation.protectionData.hashValue)) {\n                        this.documentEditor.editorModule.unProtectDocument();\n                    }\n                    else {\n                        this.documentEditor.editorModule.validateHashValue(operation.protectionData.hashValue);\n                    }\n                }\n                break;\n        }\n    };\n    CollaborativeEditingHandler.prototype.checkAndRetriveChangesFromServer = function () {\n        var _this = this;\n        if (!this.isSyncServerChanges) {\n            var action = {\n                version: this.version,\n                connectionId: this.connectionId,\n                roomName: this.roomName,\n            };\n            var httpRequest = new XMLHttpRequest();\n            httpRequest.open('Post', this.serviceUrl + 'GetActionsFromServer', true);\n            httpRequest.setRequestHeader('Content-Type', 'application/json;charset=UTF-8');\n            this.setCustomAjaxHeaders(httpRequest);\n            httpRequest.onreadystatechange = function () {\n                if (httpRequest.readyState === 4) {\n                    if (httpRequest.status === 200 || httpRequest.status === 304) {\n                        _this.applyChangesFromServer(httpRequest.responseText);\n                    }\n                    else {\n                        alert('Fail to load the document');\n                    }\n                }\n            };\n            httpRequest.send(JSON.stringify(action));\n            this.isSyncServerChanges = true;\n        }\n    };\n    CollaborativeEditingHandler.prototype.applyChangesFromServer = function (data) {\n        var dataObject = JSON.parse(data);\n        if (dataObject.length > 0) {\n            for (var i = 0; i < dataObject.length; i++) {\n                var data_4 = dataObject[i];\n                if (data_4.connectionId === this.connectionId) {\n                    this.acknowledgementReceived();\n                    this.logMessage(this.isSyncServerChanges ? 'SignalR Server sync' + data_4.version : 'SignalR Same user sync:' + data_4.version);\n                }\n                else {\n                    this.handleRemoteOperation(data_4);\n                    this.logMessage('Received: ' + JSON.stringify(JSON.stringify(data_4)));\n                }\n                this.updateVersion(data_4.version);\n                this.logMessage('Server sync ack:' + data_4.version);\n            }\n            this.updateVersion(dataObject[dataObject.length - 1].version);\n        }\n        this.isSyncServerChanges = false;\n        if (!this.isAcknowledgePending()) {\n            this.acknowledgementReceived();\n        }\n        this.sendLocalOperation();\n    };\n    CollaborativeEditingHandler.prototype.insertCharaterFormat = function (type, characterData) {\n        var format = new WCharacterFormat(undefined);\n        var characterFormat = JSON.parse(characterData);\n        var keys = Object.keys(characterFormat);\n        this.documentEditor.documentHelper.owner.parser.parseCharacterFormat(0, characterFormat, format);\n        if (keys.length > 1) {\n            this.documentEditor.documentHelper.owner.fontDialogModule.onCharacterFormat(this.documentEditor.selectionModule, format);\n            this.documentEditor.editorModule.onApplyCharacterFormat('CharacterFormat', format);\n        }\n        else if (keys.length === 1) {\n            if (keys.indexOf('styleName') !== -1) {\n                this.documentEditor.editorModule.applyStyle(characterFormat.styleName, true);\n            }\n            else if (keys.indexOf('allCaps') !== -1) {\n                this.documentEditor.editorModule.changeCase('allCaps');\n            }\n            else if (keys.indexOf('Uppercase') !== -1 || keys.indexOf('Lowercase') !== -1 || keys.indexOf('SentenceCase') !== -1 || keys.indexOf('ToggleCase') !== -1 || keys.indexOf('CapitalizeEachWord') !== -1) {\n                this.documentEditor.editorModule.changeCase(keys[0]);\n            }\n            else {\n                if (type === 'increment' || type === 'decrement') {\n                    this.documentEditor.editorModule.onApplyCharacterFormat(keys[0], type, true);\n                }\n                else {\n                    this.documentEditor.editorModule.onApplyCharacterFormat(keys[0], characterFormat[keys[0]]);\n                }\n            }\n        }\n        else {\n            this.documentEditor.editorModule.clearFormatting();\n        }\n    };\n    CollaborativeEditingHandler.prototype.insertParagraphFormat = function (operation, paragraphData) {\n        var format = new WParagraphFormat(undefined);\n        var paragraphFormat = JSON.parse(paragraphData);\n        var update = false;\n        if (!isNullOrUndefined(paragraphFormat.isFirstParaForList)) {\n            delete paragraphFormat.isFirstParaForList;\n            update = true;\n        }\n        var keys = Object.keys(paragraphFormat);\n        this.documentEditor.documentHelper.owner.parser.parseParagraphFormat(0, paragraphFormat, format);\n        if (keys.length === 1) {\n            if (keys.indexOf('styleName') !== -1) {\n                this.documentEditor.editorModule.applyStyle(paragraphFormat.styleName, true);\n            }\n            else {\n                if (keys[0] === 'borders') {\n                    this.documentEditor.editorModule.onApplyParagraphFormat(keys[0], format.borders, false, false);\n                }\n                else if (keys[0] === 'listFormat') {\n                    this.updateList(operation, format);\n                    var list = this.documentEditor.documentHelper.getListById(paragraphFormat.listFormat.nsid, true);\n                    if (!isNullOrUndefined(list)) {\n                        format.listFormat.listId = list.listId;\n                        format.listFormat.list = list;\n                    }\n                    this.documentEditor.editorModule.onApplyParagraphFormat('listFormat', format.listFormat, false, false);\n                }\n                else {\n                    this.documentEditor.editorModule.onApplyParagraphFormat(keys[0], paragraphFormat[keys[0]], update, false);\n                }\n            }\n        }\n        else {\n            this.documentEditor.documentHelper.owner.paragraphDialogModule.onParagraphFormat(format);\n        }\n    };\n    CollaborativeEditingHandler.prototype.insertTableFormat = function (type, tableData, offset) {\n        var format = new WTableFormat(undefined);\n        var tableFormat = JSON.parse(tableData);\n        var keys = Object.keys(tableFormat);\n        this.documentEditor.documentHelper.owner.parser.parseTableFormat(tableFormat, format, 0);\n        var data = this.getRelativePositionFromAbsolutePosition(offset, true, false, false);\n        var sourceTable = data.tableWidget;\n        if (!isNullOrUndefined(type)) {\n            var typeValue = type === 'TableAutoFitToContents' ? 'FitToContents' : type === 'TableAutoFitToWindow' ? 'FitToWindow' : 'FixedColumnWidth';\n            this.documentEditor.editorModule.insertAutoFitTable(typeValue, sourceTable);\n            return;\n        }\n        if (keys.length === 1) {\n            this.documentEditor.editorModule.onApplyTableFormat(keys[0], tableFormat[keys[0]], sourceTable);\n        }\n        else {\n            if (keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n                this.documentEditor.editorModule.isBordersAndShadingDialog = true;\n                this.documentEditor.editorModule.onTableFormat(format, true, sourceTable);\n                this.documentEditor.editorModule.isBordersAndShadingDialog = false;\n            }\n            else if (keys.indexOf('cellSpacing') !== -1 || keys.indexOf('leftMargin') !== -1 || keys.indexOf('topMargin') !== -1 || keys.indexOf('rightMargin') !== -1 || keys.indexOf('bottomMargin') !== -1) {\n                this.documentEditor.documentHelper.owner.tableOptionsDialogModule.applySubTableOptions(format, sourceTable);\n            }\n            else {\n                this.documentEditor.editorModule.onTableFormat(format, false, sourceTable);\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.insertRowFormat = function (property, rowData) {\n        var format = new WRowFormat(undefined);\n        var rowFormat = JSON.parse(rowData);\n        var keys = Object.keys(rowFormat);\n        this.documentEditor.documentHelper.owner.parser.parseRowFormat(rowFormat, format, 0);\n        if (keys.length === 1) {\n            this.documentEditor.editorModule.onApplyTableRowFormat(keys[0], rowFormat[keys[0]]);\n        }\n        else {\n            this.documentEditor.editorModule.onRowFormat(format);\n        }\n    };\n    CollaborativeEditingHandler.prototype.insertCellFormat = function (cellData) {\n        if (!this.documentEditor.selectionModule.start.paragraph.isInsideTable) {\n            return;\n        }\n        var format = new WCellFormat(undefined);\n        var formatCell = JSON.parse(cellData);\n        var keys = Object.keys(formatCell);\n        this.documentEditor.documentHelper.owner.parser.parseCellFormat(formatCell, format, 0);\n        var cellFormat = this.documentEditor.selectionModule.start.paragraph.associatedCell.cellFormat;\n        if (keys.length === 1) {\n            if (keys[0] === 'shading') {\n                this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], format.shading, cellFormat);\n            }\n            else if (keys[0] === 'borders') {\n                this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], format.borders, cellFormat);\n            }\n            else {\n                this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, keys[0], cellFormat[keys[0]], cellFormat);\n            }\n        }\n        else {\n            if (keys.indexOf('preferredWidth') !== -1 || keys.indexOf('preferredWidthType') !== -1 || keys.indexOf('verticalAlignment') !== -1 || keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n                if (keys.indexOf('borders') !== -1 || keys.indexOf('shading') !== -1) {\n                    this.documentEditor.editorModule.isBordersAndShadingDialog = true;\n                }\n                this.documentEditor.editorModule.applyCellPropertyValue(this.documentEditor.selectionModule, undefined, format, cellFormat);\n                this.documentEditor.editorModule.isBordersAndShadingDialog = false;\n            }\n            else {\n                this.documentEditor.documentHelper.owner.cellOptionsDialogModule.applySubCellOptions(format);\n            }\n        }\n    };\n    CollaborativeEditingHandler.prototype.insertSectionFormat = function (property, sectionData) {\n        var data = JSON.parse(sectionData);\n        var keys = Object.keys(data);\n        if (keys[0] === 'linkToPrevious') {\n            var headerFooterWidget = this.documentEditor.selectionModule.start.paragraph.bodyWidget;\n            var sectionIndex = headerFooterWidget.sectionIndex;\n            var headerFooterType = headerFooterWidget.headerFooterType;\n            this.documentEditor.editorModule.removeInlineHeaderFooterWidget(sectionIndex, headerFooterType, property, data['linkToPrevious']);\n        }\n        else if (keys.length > 1) {\n            var sectionFormat = new WSectionFormat();\n            this.documentEditor.documentHelper.owner.parser.parseSectionFormat(0, data, sectionFormat);\n            this.documentEditor.editorModule.onApplySectionFormat(undefined, sectionFormat);\n        }\n        else {\n            this.documentEditor.editorModule.onApplySectionFormat(Object.keys(data)[0], data[Object.keys(data)[0]]);\n        }\n    };\n    CollaborativeEditingHandler.prototype.logMessage = function (event) {\n        if (this.logEventEnabled) {\n            this.message += event + ' ' + '\\n';\n        }\n    };\n    CollaborativeEditingHandler.prototype.setCustomAjaxHeaders = function (xmlHttpRequest) {\n        for (var i = 0; i < this.documentEditor.headers.length; i++) {\n            var header = this.documentEditor.headers[i];\n            for (var _i = 0, _a = Object.keys(header); _i < _a.length; _i++) {\n                var key = _a[_i];\n                xmlHttpRequest.setRequestHeader(key, header[key]);\n            }\n        }\n    };\n    /**\n     * Destory collaborative editing module.\n     * @private\n     */\n    CollaborativeEditingHandler.prototype.destroy = function () {\n        this.version = undefined;\n        this.documentEditor = undefined;\n        this.roomName = undefined;\n        this.userMap = undefined;\n        this.connectionId = undefined;\n        this.acknowledgmentPending = undefined;\n        this.pendingOps = undefined;\n        this.serviceUrl = undefined;\n        this.isSyncServerChanges = undefined;\n        this.message = undefined;\n        this.rowWidget = undefined;\n    };\n    return CollaborativeEditingHandler;\n}());\nexport { CollaborativeEditingHandler };\n/**\n * @private\n */\nvar CaretInfo = /** @class */ (function () {\n    function CaretInfo(color, caret, offset, userName) {\n        this.color = color;\n        this.caret = caret;\n        this.offset = offset;\n        this.userName = userName;\n        this.initializeElement();\n    }\n    /**\n     * @private\n     */\n    CaretInfo.prototype.initializeElement = function () {\n        this.hoverDiv = createElement('div', { className: 'e-de-user-info e-de-user-name-collapse', styles: 'z-index: 1; visibility: hidden;left:-4px;position:absolute;width:20px;height:20px;pointer-events:all;' });\n        this.userViewContainer = createElement('div');\n        this.spanViewContainer = createElement('div', { styles: 'background-color:' + this.color + ';left: 0px; top: 15px; visibility: visible;' });\n        this.spanView = createElement('span', { styles: 'background-color:' + this.color + '; left: 0px;top:-4px;pointer:default' });\n        this.spanViewContainer.appendChild(this.spanView);\n        this.userViewContainer.appendChild(this.spanViewContainer);\n        this.hoverDiv.appendChild(this.userViewContainer);\n        this.caret.appendChild(this.hoverDiv);\n        this.hoverDiv.addEventListener('mouseenter', this.onMouseEnter.bind(this));\n        this.hoverDiv.addEventListener('mouseleave', this.onMouseLeave.bind(this));\n    };\n    CaretInfo.prototype.onMouseEnter = function () {\n        this.hoverDiv.classList.remove('e-de-user-name-collapse');\n        this.hoverDiv.classList.add('e-de-user-name-expended');\n        this.spanView.innerText = this.userName;\n    };\n    CaretInfo.prototype.onMouseLeave = function () {\n        this.hoverDiv.classList.add('e-de-user-name-collapse');\n        this.hoverDiv.classList.remove('e-de-user-name-expended');\n        this.spanView.innerText = '';\n    };\n    return CaretInfo;\n}());\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}