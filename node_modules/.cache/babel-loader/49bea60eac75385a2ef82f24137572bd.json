{"ast":null,"code":"import { BodyWidget, TableWidget, TableRowWidget, ElementBox, Page } from '../viewer/page';\nimport { TextPosition } from '../selection/selection-helper';\nimport { isNullOrUndefined, L10n } from '@syncfusion/ej2-base';\nimport { WSectionFormat } from '../format/section-format';\nimport { XmlHttpRequestHandler, actionCompleteEvent } from '../../base/index';\nimport { HistoryInfo } from '../editor-history/index';\nimport { DialogUtility } from '@syncfusion/ej2-popups';\nimport { showSpinner, hideSpinner } from '@syncfusion/ej2-popups';\nimport { WCharacterFormat, WRowFormat } from '../format/index';\n/**\n * Represents the collaborative editing module\n */\nvar CollaborativeEditing = /** @class */function () {\n  function CollaborativeEditing(editor) {\n    this.version = 0;\n    this.owner = editor;\n  }\n  Object.defineProperty(CollaborativeEditing.prototype, \"documentHelper\", {\n    //private lockEnd: string = '';\n    get: function () {\n      return this.owner.documentHelper;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CollaborativeEditing.prototype, \"selection\", {\n    get: function () {\n      return this.owner.selectionModule;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(CollaborativeEditing.prototype, \"collaborativeEditingSettings\", {\n    get: function () {\n      return this.owner.documentEditorSettings.collaborativeEditingSettings;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  CollaborativeEditing.prototype.getModuleName = function () {\n    return 'CollaborativeEditing';\n  };\n  /**\n   * To update the action which need to perform.\n   *\n   * @param {CollaborativeEditingEventArgs} data Specifies the data.\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.updateAction = function (data) {\n    if (!Array.isArray(data)) {\n      data = [data];\n    }\n    for (var i = 0; i < data.length; i++) {\n      var documentData = data[parseInt(i.toString(), 10)];\n      switch (documentData.action) {\n        case 'LockContent':\n          // Transform position\n          this.transFormLockRegion(documentData);\n          this.lockRegion(documentData.selectionInfo.start, documentData.selectionInfo.end, documentData.author);\n          break;\n        case 'SaveContent':\n          this.version = documentData.version;\n          this.updateRegion(documentData.author, documentData.data);\n          break;\n        case 'UnlockContent':\n          this.version = documentData.version;\n          this.updateRegion(documentData.author, documentData.data);\n          this.removeEditRange(documentData.author);\n          break;\n      }\n    }\n  };\n  CollaborativeEditing.prototype.transFormLockRegion = function (data) {\n    var previousLockInfo = data.selectionInfo.previousLockInfo;\n    if (!isNullOrUndefined(previousLockInfo)) {\n      var author = previousLockInfo.author;\n      var sectionDiff = 0;\n      var blockDiff = 0;\n      if (this.documentHelper.editRanges.containsKey(author)) {\n        var editRange = this.documentHelper.editRanges.get(author);\n        if (editRange.length > 0) {\n          var position = this.selection.getPosition(editRange[0]);\n          var endOffset = this.selection.getHierarchicalIndexByPosition(position.endPosition).split(';');\n          var previousOffset = previousLockInfo.end.split(';');\n          sectionDiff = parseInt(endOffset[0], 10) - parseInt(previousOffset[0], 10);\n          blockDiff = parseInt(endOffset[1], 10) - parseInt(previousOffset[1], 10);\n          // Same section\n          if (data.selectionInfo.start.split(';')[0] === previousLockInfo.end.split(';')[0]) {\n            data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, blockDiff);\n            data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, blockDiff);\n          } else {\n            data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, 0);\n            data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, 0);\n          }\n        }\n      }\n    }\n  };\n  /**\n   * Lock selected region from editing by other users.\n   *\n   * @param {string} user Specifies the user.\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.lockContent = function (user) {\n    var _this = this;\n    if (this.canLock()) {\n      var start = this.owner.selectionModule.start;\n      var end = this.owner.selectionModule.end;\n      if (!this.owner.selectionModule.isForward) {\n        start = this.owner.selectionModule.end;\n        end = this.owner.selectionModule.start;\n      }\n      if (start.paragraph.isInsideTable) {\n        var table = this.owner.documentHelper.layout.getParentTable(start.paragraph);\n        var firstPara = this.owner.documentHelper.getFirstParagraphBlock(table);\n        start.setPosition(firstPara.childWidgets[0], true);\n      } else {\n        start.paragraphStartInternal(this.owner.selectionModule, false);\n      }\n      if (end.paragraph.isInsideTable) {\n        var table = this.owner.documentHelper.layout.getParentTable(end.paragraph);\n        var lastPara = this.owner.documentHelper.getLastParagraphBlock(table);\n        var offset = lastPara.lastChild.getEndOffset();\n        end.setPositionParagraph(lastPara.lastChild, offset);\n      } else {\n        end.moveToParagraphEndInternal(this.owner.selectionModule, false);\n      }\n      var startOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(start);\n      var endOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(end);\n      var selectionInfo_1 = {\n        start: startOffset,\n        end: endOffset,\n        roomName: this.owner.documentEditorSettings.collaborativeEditingSettings.roomName,\n        author: isNullOrUndefined(user) ? this.owner.currentUser : user,\n        version: this.version\n      };\n      var startInfo_1 = this.selection.getParagraphInfo(start);\n      var endInfo_1 = this.selection.getParagraphInfo(end);\n      this.owner.selectionModule.select(startOffset, endOffset);\n      var ajax = new XmlHttpRequestHandler();\n      ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.canLock;\n      ajax.contentType = 'application/json;charset=UTF-8';\n      ajax.onSuccess = function (result) {\n        _this.successHandler(result, selectionInfo_1, startInfo_1, endInfo_1);\n      };\n      ajax.onFailure = this.failureHandler.bind(this);\n      ajax.onError = this.failureHandler.bind(this);\n      ajax.customHeaders = this.owner.headers;\n      ajax.send(selectionInfo_1);\n    }\n  };\n  /**\n   * @private\n   * @returns {boolean} - Returns can lock.\n   */\n  CollaborativeEditing.prototype.canLock = function () {\n    var editRanges = this.documentHelper.editRanges;\n    if (editRanges.containsKey(this.owner.currentUser)) {\n      return false;\n    }\n    var userNames = editRanges.keys;\n    for (var i = 0; i < userNames.length; i++) {\n      var range = editRanges.get(userNames[parseInt(i.toString(), 10)]);\n      if (!isNullOrUndefined(range) && range.length > 0) {\n        if (this.isSelectionInEditableRange(range[0])) {\n          return false;\n        }\n      }\n    }\n    return true;\n  };\n  CollaborativeEditing.prototype.getPreviousLockedRegion = function () {\n    var editRanges = this.documentHelper.editRanges;\n    if (editRanges.containsKey(this.owner.currentUser)) {\n      return undefined;\n    }\n    var previous;\n    var userNames = editRanges.keys;\n    for (var i = 0; i < userNames.length; i++) {\n      var range = editRanges.get(userNames[parseInt(i.toString(), 10)])[0];\n      var startPosition = this.selection.getPosition(range).startPosition;\n      if (startPosition.isExistBefore(this.selection.start)) {\n        if (isNullOrUndefined(previous)) {\n          previous = range;\n        } else if (startPosition.isExistAfter(this.selection.getPosition(previous).startPosition)) {\n          previous = range;\n        }\n      }\n    }\n    return previous;\n  };\n  /**\n   * @private\n   * @param {string} user - Specifies the user.\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.unlockContent = function (user) {\n    if (this.documentHelper.editRanges.containsKey(user)) {\n      if (this.saveTimer) {\n        clearTimeout(this.saveTimer);\n      }\n      var sfdtContent = JSON.stringify(this.serializeEditableRegion(user));\n      var saveObject = {\n        action: 'UnlockContent',\n        author: user,\n        version: this.version,\n        data: sfdtContent,\n        selectionInfo: {\n          start: '',\n          end: '',\n          roomName: this.collaborativeEditingSettings.roomName,\n          author: this.owner.currentUser,\n          version: this.version\n        },\n        roomName: this.collaborativeEditingSettings.roomName\n      };\n      this.removeEditRange(user);\n      this.owner.editorHistoryModule.clearHistory();\n      this.owner.fireContentChange();\n      // Todo: selection tranformation\n      this.owner.trigger(actionCompleteEvent, saveObject);\n    }\n  };\n  CollaborativeEditing.prototype.removeEditRange = function (user) {\n    if (this.documentHelper.editRanges.containsKey(user)) {\n      this.updateLockRegion(user, false);\n      this.owner.editorModule.removeUserRestrictionsInternal(this.documentHelper.editRanges.get(user)[0]);\n      this.documentHelper.clearContent();\n      this.selection.updateEditRangeCollection();\n      this.documentHelper.owner.viewer.updateScrollBars();\n    }\n  };\n  /**\n   * Save locked content to other clients.\n   *\n   * @private\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.saveContent = function () {\n    var _this = this;\n    if (this.saveTimer) {\n      clearTimeout(this.saveTimer);\n    }\n    var timeOut = this.collaborativeEditingSettings.saveTimeout;\n    if (isNullOrUndefined(timeOut)) {\n      timeOut = 3000;\n    }\n    this.saveTimer = setTimeout(function () {\n      _this.saveContentInternal();\n    }, timeOut);\n  };\n  CollaborativeEditing.prototype.saveContentInternal = function () {\n    if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n      var editRangeStart = this.documentHelper.editRanges.get(this.owner.currentUser)[0];\n      var position = this.selection.getPosition(editRangeStart);\n      var saveObject = {\n        action: 'SaveContent',\n        author: this.owner.currentUser,\n        version: this.version,\n        data: JSON.stringify(this.serializeEditableRegion(this.owner.currentUser)),\n        selectionInfo: {\n          'start': this.selection.getHierarchicalIndexByPosition(position.startPosition),\n          'end': this.selection.getHierarchicalIndexByPosition(position.endPosition),\n          roomName: this.collaborativeEditingSettings.roomName,\n          author: this.owner.currentUser,\n          version: this.version\n        },\n        roomName: this.collaborativeEditingSettings.roomName\n      };\n      this.owner.trigger(actionCompleteEvent, saveObject);\n    }\n  };\n  CollaborativeEditing.prototype.serializeEditableRegion = function (user) {\n    var startElement = this.documentHelper.editRanges.get(user)[0];\n    var endElement = startElement.editRangeEnd;\n    var start = new TextPosition(this.owner);\n    start.setPosition(startElement.line, true);\n    var end = new TextPosition(this.owner);\n    end.setPosition(endElement.line, false);\n    this.owner.sfdtExportModule.isPartialExport = true;\n    /* eslint-disable-next-line max-len */\n    var sfdtContent = this.owner.sfdtExportModule.write(0, start.currentWidget, start.offset, end.currentWidget, end.offset, false);\n    this.owner.sfdtExportModule.isPartialExport = false;\n    return sfdtContent;\n  };\n  /* eslint-disable-next-line max-len */\n  CollaborativeEditing.prototype.successHandler = function (result, selectionInfo, startInfo, endInfo) {\n    var canLock = JSON.parse(result.data).canLock;\n    if (canLock) {\n      selectionInfo.start = this.selection.getHierarchicalIndex(startInfo.paragraph, startInfo.offset.toString());\n      selectionInfo.end = this.selection.getHierarchicalIndex(endInfo.paragraph, endInfo.offset.toString());\n      var previousEditRange = this.getPreviousLockedRegion();\n      if (previousEditRange) {\n        var position = this.selection.getPosition(previousEditRange);\n        selectionInfo.previousLockInfo = {\n          start: this.selection.getHierarchicalIndexByPosition(position.startPosition),\n          end: this.selection.getHierarchicalIndexByPosition(position.endPosition),\n          author: previousEditRange.user,\n          roomName: '',\n          version: 0\n        };\n      }\n      var lockObject = {\n        action: 'LockContent',\n        selectionInfo: selectionInfo,\n        author: this.owner.currentUser,\n        version: this.version,\n        data: '',\n        roomName: this.collaborativeEditingSettings.roomName\n      };\n      this.owner.trigger(actionCompleteEvent, lockObject);\n    } else {\n      var localizeValue = new L10n('documenteditor', this.owner.defaultLocale);\n      localizeValue.setLocale(this.owner.locale);\n      DialogUtility.alert({\n        content: localizeValue.getConstant('Already locked'),\n        closeOnEscape: true,\n        showCloseIcon: true,\n        position: {\n          X: 'Center',\n          Y: 'Center'\n        }\n      }).enableRtl = this.owner.enableRtl;\n    }\n  };\n  CollaborativeEditing.prototype.failureHandler = function () {\n    var localizeValue = new L10n('documenteditor', this.owner.defaultLocale);\n    localizeValue.setLocale(this.owner.locale);\n    DialogUtility.alert({\n      content: localizeValue.getConstant('Error in establishing connection with web server'),\n      closeOnEscape: true,\n      showCloseIcon: true,\n      position: {\n        X: 'Center',\n        Y: 'Center'\n      }\n    }).enableRtl = this.owner.enableRtl;\n  };\n  /**\n   * Locker specified region for specified user.\n   *\n   * @private\n   * @param {string} start - Specified the selection start.\n   * @param {string} end - Specifies the selection end.\n   * @param {string} user - Specifies the user\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.lockRegion = function (start, end, user) {\n    var startPosition = this.selection.getTextPosBasedOnLogicalIndex(start);\n    var endPosition = this.selection.getTextPosBasedOnLogicalIndex(end);\n    this.lockRegionInternal(startPosition, endPosition, user);\n  };\n  CollaborativeEditing.prototype.lockRegionInternal = function (start, end, user) {\n    var editStart = this.owner.editorModule.addEditElement(user);\n    var editEnd = editStart.editRangeEnd;\n    this.insertElements(start, end, [editEnd], [editStart]);\n    this.updateLockInfo(editStart.paragraph, editEnd.paragraph, user, true);\n    this.owner.viewer.updateScrollBars();\n  };\n  CollaborativeEditing.prototype.insertElements = function (start, end, endElements, startElements) {\n    var isSamePara = start.paragraph.equals(end.paragraph);\n    if (!isNullOrUndefined(startElements)) {\n      this.insertElementsInternal(start, startElements);\n    }\n    if (!isNullOrUndefined(endElements)) {\n      this.insertElementsInternal(end, endElements);\n    }\n    this.documentHelper.layout.reLayoutParagraph(startElements[0].paragraph, 0, 0);\n    if (!isSamePara) {\n      this.documentHelper.layout.reLayoutParagraph(endElements[0].paragraph, 0, 0);\n    }\n  };\n  CollaborativeEditing.prototype.insertElementsInternal = function (position, elements) {\n    var indexInInline = 0;\n    if (position.paragraph.isEmpty()) {\n      var paragraph = position.paragraph;\n      paragraph.childWidgets[0].children.push(elements[0]);\n      elements[0].line = paragraph.childWidgets[0];\n    } else {\n      var inlineObj = position.currentWidget.getInline(position.offset, indexInInline);\n      var curInline = inlineObj.element;\n      indexInInline = inlineObj.index;\n      var firstElement = elements[0];\n      this.insertElementInternal(curInline, firstElement, indexInInline);\n      var index = firstElement.indexInOwner;\n      var lastElement = firstElement;\n      for (var i = 1; i < elements.length; i++) {\n        lastElement = elements[parseInt(i.toString(), 10)];\n        firstElement.line.children.splice(index + i, 0, lastElement);\n      }\n    }\n  };\n  CollaborativeEditing.prototype.insertElementInternal = function (element, newElement, index) {\n    var line = element.line;\n    var paragraph = line.paragraph;\n    var insertIndex = element.indexInOwner;\n    var isBidi = paragraph.paragraphFormat.bidi && element.isRightToLeft;\n    if (index === element.length) {\n      // Add new Element in current\n      if (!isBidi) {\n        insertIndex++;\n      }\n      line.children.splice(insertIndex, 0, newElement);\n    } else if (index === 0) {\n      if (isNullOrUndefined(element.previousNode)) {\n        line.children.splice(0, 0, newElement);\n        insertIndex = 0;\n      } else {\n        line.children.splice(insertIndex, 0, newElement);\n      }\n    }\n    newElement.line = element.line;\n  };\n  //#region Save content\n  CollaborativeEditing.prototype.setEditableRegion = function () {\n    if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n      var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n      var editRangeStart = editRanges[0];\n      var firstBlock = this.getParentBlock(editRangeStart.paragraph);\n      this.lockStart = this.owner.selectionModule.getHierarchicalIndex(firstBlock, '0').split(';');\n    }\n  };\n  CollaborativeEditing.prototype.isSelectionInEditableRange = function (editRange) {\n    var _a;\n    if (!isNullOrUndefined(this.owner.selectionModule)) {\n      var start = this.owner.selectionModule.start;\n      var end = this.owner.selectionModule.end;\n      if (!this.owner.selectionModule.isForward) {\n        _a = [end, start], start = _a[0], end = _a[1];\n      }\n      var position = this.owner.selectionModule.getPosition(editRange);\n      if ((start.isExistAfter(position.startPosition) || start.isAtSamePosition(position.startPosition)) && (end.isExistBefore(position.endPosition) || end.isAtSamePosition(position.endPosition)) || (position.startPosition.isExistAfter(start) || position.startPosition.isAtSamePosition(start)) && (position.endPosition.isExistBefore(end) || position.endPosition.isAtSamePosition(end)) || position.startPosition.isExistAfter(start) && position.startPosition.isExistBefore(end) && (end.isExistAfter(position.endPosition) || end.isExistBefore(position.endPosition)) || position.endPosition.isExistBefore(end) && position.endPosition.isExistAfter(start) && (start.isExistBefore(position.startPosition) || start.isExistAfter(position.startPosition))) {\n        return true;\n      }\n    }\n    return false;\n  };\n  /**\n   * Updated modified content from remote user\n   *\n   * @returns {void}\n   */\n  /* eslint-disable  */\n  CollaborativeEditing.prototype.updateRegion = function (user, content) {\n    if (this.documentHelper.editRanges.containsKey(user)) {\n      var editRanges = this.documentHelper.editRanges.get(user);\n      if (editRanges.length === 1) {\n        // Remove exisiting range  from collection.\n        // New range will get inserted while updating the content.\n        this.documentHelper.editRanges.remove(user);\n        editRanges[0].removeEditRangeMark();\n      }\n      // Preserve hierachical position for history position tranformation\n      this.setEditableRegion();\n      var startElement = editRanges[0];\n      var endElement = startElement.editRangeEnd;\n      var firstBlock = this.getParentBlock(startElement.paragraph);\n      var lastBlock = this.getParentBlock(endElement.paragraph);\n      var isInEditRange = this.isSelectionInEditableRange(startElement);\n      var startParagrahInfo = void 0;\n      var endParagrahInfo = void 0;\n      this.owner.editorModule.isRemoveRevision = true;\n      if (!isInEditRange) {\n        startParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.start);\n        endParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.end);\n      }\n      var sections = [];\n      while (lastBlock !== firstBlock) {\n        var currentBlock = lastBlock.combineWidget(this.owner.viewer);\n        lastBlock = currentBlock.previousRenderedWidget;\n        if (lastBlock.bodyWidget.index !== currentBlock.bodyWidget.index) {\n          sections.push(currentBlock.bodyWidget);\n        }\n        var removedBlock = currentBlock.containerWidget.childWidgets[currentBlock.indexInOwner];\n        this.removeDuplicateCollection(removedBlock);\n        currentBlock.containerWidget.removeChild(currentBlock.indexInOwner);\n      }\n      if (!isNullOrUndefined(firstBlock)) {\n        var lastBockIndex = firstBlock.index;\n        var containerWidget = firstBlock.containerWidget;\n        sections.push(containerWidget);\n        var lastInsertIndex = firstBlock.containerWidget.childWidgets.indexOf(firstBlock);\n        var removedBlock = containerWidget.childWidgets[lastInsertIndex];\n        containerWidget.removeChild(lastInsertIndex);\n        this.removeDuplicateCollection(removedBlock);\n        var comments = [];\n        var blocks = [];\n        var revision = [];\n        this.owner.editorModule.isPasteListUpdated = false;\n        this.owner.editorModule.getBlocks(JSON.parse(content), false, blocks, comments, revision);\n        if (sections.length !== blocks.length) {\n          if (sections.length === 1) {\n            var bodyWidget = sections[0];\n            sections.unshift(this.owner.editorModule.splitBodyWidget(bodyWidget, blocks[blocks.length - 2].sectionFormat, bodyWidget.childWidgets[lastInsertIndex - 1]));\n          }\n          if (sections.length < blocks.length) {\n            for (var m = 1; m < blocks.length - 1; m++) {\n              var page = new Page(this.owner.documentHelper);\n              var bodyWidget = new BodyWidget();\n              page.bodyWidgets.push(bodyWidget);\n              bodyWidget.page = page;\n              sections.splice(m, 0, bodyWidget);\n              bodyWidget.index = sections[m - 1].index;\n              bodyWidget.sectionFormat = new WSectionFormat(bodyWidget);\n              bodyWidget.sectionFormat.copyFormat(blocks[m].sectionFormat);\n              var pageIndex = sections[m - 1].page.index;\n              this.documentHelper.insertPage(pageIndex, page);\n              //Todo: update section index\n              this.owner.editorModule.updateSectionIndex(sections[m - 1].sectionFormat, sections[m - 1], true);\n              if (sections.length === blocks.length) {\n                break;\n              }\n            }\n          }\n        }\n        for (var z = 0; z < sections.length; z++) {\n          var containerWidget_1 = sections[z];\n          var blockIndex = 0;\n          var insertIndex = 0;\n          if (z === sections.length - 1) {\n            blockIndex = lastBockIndex;\n            insertIndex = lastInsertIndex;\n          }\n          var block = blocks[z].childWidgets;\n          for (var i = 0; i < block.length; i++) {\n            block[i].containerWidget = containerWidget_1;\n            block[i].index = blockIndex;\n            containerWidget_1.childWidgets.splice(insertIndex, 0, block[i]);\n            insertIndex++;\n            blockIndex++;\n          }\n          lastBlock = block[block.length - 1];\n          if (lastBlock.nextRenderedWidget && lastBlock.nextRenderedWidget.index !== lastBlock.index) {\n            //Todo: update block index properly\n            this.updateNextBlocksIndex(lastBlock, true);\n          }\n          this.documentHelper.layout.layoutBodyWidgetCollection(block[0].index, containerWidget_1, undefined, false);\n        }\n        for (var k = 0; k < comments.length; k++) {\n          var comment = comments[k];\n          this.owner.editorModule.addCommentWidget(comment, false, this.owner.showComments, false);\n          if (comment.replyComments.length > 0) {\n            for (var z = 0; z < comment.replyComments.length; z++) {\n              this.owner.commentReviewPane.addReply(comment.replyComments[z], false, false);\n            }\n          }\n        }\n        if (revision.length > 0) {\n          this.updateRevisionCollection(revision);\n        }\n        this.owner.trackChangesPane.updateTrackChanges();\n        var editRanges_1 = this.documentHelper.editRanges.get(user);\n        // update content\n        if (!isInEditRange) {\n          this.tranformSelection(startParagrahInfo, endParagrahInfo);\n        } else {\n          if (editRanges_1.length > 0) {\n            var positionInfo = this.selection.getPosition(editRanges_1[0]);\n            // We can't able to predic the modified content inside editable region\n            // So, it not possible to transform the position relativly.\n            // So, move the selection to editable region end.\n            this.selection.selectPosition(positionInfo.endPosition, positionInfo.endPosition);\n          }\n        }\n        this.tranformHistoryPosition();\n        this.selection.updateEditRangeCollection();\n        this.updateLockRegion(user);\n        this.documentHelper.removeEmptyPages();\n        this.owner.viewer.updateScrollBars();\n        this.owner.editorModule.isRemoveRevision = false;\n      }\n    }\n  };\n  CollaborativeEditing.prototype.updateRevisionCollection = function (revision) {\n    var insertIndex = 0;\n    var revisionStart = this.getRevisionTextPosition(revision[0]);\n    var isInsert = false;\n    if (this.owner.revisionsInternal.changes.length > 0 && !isNullOrUndefined(revisionStart)) {\n      for (var i = 0; i < this.owner.revisionsInternal.changes.length; i++) {\n        var textPosition = this.getRevisionTextPosition(this.owner.revisionsInternal.changes[i]);\n        if (textPosition.isExistAfter(revisionStart)) {\n          insertIndex = i;\n          isInsert = true;\n          break;\n        }\n      }\n    }\n    for (var j = 0; j < revision.length; j++) {\n      if (isInsert) {\n        this.owner.revisionsInternal.changes.splice(insertIndex, 0, revision[j]);\n        insertIndex++;\n      } else {\n        this.owner.revisionsInternal.changes.push(revision[j]);\n      }\n    }\n  };\n  /* eslint-disable @typescript-eslint/no-explicit-any */\n  CollaborativeEditing.prototype.getRevisionTextPosition = function (revision) {\n    if (revision.range.length > 0) {\n      var range = revision.range[0];\n      if (range instanceof ElementBox) {\n        return this.selection.getElementPosition(range).startPosition;\n      } else if (range instanceof WRowFormat) {\n        var block = range.ownerBase.firstChild.firstChild;\n        if (block.bodyWidget) {\n          return this.selection.getTextPosBasedOnLogicalIndex(this.selection.getHierarchicalIndex(block, '0'));\n        }\n      } else if (range instanceof WCharacterFormat) {\n        var paraWidget = range.ownerBase;\n        if (paraWidget.lastChild.paragraph.bodyWidget) {\n          var offset = paraWidget.getLength();\n          var startPosition = new TextPosition(this.owner);\n          startPosition.setPositionParagraph(paraWidget.lastChild, offset);\n          return startPosition;\n        }\n      }\n    }\n    return undefined;\n  };\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n  CollaborativeEditing.prototype.tranformSelection = function (startParagrahInfo, endParagraphInfo) {\n    this.documentHelper.skipScrollToPosition = true;\n    var startIndex = this.selection.getHierarchicalIndex(startParagrahInfo.paragraph, startParagrahInfo.offset.toString());\n    var endIndex = this.selection.getHierarchicalIndex(endParagraphInfo.paragraph, endParagraphInfo.offset.toString());\n    this.selection.select(startIndex, endIndex);\n  };\n  CollaborativeEditing.prototype.tranformHistoryPosition = function () {\n    if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n      var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n      var startElement = editRanges[0];\n      var startBlock = this.getParentBlock(startElement.paragraph);\n      var startOffset = this.selection.getHierarchicalIndex(startBlock, '0').split(';');\n      if (!isNullOrUndefined(this.lockStart) && this.lockStart.length > 1) {\n        var sectionDiff = parseInt(startOffset[0], 10) - parseInt(this.lockStart[0], 10);\n        var blockDiff = parseInt(startOffset[1], 10) - parseInt(this.lockStart[1], 10);\n        this.transformHistory(sectionDiff, blockDiff);\n      }\n    }\n  };\n  CollaborativeEditing.prototype.transformHistory = function (sectionDiff, blockDiff) {\n    if (this.owner.enableEditorHistory) {\n      var undoStack = this.owner.editorHistoryModule.undoStack;\n      if (!isNullOrUndefined(undoStack)) {\n        for (var i = 0; i < undoStack.length; i++) {\n          this.transformBaseHistoryInfo(undoStack[i], sectionDiff, blockDiff);\n        }\n      }\n      var redoStack = this.owner.editorHistoryModule.redoStack;\n      if (!isNullOrUndefined(redoStack)) {\n        for (var i = 0; i < redoStack.length; i++) {\n          this.transformBaseHistoryInfo(redoStack[i], sectionDiff, blockDiff);\n        }\n      }\n    }\n  };\n  CollaborativeEditing.prototype.transformBaseHistoryInfo = function (baseHistoryInfo, sectionDiff, blockDiff) {\n    if (baseHistoryInfo.endPosition) {\n      baseHistoryInfo.endPosition = this.tranformPosition(baseHistoryInfo.endPosition, sectionDiff, blockDiff);\n    }\n    if (baseHistoryInfo.insertPosition) {\n      baseHistoryInfo.insertPosition = this.tranformPosition(baseHistoryInfo.insertPosition, sectionDiff, blockDiff);\n    }\n    if (baseHistoryInfo.selectionStart) {\n      baseHistoryInfo.selectionStart = this.tranformPosition(baseHistoryInfo.selectionStart, sectionDiff, blockDiff);\n    }\n    if (baseHistoryInfo.selectionEnd) {\n      baseHistoryInfo.selectionEnd = this.tranformPosition(baseHistoryInfo.selectionEnd, sectionDiff, blockDiff);\n    }\n    if (baseHistoryInfo instanceof HistoryInfo) {\n      var modifiedActions = baseHistoryInfo.modifiedActions;\n      for (var j = 0; j < modifiedActions.length; j++) {\n        this.transformBaseHistoryInfo(modifiedActions[j], sectionDiff, blockDiff);\n      }\n    }\n  };\n  CollaborativeEditing.prototype.tranformPosition = function (position, sectionDiff, blockDiff) {\n    var index = position.split(';');\n    index[0] = (parseInt(index[0], 10) + sectionDiff).toString();\n    index[1] = (parseInt(index[1], 10) + blockDiff).toString();\n    return index.join(';');\n  };\n  CollaborativeEditing.prototype.getParentBlock = function (block) {\n    if (block.isInsideTable) {\n      block = this.owner.documentHelper.layout.getParentTable(block);\n    }\n    return block.combineWidget(this.owner.viewer);\n  };\n  //#endregion\n  //#region Remove existing items in locked region\n  CollaborativeEditing.prototype.removeDuplicateCollection = function (removedBlock) {\n    this.removeFieldInBlock(removedBlock, false, false);\n    this.removeFieldInBlock(removedBlock, true, false);\n    this.removeFieldInBlock(removedBlock, false, true);\n    if (removedBlock instanceof TableWidget) {\n      for (var i = 0; i < removedBlock.childWidgets.length; i++) {\n        if (removedBlock.childWidgets[i] instanceof TableRowWidget) {\n          var tableDelete = removedBlock.childWidgets[i];\n          this.owner.editorModule.removeDeletedCellRevision(tableDelete);\n        }\n      }\n    } else {\n      this.owner.editorModule.removeRevisionForBlock(removedBlock, undefined, false, false);\n    }\n  };\n  CollaborativeEditing.prototype.removeFieldInBlock = function (block, isBookmark, contentControl) {\n    if (block instanceof TableWidget) {\n      this.removeFieldTable(block, isBookmark, contentControl);\n    } else {\n      this.owner.editorModule.removeField(block, isBookmark, contentControl);\n      this.removeComment(block);\n    }\n  };\n  CollaborativeEditing.prototype.removeFieldTable = function (table, isBookmark, contentControl) {\n    for (var i = 0; i < table.childWidgets.length; i++) {\n      var rowWidget = table.childWidgets[i];\n      for (var j = 0; j < rowWidget.childWidgets.length; j++) {\n        var widget = rowWidget.childWidgets[j];\n        for (var i_1 = 0; i_1 < widget.childWidgets.length; i_1++) {\n          this.removeFieldInBlock(widget.childWidgets[i_1], isBookmark, contentControl);\n        }\n      }\n    }\n  };\n  CollaborativeEditing.prototype.removeComment = function (block) {\n    if (this.documentHelper.comments.length > 0) {\n      for (var i = 0; i < this.documentHelper.comments.length; i++) {\n        var comment = this.documentHelper.comments[i];\n        if (comment.commentStart.line.paragraph === block) {\n          this.documentHelper.comments.splice(i, 1);\n          this.owner.commentReviewPane.deleteComment(comment);\n          i--;\n        }\n      }\n    }\n  };\n  //#endregion\n  CollaborativeEditing.prototype.updateNextBlocksIndex = function (block, increaseIndex) {\n    var nextBlock = block.getSplitWidgets().pop().nextRenderedWidget;\n    var incrementCount = 1;\n    if (nextBlock.bodyWidget.index === block.bodyWidget.index) {\n      incrementCount = block.index - nextBlock.index + 1;\n    }\n    var nextIndex = block.containerWidget.childWidgets.indexOf(block) + 1;\n    if (block.containerWidget instanceof BodyWidget) {\n      var sectionIndex = block.containerWidget.index;\n      var pageIndex = this.documentHelper.pages.indexOf(block.containerWidget.page);\n      for (var j = pageIndex; j < this.documentHelper.pages.length; j++) {\n        var page = this.documentHelper.pages[j];\n        if (page.bodyWidgets[0].index === sectionIndex) {\n          for (var k = nextIndex; k < page.bodyWidgets[0].childWidgets.length; k++) {\n            var childWidget = page.bodyWidgets[0].childWidgets[k];\n            childWidget.index += incrementCount;\n          }\n          nextIndex = 0;\n        } else {\n          return;\n        }\n      }\n    }\n  };\n  /**\n   * Update locked region highlight.\n   *\n   * @private\n   * @param {string} user - Specified the user.\n   * @param {boolean} isLocked - Specifies the isLocked.\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.updateLockRegion = function (user, isLocked) {\n    if (isNullOrUndefined(user)) {\n      user = this.owner.currentUser;\n    }\n    isLocked = isNullOrUndefined(isLocked) ? true : isLocked;\n    if (this.documentHelper.editRanges.containsKey(user)) {\n      var editRanges = this.documentHelper.editRanges.get(user);\n      if (editRanges.length === 1 && !isNullOrUndefined(editRanges[0].editRangeEnd)) {\n        var editStart = editRanges[0];\n        this.updateLockInfo(editStart.paragraph, editStart.editRangeEnd.paragraph, user, isLocked);\n      }\n    }\n  };\n  CollaborativeEditing.prototype.updateLockInfo = function (startBlock, endBlock, user, locked) {\n    if (startBlock.isInsideTable) {\n      startBlock = this.documentHelper.layout.getParentTable(startBlock);\n    }\n    if (endBlock.isInsideTable) {\n      endBlock = this.documentHelper.layout.getParentTable(endBlock);\n    }\n    do {\n      if (locked) {\n        startBlock.lockedBy = user;\n        startBlock.locked = locked;\n      } else {\n        startBlock.lockedBy = undefined;\n        startBlock.locked = locked;\n      }\n      if (startBlock === endBlock) {\n        break;\n      }\n      startBlock = startBlock.nextRenderedWidget;\n      if (isNullOrUndefined(startBlock)) {\n        break;\n      }\n    } while (startBlock);\n  };\n  /**\n   * Pull pending actions from server.\n   *\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.pullAction = function () {\n    var _this = this;\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    if (this.owner) {\n      var ajax = new XmlHttpRequestHandler();\n      ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.getPendingActions;\n      ajax.contentType = 'application/json;charset=UTF-8';\n      ajax.onSuccess = function (result) {\n        if (typeof result === 'string') {\n          result = JSON.parse(result);\n        }\n        _this.updateAction(JSON.parse(result.data));\n        hideSpinner(_this.owner.element);\n      };\n      ajax.onFailure = this.failureHandler.bind(this);\n      ajax.onError = this.failureHandler.bind(this);\n      ajax.customHeaders = this.owner.headers;\n      showSpinner(this.owner.element);\n      ajax.send({\n        'roomName': this.collaborativeEditingSettings.roomName,\n        version: this.version\n      });\n    }\n  };\n  /* eslint-enable @typescript-eslint/no-explicit-any */\n  /**\n   * Destroy collaborative editing module.\n   *\n   * @returns {void}\n   */\n  CollaborativeEditing.prototype.destroy = function () {\n    this.owner = undefined;\n  };\n  return CollaborativeEditing;\n}();\nexport { CollaborativeEditing };","map":{"version":3,"names":["BodyWidget","TableWidget","TableRowWidget","ElementBox","Page","TextPosition","isNullOrUndefined","L10n","WSectionFormat","XmlHttpRequestHandler","actionCompleteEvent","HistoryInfo","DialogUtility","showSpinner","hideSpinner","WCharacterFormat","WRowFormat","CollaborativeEditing","editor","version","owner","Object","defineProperty","prototype","get","documentHelper","enumerable","configurable","selectionModule","documentEditorSettings","collaborativeEditingSettings","getModuleName","updateAction","data","Array","isArray","i","length","documentData","parseInt","toString","action","transFormLockRegion","lockRegion","selectionInfo","start","end","author","updateRegion","removeEditRange","previousLockInfo","sectionDiff","blockDiff","editRanges","containsKey","editRange","position","selection","getPosition","endOffset","getHierarchicalIndexByPosition","endPosition","split","previousOffset","tranformPosition","lockContent","user","_this","canLock","isForward","paragraph","isInsideTable","table","layout","getParentTable","firstPara","getFirstParagraphBlock","setPosition","childWidgets","paragraphStartInternal","lastPara","getLastParagraphBlock","offset","lastChild","getEndOffset","setPositionParagraph","moveToParagraphEndInternal","startOffset","selectionInfo_1","roomName","currentUser","startInfo_1","getParagraphInfo","endInfo_1","select","ajax","url","serviceUrl","serverActionSettings","contentType","onSuccess","result","successHandler","onFailure","failureHandler","bind","onError","customHeaders","headers","send","userNames","keys","range","isSelectionInEditableRange","getPreviousLockedRegion","undefined","previous","startPosition","isExistBefore","isExistAfter","unlockContent","saveTimer","clearTimeout","sfdtContent","JSON","stringify","serializeEditableRegion","saveObject","editorHistoryModule","clearHistory","fireContentChange","trigger","updateLockRegion","editorModule","removeUserRestrictionsInternal","clearContent","updateEditRangeCollection","viewer","updateScrollBars","saveContent","timeOut","saveTimeout","setTimeout","saveContentInternal","editRangeStart","startElement","endElement","editRangeEnd","line","sfdtExportModule","isPartialExport","write","currentWidget","startInfo","endInfo","parse","getHierarchicalIndex","previousEditRange","lockObject","localizeValue","defaultLocale","setLocale","locale","alert","content","getConstant","closeOnEscape","showCloseIcon","X","Y","enableRtl","getTextPosBasedOnLogicalIndex","lockRegionInternal","editStart","addEditElement","editEnd","insertElements","updateLockInfo","endElements","startElements","isSamePara","equals","insertElementsInternal","reLayoutParagraph","elements","indexInInline","isEmpty","children","push","inlineObj","getInline","curInline","element","index","firstElement","insertElementInternal","indexInOwner","lastElement","splice","newElement","insertIndex","isBidi","paragraphFormat","bidi","isRightToLeft","previousNode","setEditableRegion","firstBlock","getParentBlock","lockStart","_a","isAtSamePosition","remove","removeEditRangeMark","lastBlock","isInEditRange","startParagrahInfo","endParagrahInfo","isRemoveRevision","sections","currentBlock","combineWidget","previousRenderedWidget","bodyWidget","removedBlock","containerWidget","removeDuplicateCollection","removeChild","lastBockIndex","lastInsertIndex","indexOf","comments","blocks","revision","isPasteListUpdated","getBlocks","unshift","splitBodyWidget","sectionFormat","m","page","bodyWidgets","copyFormat","pageIndex","insertPage","updateSectionIndex","z","containerWidget_1","blockIndex","block","nextRenderedWidget","updateNextBlocksIndex","layoutBodyWidgetCollection","k","comment","addCommentWidget","showComments","replyComments","commentReviewPane","addReply","updateRevisionCollection","trackChangesPane","updateTrackChanges","editRanges_1","tranformSelection","positionInfo","selectPosition","tranformHistoryPosition","removeEmptyPages","revisionStart","getRevisionTextPosition","isInsert","revisionsInternal","changes","textPosition","j","getElementPosition","ownerBase","firstChild","paraWidget","getLength","endParagraphInfo","skipScrollToPosition","startIndex","endIndex","startBlock","transformHistory","enableEditorHistory","undoStack","transformBaseHistoryInfo","redoStack","baseHistoryInfo","insertPosition","selectionStart","selectionEnd","modifiedActions","join","removeFieldInBlock","tableDelete","removeDeletedCellRevision","removeRevisionForBlock","isBookmark","contentControl","removeFieldTable","removeField","removeComment","rowWidget","widget","i_1","commentStart","deleteComment","increaseIndex","nextBlock","getSplitWidgets","pop","incrementCount","nextIndex","sectionIndex","pages","childWidget","isLocked","endBlock","locked","lockedBy","pullAction","getPendingActions","destroy"],"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/node_modules/@syncfusion/ej2-documenteditor/src/document-editor/implementation/editor/collaborative-editing.js"],"sourcesContent":["import { BodyWidget, TableWidget, TableRowWidget, ElementBox, Page } from '../viewer/page';\nimport { TextPosition } from '../selection/selection-helper';\nimport { isNullOrUndefined, L10n } from '@syncfusion/ej2-base';\nimport { WSectionFormat } from '../format/section-format';\nimport { XmlHttpRequestHandler, actionCompleteEvent } from '../../base/index';\nimport { HistoryInfo } from '../editor-history/index';\nimport { DialogUtility } from '@syncfusion/ej2-popups';\nimport { showSpinner, hideSpinner } from '@syncfusion/ej2-popups';\nimport { WCharacterFormat, WRowFormat } from '../format/index';\n/**\n * Represents the collaborative editing module\n */\nvar CollaborativeEditing = /** @class */ (function () {\n    function CollaborativeEditing(editor) {\n        this.version = 0;\n        this.owner = editor;\n    }\n    Object.defineProperty(CollaborativeEditing.prototype, \"documentHelper\", {\n        //private lockEnd: string = '';\n        get: function () {\n            return this.owner.documentHelper;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CollaborativeEditing.prototype, \"selection\", {\n        get: function () {\n            return this.owner.selectionModule;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    Object.defineProperty(CollaborativeEditing.prototype, \"collaborativeEditingSettings\", {\n        get: function () {\n            return this.owner.documentEditorSettings.collaborativeEditingSettings;\n        },\n        enumerable: true,\n        configurable: true\n    });\n    CollaborativeEditing.prototype.getModuleName = function () {\n        return 'CollaborativeEditing';\n    };\n    /**\n     * To update the action which need to perform.\n     *\n     * @param {CollaborativeEditingEventArgs} data Specifies the data.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.updateAction = function (data) {\n        if (!Array.isArray(data)) {\n            data = [data];\n        }\n        for (var i = 0; i < data.length; i++) {\n            var documentData = data[parseInt(i.toString(), 10)];\n            switch (documentData.action) {\n                case 'LockContent':\n                    // Transform position\n                    this.transFormLockRegion(documentData);\n                    this.lockRegion(documentData.selectionInfo.start, documentData.selectionInfo.end, documentData.author);\n                    break;\n                case 'SaveContent':\n                    this.version = documentData.version;\n                    this.updateRegion(documentData.author, documentData.data);\n                    break;\n                case 'UnlockContent':\n                    this.version = documentData.version;\n                    this.updateRegion(documentData.author, documentData.data);\n                    this.removeEditRange(documentData.author);\n                    break;\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transFormLockRegion = function (data) {\n        var previousLockInfo = data.selectionInfo.previousLockInfo;\n        if (!isNullOrUndefined(previousLockInfo)) {\n            var author = previousLockInfo.author;\n            var sectionDiff = 0;\n            var blockDiff = 0;\n            if (this.documentHelper.editRanges.containsKey(author)) {\n                var editRange = this.documentHelper.editRanges.get(author);\n                if (editRange.length > 0) {\n                    var position = this.selection.getPosition(editRange[0]);\n                    var endOffset = this.selection.getHierarchicalIndexByPosition(position.endPosition).split(';');\n                    var previousOffset = previousLockInfo.end.split(';');\n                    sectionDiff = parseInt(endOffset[0], 10) - parseInt(previousOffset[0], 10);\n                    blockDiff = parseInt(endOffset[1], 10) - parseInt(previousOffset[1], 10);\n                    // Same section\n                    if (data.selectionInfo.start.split(';')[0] === previousLockInfo.end.split(';')[0]) {\n                        data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, blockDiff);\n                        data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, blockDiff);\n                    }\n                    else {\n                        data.selectionInfo.start = this.tranformPosition(data.selectionInfo.start, sectionDiff, 0);\n                        data.selectionInfo.end = this.tranformPosition(data.selectionInfo.end, sectionDiff, 0);\n                    }\n                }\n            }\n        }\n    };\n    /**\n     * Lock selected region from editing by other users.\n     *\n     * @param {string} user Specifies the user.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.lockContent = function (user) {\n        var _this = this;\n        if (this.canLock()) {\n            var start = this.owner.selectionModule.start;\n            var end = this.owner.selectionModule.end;\n            if (!this.owner.selectionModule.isForward) {\n                start = this.owner.selectionModule.end;\n                end = this.owner.selectionModule.start;\n            }\n            if (start.paragraph.isInsideTable) {\n                var table = this.owner.documentHelper.layout.getParentTable(start.paragraph);\n                var firstPara = this.owner.documentHelper.getFirstParagraphBlock(table);\n                start.setPosition(firstPara.childWidgets[0], true);\n            }\n            else {\n                start.paragraphStartInternal(this.owner.selectionModule, false);\n            }\n            if (end.paragraph.isInsideTable) {\n                var table = this.owner.documentHelper.layout.getParentTable(end.paragraph);\n                var lastPara = this.owner.documentHelper.getLastParagraphBlock(table);\n                var offset = lastPara.lastChild.getEndOffset();\n                end.setPositionParagraph(lastPara.lastChild, offset);\n            }\n            else {\n                end.moveToParagraphEndInternal(this.owner.selectionModule, false);\n            }\n            var startOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(start);\n            var endOffset = this.owner.selectionModule.getHierarchicalIndexByPosition(end);\n            var selectionInfo_1 = {\n                start: startOffset,\n                end: endOffset,\n                roomName: this.owner.documentEditorSettings.collaborativeEditingSettings.roomName,\n                author: isNullOrUndefined(user) ? this.owner.currentUser : user,\n                version: this.version\n            };\n            var startInfo_1 = this.selection.getParagraphInfo(start);\n            var endInfo_1 = this.selection.getParagraphInfo(end);\n            this.owner.selectionModule.select(startOffset, endOffset);\n            var ajax = new XmlHttpRequestHandler();\n            ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.canLock;\n            ajax.contentType = 'application/json;charset=UTF-8';\n            ajax.onSuccess = function (result) {\n                _this.successHandler(result, selectionInfo_1, startInfo_1, endInfo_1);\n            };\n            ajax.onFailure = this.failureHandler.bind(this);\n            ajax.onError = this.failureHandler.bind(this);\n            ajax.customHeaders = this.owner.headers;\n            ajax.send(selectionInfo_1);\n        }\n    };\n    /**\n     * @private\n     * @returns {boolean} - Returns can lock.\n     */\n    CollaborativeEditing.prototype.canLock = function () {\n        var editRanges = this.documentHelper.editRanges;\n        if (editRanges.containsKey(this.owner.currentUser)) {\n            return false;\n        }\n        var userNames = editRanges.keys;\n        for (var i = 0; i < userNames.length; i++) {\n            var range = editRanges.get(userNames[parseInt(i.toString(), 10)]);\n            if (!isNullOrUndefined(range) && range.length > 0) {\n                if (this.isSelectionInEditableRange(range[0])) {\n                    return false;\n                }\n            }\n        }\n        return true;\n    };\n    CollaborativeEditing.prototype.getPreviousLockedRegion = function () {\n        var editRanges = this.documentHelper.editRanges;\n        if (editRanges.containsKey(this.owner.currentUser)) {\n            return undefined;\n        }\n        var previous;\n        var userNames = editRanges.keys;\n        for (var i = 0; i < userNames.length; i++) {\n            var range = editRanges.get(userNames[parseInt(i.toString(), 10)])[0];\n            var startPosition = this.selection.getPosition(range).startPosition;\n            if (startPosition.isExistBefore(this.selection.start)) {\n                if (isNullOrUndefined(previous)) {\n                    previous = range;\n                }\n                else if (startPosition.isExistAfter(this.selection.getPosition(previous).startPosition)) {\n                    previous = range;\n                }\n            }\n        }\n        return previous;\n    };\n    /**\n     * @private\n     * @param {string} user - Specifies the user.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.unlockContent = function (user) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            if (this.saveTimer) {\n                clearTimeout(this.saveTimer);\n            }\n            var sfdtContent = JSON.stringify(this.serializeEditableRegion(user));\n            var saveObject = {\n                action: 'UnlockContent',\n                author: user,\n                version: this.version,\n                data: sfdtContent,\n                selectionInfo: {\n                    start: '',\n                    end: '',\n                    roomName: this.collaborativeEditingSettings.roomName,\n                    author: this.owner.currentUser,\n                    version: this.version\n                },\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.removeEditRange(user);\n            this.owner.editorHistoryModule.clearHistory();\n            this.owner.fireContentChange();\n            // Todo: selection tranformation\n            this.owner.trigger(actionCompleteEvent, saveObject);\n        }\n    };\n    CollaborativeEditing.prototype.removeEditRange = function (user) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            this.updateLockRegion(user, false);\n            this.owner.editorModule.removeUserRestrictionsInternal(this.documentHelper.editRanges.get(user)[0]);\n            this.documentHelper.clearContent();\n            this.selection.updateEditRangeCollection();\n            this.documentHelper.owner.viewer.updateScrollBars();\n        }\n    };\n    /**\n     * Save locked content to other clients.\n     *\n     * @private\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.saveContent = function () {\n        var _this = this;\n        if (this.saveTimer) {\n            clearTimeout(this.saveTimer);\n        }\n        var timeOut = this.collaborativeEditingSettings.saveTimeout;\n        if (isNullOrUndefined(timeOut)) {\n            timeOut = 3000;\n        }\n        this.saveTimer = setTimeout(function () {\n            _this.saveContentInternal();\n        }, timeOut);\n    };\n    CollaborativeEditing.prototype.saveContentInternal = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRangeStart = this.documentHelper.editRanges.get(this.owner.currentUser)[0];\n            var position = this.selection.getPosition(editRangeStart);\n            var saveObject = {\n                action: 'SaveContent',\n                author: this.owner.currentUser,\n                version: this.version,\n                data: JSON.stringify(this.serializeEditableRegion(this.owner.currentUser)),\n                selectionInfo: {\n                    'start': this.selection.getHierarchicalIndexByPosition(position.startPosition),\n                    'end': this.selection.getHierarchicalIndexByPosition(position.endPosition),\n                    roomName: this.collaborativeEditingSettings.roomName,\n                    author: this.owner.currentUser,\n                    version: this.version\n                },\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.owner.trigger(actionCompleteEvent, saveObject);\n        }\n    };\n    CollaborativeEditing.prototype.serializeEditableRegion = function (user) {\n        var startElement = this.documentHelper.editRanges.get(user)[0];\n        var endElement = startElement.editRangeEnd;\n        var start = new TextPosition(this.owner);\n        start.setPosition(startElement.line, true);\n        var end = new TextPosition(this.owner);\n        end.setPosition(endElement.line, false);\n        this.owner.sfdtExportModule.isPartialExport = true;\n        /* eslint-disable-next-line max-len */\n        var sfdtContent = this.owner.sfdtExportModule.write(0, start.currentWidget, start.offset, end.currentWidget, end.offset, false);\n        this.owner.sfdtExportModule.isPartialExport = false;\n        return sfdtContent;\n    };\n    /* eslint-disable-next-line max-len */\n    CollaborativeEditing.prototype.successHandler = function (result, selectionInfo, startInfo, endInfo) {\n        var canLock = JSON.parse(result.data).canLock;\n        if (canLock) {\n            selectionInfo.start = this.selection.getHierarchicalIndex(startInfo.paragraph, startInfo.offset.toString());\n            selectionInfo.end = this.selection.getHierarchicalIndex(endInfo.paragraph, endInfo.offset.toString());\n            var previousEditRange = this.getPreviousLockedRegion();\n            if (previousEditRange) {\n                var position = this.selection.getPosition(previousEditRange);\n                selectionInfo.previousLockInfo = {\n                    start: this.selection.getHierarchicalIndexByPosition(position.startPosition),\n                    end: this.selection.getHierarchicalIndexByPosition(position.endPosition),\n                    author: previousEditRange.user,\n                    roomName: '',\n                    version: 0\n                };\n            }\n            var lockObject = {\n                action: 'LockContent',\n                selectionInfo: selectionInfo,\n                author: this.owner.currentUser,\n                version: this.version,\n                data: '',\n                roomName: this.collaborativeEditingSettings.roomName\n            };\n            this.owner.trigger(actionCompleteEvent, lockObject);\n        }\n        else {\n            var localizeValue = new L10n('documenteditor', this.owner.defaultLocale);\n            localizeValue.setLocale(this.owner.locale);\n            DialogUtility.alert({\n                content: localizeValue.getConstant('Already locked'),\n                closeOnEscape: true, showCloseIcon: true, position: { X: 'Center', Y: 'Center' }\n            }).enableRtl = this.owner.enableRtl;\n        }\n    };\n    CollaborativeEditing.prototype.failureHandler = function () {\n        var localizeValue = new L10n('documenteditor', this.owner.defaultLocale);\n        localizeValue.setLocale(this.owner.locale);\n        DialogUtility.alert({\n            content: localizeValue.getConstant('Error in establishing connection with web server'),\n            closeOnEscape: true, showCloseIcon: true, position: { X: 'Center', Y: 'Center' }\n        }).enableRtl = this.owner.enableRtl;\n    };\n    /**\n     * Locker specified region for specified user.\n     *\n     * @private\n     * @param {string} start - Specified the selection start.\n     * @param {string} end - Specifies the selection end.\n     * @param {string} user - Specifies the user\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.lockRegion = function (start, end, user) {\n        var startPosition = this.selection.getTextPosBasedOnLogicalIndex(start);\n        var endPosition = this.selection.getTextPosBasedOnLogicalIndex(end);\n        this.lockRegionInternal(startPosition, endPosition, user);\n    };\n    CollaborativeEditing.prototype.lockRegionInternal = function (start, end, user) {\n        var editStart = this.owner.editorModule.addEditElement(user);\n        var editEnd = editStart.editRangeEnd;\n        this.insertElements(start, end, [editEnd], [editStart]);\n        this.updateLockInfo(editStart.paragraph, editEnd.paragraph, user, true);\n        this.owner.viewer.updateScrollBars();\n    };\n    CollaborativeEditing.prototype.insertElements = function (start, end, endElements, startElements) {\n        var isSamePara = start.paragraph.equals(end.paragraph);\n        if (!isNullOrUndefined(startElements)) {\n            this.insertElementsInternal(start, startElements);\n        }\n        if (!isNullOrUndefined(endElements)) {\n            this.insertElementsInternal(end, endElements);\n        }\n        this.documentHelper.layout.reLayoutParagraph(startElements[0].paragraph, 0, 0);\n        if (!isSamePara) {\n            this.documentHelper.layout.reLayoutParagraph(endElements[0].paragraph, 0, 0);\n        }\n    };\n    CollaborativeEditing.prototype.insertElementsInternal = function (position, elements) {\n        var indexInInline = 0;\n        if (position.paragraph.isEmpty()) {\n            var paragraph = position.paragraph;\n            paragraph.childWidgets[0].children.push(elements[0]);\n            elements[0].line = paragraph.childWidgets[0];\n        }\n        else {\n            var inlineObj = position.currentWidget.getInline(position.offset, indexInInline);\n            var curInline = inlineObj.element;\n            indexInInline = inlineObj.index;\n            var firstElement = elements[0];\n            this.insertElementInternal(curInline, firstElement, indexInInline);\n            var index = firstElement.indexInOwner;\n            var lastElement = firstElement;\n            for (var i = 1; i < elements.length; i++) {\n                lastElement = elements[parseInt(i.toString(), 10)];\n                firstElement.line.children.splice(index + i, 0, lastElement);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.insertElementInternal = function (element, newElement, index) {\n        var line = element.line;\n        var paragraph = line.paragraph;\n        var insertIndex = element.indexInOwner;\n        var isBidi = paragraph.paragraphFormat.bidi && element.isRightToLeft;\n        if (index === element.length) {\n            // Add new Element in current\n            if (!isBidi) {\n                insertIndex++;\n            }\n            line.children.splice(insertIndex, 0, newElement);\n        }\n        else if (index === 0) {\n            if (isNullOrUndefined(element.previousNode)) {\n                line.children.splice(0, 0, newElement);\n                insertIndex = 0;\n            }\n            else {\n                line.children.splice(insertIndex, 0, newElement);\n            }\n        }\n        newElement.line = element.line;\n    };\n    //#region Save content\n    CollaborativeEditing.prototype.setEditableRegion = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n            var editRangeStart = editRanges[0];\n            var firstBlock = this.getParentBlock(editRangeStart.paragraph);\n            this.lockStart = this.owner.selectionModule.getHierarchicalIndex(firstBlock, '0').split(';');\n        }\n    };\n    CollaborativeEditing.prototype.isSelectionInEditableRange = function (editRange) {\n        var _a;\n        if (!isNullOrUndefined(this.owner.selectionModule)) {\n            var start = this.owner.selectionModule.start;\n            var end = this.owner.selectionModule.end;\n            if (!this.owner.selectionModule.isForward) {\n                _a = [end, start], start = _a[0], end = _a[1];\n            }\n            var position = this.owner.selectionModule.getPosition(editRange);\n            if ((start.isExistAfter(position.startPosition) || start.isAtSamePosition(position.startPosition))\n                && (end.isExistBefore(position.endPosition) || end.isAtSamePosition(position.endPosition)) ||\n                ((position.startPosition.isExistAfter(start) || position.startPosition.isAtSamePosition(start))\n                    && (position.endPosition.isExistBefore(end) || position.endPosition.isAtSamePosition(end))) ||\n                (position.startPosition.isExistAfter(start) && position.startPosition.isExistBefore(end)\n                    && (end.isExistAfter(position.endPosition) || end.isExistBefore(position.endPosition))) ||\n                (position.endPosition.isExistBefore(end) && position.endPosition.isExistAfter(start)\n                    && (start.isExistBefore(position.startPosition) || start.isExistAfter(position.startPosition)))) {\n                return true;\n            }\n        }\n        return false;\n    };\n    /**\n     * Updated modified content from remote user\n     *\n     * @returns {void}\n     */\n    /* eslint-disable  */\n    CollaborativeEditing.prototype.updateRegion = function (user, content) {\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            var editRanges = this.documentHelper.editRanges.get(user);\n            if (editRanges.length === 1) {\n                // Remove exisiting range  from collection.\n                // New range will get inserted while updating the content.\n                this.documentHelper.editRanges.remove(user);\n                editRanges[0].removeEditRangeMark();\n            }\n            // Preserve hierachical position for history position tranformation\n            this.setEditableRegion();\n            var startElement = editRanges[0];\n            var endElement = startElement.editRangeEnd;\n            var firstBlock = this.getParentBlock(startElement.paragraph);\n            var lastBlock = this.getParentBlock(endElement.paragraph);\n            var isInEditRange = this.isSelectionInEditableRange(startElement);\n            var startParagrahInfo = void 0;\n            var endParagrahInfo = void 0;\n            this.owner.editorModule.isRemoveRevision = true;\n            if (!isInEditRange) {\n                startParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.start);\n                endParagrahInfo = this.owner.selectionModule.getParagraphInfo(this.owner.selectionModule.end);\n            }\n            var sections = [];\n            while (lastBlock !== firstBlock) {\n                var currentBlock = lastBlock.combineWidget(this.owner.viewer);\n                lastBlock = currentBlock.previousRenderedWidget;\n                if (lastBlock.bodyWidget.index !== currentBlock.bodyWidget.index) {\n                    sections.push(currentBlock.bodyWidget);\n                }\n                var removedBlock = currentBlock.containerWidget.childWidgets[currentBlock.indexInOwner];\n                this.removeDuplicateCollection(removedBlock);\n                currentBlock.containerWidget.removeChild(currentBlock.indexInOwner);\n            }\n            if (!isNullOrUndefined(firstBlock)) {\n                var lastBockIndex = firstBlock.index;\n                var containerWidget = firstBlock.containerWidget;\n                sections.push(containerWidget);\n                var lastInsertIndex = firstBlock.containerWidget.childWidgets.indexOf(firstBlock);\n                var removedBlock = containerWidget.childWidgets[lastInsertIndex];\n                containerWidget.removeChild(lastInsertIndex);\n                this.removeDuplicateCollection(removedBlock);\n                var comments = [];\n                var blocks = [];\n                var revision = [];\n                this.owner.editorModule.isPasteListUpdated = false;\n                this.owner.editorModule.getBlocks(JSON.parse(content), false, blocks, comments, revision);\n                if (sections.length !== blocks.length) {\n                    if (sections.length === 1) {\n                        var bodyWidget = sections[0];\n                        sections.unshift(this.owner.editorModule.splitBodyWidget(bodyWidget, blocks[blocks.length - 2].sectionFormat, bodyWidget.childWidgets[lastInsertIndex - 1]));\n                    }\n                    if (sections.length < blocks.length) {\n                        for (var m = 1; m < blocks.length - 1; m++) {\n                            var page = new Page(this.owner.documentHelper);\n                            var bodyWidget = new BodyWidget();\n                            page.bodyWidgets.push(bodyWidget);\n                            bodyWidget.page = page;\n                            sections.splice(m, 0, bodyWidget);\n                            bodyWidget.index = sections[m - 1].index;\n                            bodyWidget.sectionFormat = new WSectionFormat(bodyWidget);\n                            bodyWidget.sectionFormat.copyFormat(blocks[m].sectionFormat);\n                            var pageIndex = sections[m - 1].page.index;\n                            this.documentHelper.insertPage(pageIndex, page);\n                            //Todo: update section index\n                            this.owner.editorModule.updateSectionIndex(sections[m - 1].sectionFormat, sections[m - 1], true);\n                            if (sections.length === blocks.length) {\n                                break;\n                            }\n                        }\n                    }\n                }\n                for (var z = 0; z < sections.length; z++) {\n                    var containerWidget_1 = sections[z];\n                    var blockIndex = 0;\n                    var insertIndex = 0;\n                    if (z === sections.length - 1) {\n                        blockIndex = lastBockIndex;\n                        insertIndex = lastInsertIndex;\n                    }\n                    var block = blocks[z].childWidgets;\n                    for (var i = 0; i < block.length; i++) {\n                        block[i].containerWidget = containerWidget_1;\n                        block[i].index = blockIndex;\n                        containerWidget_1.childWidgets.splice(insertIndex, 0, block[i]);\n                        insertIndex++;\n                        blockIndex++;\n                    }\n                    lastBlock = block[block.length - 1];\n                    if (lastBlock.nextRenderedWidget && lastBlock.nextRenderedWidget.index !== lastBlock.index) {\n                        //Todo: update block index properly\n                        this.updateNextBlocksIndex(lastBlock, true);\n                    }\n                    this.documentHelper.layout.layoutBodyWidgetCollection(block[0].index, containerWidget_1, undefined, false);\n                }\n                for (var k = 0; k < comments.length; k++) {\n                    var comment = comments[k];\n                    this.owner.editorModule.addCommentWidget(comment, false, this.owner.showComments, false);\n                    if (comment.replyComments.length > 0) {\n                        for (var z = 0; z < comment.replyComments.length; z++) {\n                            this.owner.commentReviewPane.addReply(comment.replyComments[z], false, false);\n                        }\n                    }\n                }\n                if (revision.length > 0) {\n                    this.updateRevisionCollection(revision);\n                }\n                this.owner.trackChangesPane.updateTrackChanges();\n                var editRanges_1 = this.documentHelper.editRanges.get(user);\n                // update content\n                if (!isInEditRange) {\n                    this.tranformSelection(startParagrahInfo, endParagrahInfo);\n                }\n                else {\n                    if (editRanges_1.length > 0) {\n                        var positionInfo = this.selection.getPosition(editRanges_1[0]);\n                        // We can't able to predic the modified content inside editable region\n                        // So, it not possible to transform the position relativly.\n                        // So, move the selection to editable region end.\n                        this.selection.selectPosition(positionInfo.endPosition, positionInfo.endPosition);\n                    }\n                }\n                this.tranformHistoryPosition();\n                this.selection.updateEditRangeCollection();\n                this.updateLockRegion(user);\n                this.documentHelper.removeEmptyPages();\n                this.owner.viewer.updateScrollBars();\n                this.owner.editorModule.isRemoveRevision = false;\n            }\n        }\n    };\n    CollaborativeEditing.prototype.updateRevisionCollection = function (revision) {\n        var insertIndex = 0;\n        var revisionStart = this.getRevisionTextPosition(revision[0]);\n        var isInsert = false;\n        if (this.owner.revisionsInternal.changes.length > 0 &&\n            !isNullOrUndefined(revisionStart)) {\n            for (var i = 0; i < this.owner.revisionsInternal.changes.length; i++) {\n                var textPosition = this.getRevisionTextPosition(this.owner.revisionsInternal.changes[i]);\n                if (textPosition.isExistAfter(revisionStart)) {\n                    insertIndex = i;\n                    isInsert = true;\n                    break;\n                }\n            }\n        }\n        for (var j = 0; j < revision.length; j++) {\n            if (isInsert) {\n                this.owner.revisionsInternal.changes.splice(insertIndex, 0, revision[j]);\n                insertIndex++;\n            }\n            else {\n                this.owner.revisionsInternal.changes.push(revision[j]);\n            }\n        }\n    };\n    /* eslint-disable @typescript-eslint/no-explicit-any */\n    CollaborativeEditing.prototype.getRevisionTextPosition = function (revision) {\n        if (revision.range.length > 0) {\n            var range = revision.range[0];\n            if (range instanceof ElementBox) {\n                return this.selection.getElementPosition(range).startPosition;\n            }\n            else if (range instanceof WRowFormat) {\n                var block = range.ownerBase.firstChild.firstChild;\n                if (block.bodyWidget) {\n                    return this.selection.getTextPosBasedOnLogicalIndex(this.selection.getHierarchicalIndex(block, '0'));\n                }\n            }\n            else if (range instanceof WCharacterFormat) {\n                var paraWidget = range.ownerBase;\n                if (paraWidget.lastChild.paragraph.bodyWidget) {\n                    var offset = paraWidget.getLength();\n                    var startPosition = new TextPosition(this.owner);\n                    startPosition.setPositionParagraph(paraWidget.lastChild, offset);\n                    return startPosition;\n                }\n            }\n        }\n        return undefined;\n    };\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    CollaborativeEditing.prototype.tranformSelection = function (startParagrahInfo, endParagraphInfo) {\n        this.documentHelper.skipScrollToPosition = true;\n        var startIndex = this.selection.getHierarchicalIndex(startParagrahInfo.paragraph, startParagrahInfo.offset.toString());\n        var endIndex = this.selection.getHierarchicalIndex(endParagraphInfo.paragraph, endParagraphInfo.offset.toString());\n        this.selection.select(startIndex, endIndex);\n    };\n    CollaborativeEditing.prototype.tranformHistoryPosition = function () {\n        if (this.documentHelper.editRanges.containsKey(this.owner.currentUser)) {\n            var editRanges = this.documentHelper.editRanges.get(this.owner.currentUser);\n            var startElement = editRanges[0];\n            var startBlock = this.getParentBlock(startElement.paragraph);\n            var startOffset = this.selection.getHierarchicalIndex(startBlock, '0').split(';');\n            if (!isNullOrUndefined(this.lockStart) && this.lockStart.length > 1) {\n                var sectionDiff = parseInt(startOffset[0], 10) - parseInt(this.lockStart[0], 10);\n                var blockDiff = parseInt(startOffset[1], 10) - parseInt(this.lockStart[1], 10);\n                this.transformHistory(sectionDiff, blockDiff);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transformHistory = function (sectionDiff, blockDiff) {\n        if (this.owner.enableEditorHistory) {\n            var undoStack = this.owner.editorHistoryModule.undoStack;\n            if (!isNullOrUndefined(undoStack)) {\n                for (var i = 0; i < undoStack.length; i++) {\n                    this.transformBaseHistoryInfo(undoStack[i], sectionDiff, blockDiff);\n                }\n            }\n            var redoStack = this.owner.editorHistoryModule.redoStack;\n            if (!isNullOrUndefined(redoStack)) {\n                for (var i = 0; i < redoStack.length; i++) {\n                    this.transformBaseHistoryInfo(redoStack[i], sectionDiff, blockDiff);\n                }\n            }\n        }\n    };\n    CollaborativeEditing.prototype.transformBaseHistoryInfo = function (baseHistoryInfo, sectionDiff, blockDiff) {\n        if (baseHistoryInfo.endPosition) {\n            baseHistoryInfo.endPosition = this.tranformPosition(baseHistoryInfo.endPosition, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.insertPosition) {\n            baseHistoryInfo.insertPosition = this.tranformPosition(baseHistoryInfo.insertPosition, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.selectionStart) {\n            baseHistoryInfo.selectionStart = this.tranformPosition(baseHistoryInfo.selectionStart, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo.selectionEnd) {\n            baseHistoryInfo.selectionEnd = this.tranformPosition(baseHistoryInfo.selectionEnd, sectionDiff, blockDiff);\n        }\n        if (baseHistoryInfo instanceof HistoryInfo) {\n            var modifiedActions = baseHistoryInfo.modifiedActions;\n            for (var j = 0; j < modifiedActions.length; j++) {\n                this.transformBaseHistoryInfo(modifiedActions[j], sectionDiff, blockDiff);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.tranformPosition = function (position, sectionDiff, blockDiff) {\n        var index = position.split(';');\n        index[0] = (parseInt(index[0], 10) + sectionDiff).toString();\n        index[1] = (parseInt(index[1], 10) + blockDiff).toString();\n        return index.join(';');\n    };\n    CollaborativeEditing.prototype.getParentBlock = function (block) {\n        if (block.isInsideTable) {\n            block = this.owner.documentHelper.layout.getParentTable(block);\n        }\n        return block.combineWidget(this.owner.viewer);\n    };\n    //#endregion\n    //#region Remove existing items in locked region\n    CollaborativeEditing.prototype.removeDuplicateCollection = function (removedBlock) {\n        this.removeFieldInBlock(removedBlock, false, false);\n        this.removeFieldInBlock(removedBlock, true, false);\n        this.removeFieldInBlock(removedBlock, false, true);\n        if (removedBlock instanceof TableWidget) {\n            for (var i = 0; i < removedBlock.childWidgets.length; i++) {\n                if (removedBlock.childWidgets[i] instanceof TableRowWidget) {\n                    var tableDelete = removedBlock.childWidgets[i];\n                    this.owner.editorModule.removeDeletedCellRevision(tableDelete);\n                }\n            }\n        }\n        else {\n            this.owner.editorModule.removeRevisionForBlock(removedBlock, undefined, false, false);\n        }\n    };\n    CollaborativeEditing.prototype.removeFieldInBlock = function (block, isBookmark, contentControl) {\n        if (block instanceof TableWidget) {\n            this.removeFieldTable(block, isBookmark, contentControl);\n        }\n        else {\n            this.owner.editorModule.removeField(block, isBookmark, contentControl);\n            this.removeComment(block);\n        }\n    };\n    CollaborativeEditing.prototype.removeFieldTable = function (table, isBookmark, contentControl) {\n        for (var i = 0; i < table.childWidgets.length; i++) {\n            var rowWidget = table.childWidgets[i];\n            for (var j = 0; j < rowWidget.childWidgets.length; j++) {\n                var widget = rowWidget.childWidgets[j];\n                for (var i_1 = 0; i_1 < widget.childWidgets.length; i_1++) {\n                    this.removeFieldInBlock(widget.childWidgets[i_1], isBookmark, contentControl);\n                }\n            }\n        }\n    };\n    CollaborativeEditing.prototype.removeComment = function (block) {\n        if (this.documentHelper.comments.length > 0) {\n            for (var i = 0; i < this.documentHelper.comments.length; i++) {\n                var comment = this.documentHelper.comments[i];\n                if (comment.commentStart.line.paragraph === block) {\n                    this.documentHelper.comments.splice(i, 1);\n                    this.owner.commentReviewPane.deleteComment(comment);\n                    i--;\n                }\n            }\n        }\n    };\n    //#endregion\n    CollaborativeEditing.prototype.updateNextBlocksIndex = function (block, increaseIndex) {\n        var nextBlock = block.getSplitWidgets().pop().nextRenderedWidget;\n        var incrementCount = 1;\n        if (nextBlock.bodyWidget.index === block.bodyWidget.index) {\n            incrementCount = block.index - nextBlock.index + 1;\n        }\n        var nextIndex = block.containerWidget.childWidgets.indexOf(block) + 1;\n        if (block.containerWidget instanceof BodyWidget) {\n            var sectionIndex = block.containerWidget.index;\n            var pageIndex = this.documentHelper.pages.indexOf(block.containerWidget.page);\n            for (var j = pageIndex; j < this.documentHelper.pages.length; j++) {\n                var page = this.documentHelper.pages[j];\n                if (page.bodyWidgets[0].index === sectionIndex) {\n                    for (var k = nextIndex; k < page.bodyWidgets[0].childWidgets.length; k++) {\n                        var childWidget = page.bodyWidgets[0].childWidgets[k];\n                        childWidget.index += incrementCount;\n                    }\n                    nextIndex = 0;\n                }\n                else {\n                    return;\n                }\n            }\n        }\n    };\n    /**\n     * Update locked region highlight.\n     *\n     * @private\n     * @param {string} user - Specified the user.\n     * @param {boolean} isLocked - Specifies the isLocked.\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.updateLockRegion = function (user, isLocked) {\n        if (isNullOrUndefined(user)) {\n            user = this.owner.currentUser;\n        }\n        isLocked = isNullOrUndefined(isLocked) ? true : isLocked;\n        if (this.documentHelper.editRanges.containsKey(user)) {\n            var editRanges = this.documentHelper.editRanges.get(user);\n            if (editRanges.length === 1 && !isNullOrUndefined(editRanges[0].editRangeEnd)) {\n                var editStart = editRanges[0];\n                this.updateLockInfo(editStart.paragraph, editStart.editRangeEnd.paragraph, user, isLocked);\n            }\n        }\n    };\n    CollaborativeEditing.prototype.updateLockInfo = function (startBlock, endBlock, user, locked) {\n        if (startBlock.isInsideTable) {\n            startBlock = this.documentHelper.layout.getParentTable(startBlock);\n        }\n        if (endBlock.isInsideTable) {\n            endBlock = this.documentHelper.layout.getParentTable(endBlock);\n        }\n        do {\n            if (locked) {\n                startBlock.lockedBy = user;\n                startBlock.locked = locked;\n            }\n            else {\n                startBlock.lockedBy = undefined;\n                startBlock.locked = locked;\n            }\n            if (startBlock === endBlock) {\n                break;\n            }\n            startBlock = startBlock.nextRenderedWidget;\n            if (isNullOrUndefined(startBlock)) {\n                break;\n            }\n        } while (startBlock);\n    };\n    /**\n     * Pull pending actions from server.\n     *\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.pullAction = function () {\n        var _this = this;\n        /* eslint-disable @typescript-eslint/no-explicit-any */\n        if (this.owner) {\n            var ajax = new XmlHttpRequestHandler();\n            ajax.url = this.owner.serviceUrl + this.owner.serverActionSettings.getPendingActions;\n            ajax.contentType = 'application/json;charset=UTF-8';\n            ajax.onSuccess = function (result) {\n                if (typeof result === 'string') {\n                    result = JSON.parse(result);\n                }\n                _this.updateAction(JSON.parse(result.data));\n                hideSpinner(_this.owner.element);\n            };\n            ajax.onFailure = this.failureHandler.bind(this);\n            ajax.onError = this.failureHandler.bind(this);\n            ajax.customHeaders = this.owner.headers;\n            showSpinner(this.owner.element);\n            ajax.send(({ 'roomName': this.collaborativeEditingSettings.roomName, version: this.version }));\n        }\n    };\n    /* eslint-enable @typescript-eslint/no-explicit-any */\n    /**\n     * Destroy collaborative editing module.\n     *\n     * @returns {void}\n     */\n    CollaborativeEditing.prototype.destroy = function () {\n        this.owner = undefined;\n    };\n    return CollaborativeEditing;\n}());\nexport { CollaborativeEditing };\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module"}