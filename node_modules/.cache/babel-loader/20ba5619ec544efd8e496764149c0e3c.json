{"ast":null,"code":"var _jsxFileName = \"/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONT/gptversion/CASEFRONT/src/Dashboard/FeedView.js\";\nimport React, { useContext, useState, useEffect } from \"react\";\nimport { Col, Row, Tabs, Tab, Card, Button, Modal } from \"react-bootstrap\";\nimport axios from \"axios\";\nimport { BASE_URL_DEV } from \"../utils\";\nimport OpenFileModal from \"./OpenFileModal\";\nimport { UserContext } from \"../App\";\n\nfunction FeedView() {\n  const {\n    state,\n    dispatch\n  } = useContext(UserContext);\n  const [key, setKey] = useState(\"allPosts\");\n  const [isFetchPosts, setIsFetchPosts] = useState(true);\n\n  const fetchPosts = async () => {\n    const auth = state.auth;\n    if (!auth) return;\n    if (!isFetchPosts) return;\n\n    try {\n      const result = await axios(`${BASE_URL_DEV}/get/posts`, {\n        headers: {\n          \"x-access-token\": auth.authToken\n        }\n      });\n      const all_posts = result.data && result.data.allPosts;\n      console.log(all_posts);\n\n      if (all_posts) {\n        dispatch({\n          type: \"ALL_POSTS\",\n          payload: all_posts\n        });\n      }\n\n      setIsFetchPosts(false);\n    } catch (error) {\n      console.log(error);\n      console.log(error.response);\n      setIsFetchPosts(false);\n    }\n  };\n\n  useEffect(() => {\n    console.log(\"isFetchPosts: \", isFetchPosts);\n    fetchPosts();\n  }, [isFetchPosts]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    className: \"dashboard-view bg-dark2 p-5 text-center\",\n    style: {\n      width: \"100%\",\n      minHeight: \"100vh\"\n    },\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 48,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(Tabs, {\n    id: \"controlled-tab-example\",\n    activeKey: key,\n    onSelect: k => setKey(k),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 52,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Tab, {\n    eventKey: \"allPosts\",\n    title: \"All Posts\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 57,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 58,\n      columnNumber: 6\n    }\n  }, state.allPosts && state.allPosts.map(post => /*#__PURE__*/React.createElement(SinglePost, {\n    key: post.id,\n    currUser: state.auth,\n    user: post.user_info,\n    filePost: post,\n    dispatch: dispatch,\n    setIsFetchPosts: setIsFetchPosts,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 61,\n      columnNumber: 9\n    }\n  }))))));\n}\n\nfunction SinglePost({\n  currUser,\n  user,\n  filePost,\n  dispatch,\n  setIsFetchPosts\n}) {\n  const [showRating, setShowRating] = useState(false);\n  const [showRatingsModal, setShowRatingsModal] = useState(false);\n  const [showFileModal, setShowFileModal] = useState(false);\n  return /*#__PURE__*/React.createElement(Card, {\n    className: \"bg-file-card my-2 p-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 3\n    }\n  }, user && /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    md: 5,\n    sm: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(Row, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Col, {\n    className: \"d-flex align-items-center justify-content-center\",\n    md: 5,\n    sm: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 89,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"user-avatar mb-auto mr-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"rounded-circle d-flex bg-dark2 align-items-center justify-content-center img-lg\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 95,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"mdi mdi-file display-1 text-primary\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 96,\n      columnNumber: 11\n    }\n  })))), /*#__PURE__*/React.createElement(Col, {\n    md: 7,\n    sm: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 101,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center flex-column\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 102,\n      columnNumber: 10\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"mb-1 font-weight-medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 103,\n      columnNumber: 11\n    }\n  }, filePost.fileName), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center font-weight-medium text-light\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"mdi mdi-account mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 107,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mb-0\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 108,\n      columnNumber: 12\n    }\n  }, `${user.username}`)), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center font-weight-medium text-light\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 110,\n      columnNumber: 11\n    }\n  }, /*#__PURE__*/React.createElement(\"i\", {\n    className: \"mdi mdi-email-outline icon-sm mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 111,\n      columnNumber: 12\n    }\n  }), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mb-0 font-weight-medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 112,\n      columnNumber: 12\n    }\n  }, user.email))))))), /*#__PURE__*/React.createElement(Col, {\n    className: \"d-flex align-items-center\",\n    md: 3,\n    sm: 5,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex align-items-center flex-column text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center font-weight-medium text-light\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 8\n    }\n  }, Array(Math.floor(Number(filePost.total_rating))).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      color: \"#19a2f7\",\n      fontSize: \"1.7rem\"\n    },\n    className: \"mdi mdi-star icon-sm mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 125,\n      columnNumber: 11\n    }\n  })), Array(5 - Math.floor(Number(filePost.total_rating))).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      fontSize: \"1.7rem\"\n    },\n    className: \"mdi mdi-star icon-sm mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 134,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center font-weight-medium text-light\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 141,\n      columnNumber: 8\n    }\n  }, filePost.total_rating > 0 && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mb-0 display-5 font-weight-medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 10\n    }\n  }, `${filePost.total_rating} Star Rating`), filePost.total_rating == 0 && /*#__PURE__*/React.createElement(\"p\", {\n    className: \"mb-0 display-5 font-weight-medium\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 146,\n      columnNumber: 10\n    }\n  }, \"No ratings\")), filePost.total_rating > 0 && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"wrapper d-flex align-items-center font-weight-medium text-light\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"p\", {\n    onClick: () => setShowRatingsModal(true),\n    className: \"mb-0 text-primary cursor-pointer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 10\n    }\n  }, \"View all ratings\")))), /*#__PURE__*/React.createElement(Col, {\n    md: 4,\n    sm: 7,\n    xs: 12,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 163,\n      columnNumber: 6\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      height: \"100%\"\n    },\n    className: \"d-flex align-items-center text-center\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    disabled: currUser.userPublicId == user.public_id ? true : false,\n    onClick: () => setShowRating(true),\n    className: \"btn btn-primary rounded-0 mr-3 p-2 h3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 168,\n      columnNumber: 8\n    }\n  }, \"Add Your Rating\"), /*#__PURE__*/React.createElement(Button, {\n    onClick: () => setShowFileModal(true),\n    className: \"btn btn-primary rounded-0 py-2 px-3 h3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 177,\n      columnNumber: 8\n    }\n  }, \"Open File\")), /*#__PURE__*/React.createElement(RatingModal, {\n    show: showRating,\n    setShow: setShowRating,\n    auth: currUser,\n    dispatch: dispatch,\n    setIsFetchPosts: setIsFetchPosts,\n    filePost: filePost,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 184,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(ShowRatingsModal, {\n    show: showRatingsModal,\n    setShow: setShowRatingsModal,\n    ratings: filePost.all_ratings,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 192,\n      columnNumber: 7\n    }\n  }), /*#__PURE__*/React.createElement(OpenFileModal, {\n    showFileModal: showFileModal,\n    setShowFileModal: setShowFileModal,\n    fileUrl: filePost.fileUrl,\n    filePost: filePost,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 197,\n      columnNumber: 7\n    }\n  }))));\n}\n\nfunction RatingModal({\n  filePost,\n  show,\n  setShow,\n  auth,\n  dispatch,\n  setIsFetchPosts\n}) {\n  const handleClose = () => {\n    setShow(false);\n  };\n\n  const [message, setMessage] = useState(\"\");\n  const [rating, setRating] = useState(0);\n  const [review, setReview] = useState(\"\");\n\n  const handleRating = async () => {\n    try {\n      const result = await axios.post(`${BASE_URL_DEV}/rating/create`, {\n        rating,\n        review,\n        post_id: filePost.id\n      }, {\n        headers: {\n          \"x-access-token\": auth.authToken\n        }\n      });\n      console.log(result.data);\n      setIsFetchPosts(true);\n      handleClose();\n    } catch (error) {\n      console.log(error);\n      if (error.response && error.response.data.message) setMessage(error.response.data.message);else setMessage(error.message);\n    }\n  };\n\n  const isRated = filePost.all_ratings ? !!filePost.all_ratings.filter(rating => rating.user_id === auth.userId).length : false;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    onHide: handleClose,\n    backdrop: \"static\",\n    keyboard: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 258,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 264,\n      columnNumber: 5\n    }\n  }, !isRated ? /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 266,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"h3 text-dark my-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 267,\n      columnNumber: 8\n    }\n  }, Array(rating).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      fontSize: \"1.7rem\",\n      color: \"#19a2f7\"\n    },\n    onClick: () => setRating(idx + 1),\n    className: \"mdi mdi-star icon-sm mr-2 cursor-pointer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 271,\n      columnNumber: 11\n    }\n  })), Array(5 - rating).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      fontSize: \"1.7rem\"\n    },\n    onClick: () => setRating(rating + idx + 1),\n    className: \"mdi mdi-star icon-sm mr-2 cursor-pointer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 281,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"form-group w-100\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 289,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"label\", {\n    className: \"text-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 290,\n      columnNumber: 9\n    }\n  }, \"Add Review\"), /*#__PURE__*/React.createElement(\"textarea\", {\n    onChange: e => setReview(e.target.value),\n    className: \"form-control text-light\",\n    value: review,\n    rows: \"3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 291,\n      columnNumber: 9\n    }\n  })), message && /*#__PURE__*/React.createElement(\"div\", {\n    className: \"text-center text-dark my-3\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 299,\n      columnNumber: 9\n    }\n  }, message)) : /*#__PURE__*/React.createElement(\"div\", {\n    className: \"h4 text-center text-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 303,\n      columnNumber: 7\n    }\n  }, \"You already rated this post!\")), /*#__PURE__*/React.createElement(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 308,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"secondary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 309,\n      columnNumber: 6\n    }\n  }, \"Close\"), !isRated && /*#__PURE__*/React.createElement(Button, {\n    variant: \"primary\",\n    onClick: () => handleRating(),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 313,\n      columnNumber: 7\n    }\n  }, \"Add Rating\"))));\n}\n\nfunction ShowRatingsModal({\n  ratings,\n  show,\n  setShow\n}) {\n  const handleClose = () => {\n    setShow(false);\n  };\n\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    onHide: handleClose,\n    backdrop: \"static\",\n    keyboard: false,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 330,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 336,\n      columnNumber: 5\n    }\n  }, ratings && ratings.map((item, i) => /*#__PURE__*/React.createElement(\"div\", {\n    key: i,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 339,\n      columnNumber: 8\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"h4 text-dark mt-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 340,\n      columnNumber: 9\n    }\n  }, Array(item.rating).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      fontSize: \"1.7rem\",\n      color: \"#19a2f7\"\n    },\n    className: \"mdi mdi-star icon-sm mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 344,\n      columnNumber: 12\n    }\n  })), Array(5 - item.rating).fill().map((_, idx) => /*#__PURE__*/React.createElement(\"i\", {\n    key: idx,\n    style: {\n      fontSize: \"1.7rem\"\n    },\n    className: \"mdi mdi-star icon-sm mr-2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 353,\n      columnNumber: 12\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"h4 mt-0 w-100 text-dark\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 360,\n      columnNumber: 9\n    }\n  }, item.review), i !== ratings.length - 1 && /*#__PURE__*/React.createElement(\"hr\", {\n    className: \"bg-dark2\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 361,\n      columnNumber: 42\n    }\n  })))), /*#__PURE__*/React.createElement(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 365,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"secondary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 366,\n      columnNumber: 6\n    }\n  }, \"Close\"))));\n}\n\nexport default FeedView;","map":{"version":3,"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONT/gptversion/CASEFRONT/src/Dashboard/FeedView.js"],"names":["React","useContext","useState","useEffect","Col","Row","Tabs","Tab","Card","Button","Modal","axios","BASE_URL_DEV","OpenFileModal","UserContext","FeedView","state","dispatch","key","setKey","isFetchPosts","setIsFetchPosts","fetchPosts","auth","result","headers","authToken","all_posts","data","allPosts","console","log","type","payload","error","response","width","minHeight","k","map","post","id","user_info","SinglePost","currUser","user","filePost","showRating","setShowRating","showRatingsModal","setShowRatingsModal","showFileModal","setShowFileModal","fileName","username","email","Array","Math","floor","Number","total_rating","fill","_","idx","color","fontSize","height","userPublicId","public_id","all_ratings","fileUrl","RatingModal","show","setShow","handleClose","message","setMessage","rating","setRating","review","setReview","handleRating","post_id","isRated","filter","user_id","userId","length","e","target","value","ShowRatingsModal","ratings","item","i"],"mappings":"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","sourcesContent":["// @flow\nimport React, { useContext, useState, useEffect } from \"react\";\nimport { Col, Row, Tabs, Tab, Card, Button, Modal } from \"react-bootstrap\";\nimport axios from \"axios\";\n\nimport { BASE_URL_DEV } from \"../utils\";\nimport OpenFileModal from \"./OpenFileModal\";\n\nimport { UserContext } from \"../App\";\n\nfunction FeedView() {\n\tconst { state, dispatch } = useContext(UserContext);\n\tconst [key, setKey] = useState(\"allPosts\");\n\tconst [isFetchPosts, setIsFetchPosts] = useState(true);\n\n\tconst fetchPosts = async () => {\n\t\tconst auth = state.auth;\n\t\tif (!auth) return;\n\t\tif (!isFetchPosts) return;\n\t\ttry {\n\t\t\tconst result = await axios(`${BASE_URL_DEV}/get/posts`, {\n\t\t\t\theaders: {\n\t\t\t\t\t\"x-access-token\": auth.authToken,\n\t\t\t\t},\n\t\t\t});\n\t\t\tconst all_posts = result.data && result.data.allPosts;\n\t\t\tconsole.log(all_posts);\n\t\t\tif (all_posts) {\n\t\t\t\tdispatch({\n\t\t\t\t\ttype: \"ALL_POSTS\",\n\t\t\t\t\tpayload: all_posts,\n\t\t\t\t});\n\t\t\t}\n\t\t\tsetIsFetchPosts(false);\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tconsole.log(error.response);\n\t\t\tsetIsFetchPosts(false);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\tconsole.log(\"isFetchPosts: \", isFetchPosts);\n\t\tfetchPosts();\n\t}, [isFetchPosts]);\n\n\treturn (\n\t\t<div\n\t\t\tclassName=\"dashboard-view bg-dark2 p-5 text-center\"\n\t\t\tstyle={{ width: \"100%\", minHeight: \"100vh\" }}\n\t\t>\n\t\t\t<Tabs\n\t\t\t\tid=\"controlled-tab-example\"\n\t\t\t\tactiveKey={key}\n\t\t\t\tonSelect={(k) => setKey(k)}\n\t\t\t>\n\t\t\t\t<Tab eventKey=\"allPosts\" title=\"All Posts\">\n\t\t\t\t\t<div>\n\t\t\t\t\t\t{state.allPosts &&\n\t\t\t\t\t\t\tstate.allPosts.map((post) => (\n\t\t\t\t\t\t\t\t<SinglePost\n\t\t\t\t\t\t\t\t\tkey={post.id}\n\t\t\t\t\t\t\t\t\tcurrUser={state.auth}\n\t\t\t\t\t\t\t\t\tuser={post.user_info}\n\t\t\t\t\t\t\t\t\tfilePost={post}\n\t\t\t\t\t\t\t\t\tdispatch={dispatch}\n\t\t\t\t\t\t\t\t\tsetIsFetchPosts={setIsFetchPosts}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t))}\n\t\t\t\t\t</div>\n\t\t\t\t</Tab>\n\t\t\t</Tabs>\n\t\t</div>\n\t);\n}\n\nfunction SinglePost({ currUser, user, filePost, dispatch, setIsFetchPosts }) {\n\tconst [showRating, setShowRating] = useState(false);\n\tconst [showRatingsModal, setShowRatingsModal] = useState(false);\n\n\tconst [showFileModal, setShowFileModal] = useState(false);\n\n\treturn (\n\t\t<Card className=\"bg-file-card my-2 p-3\">\n\t\t\t{user && (\n\t\t\t\t<Row>\n\t\t\t\t\t<Col md={5} sm={12}>\n\t\t\t\t\t\t<Row>\n\t\t\t\t\t\t\t<Col\n\t\t\t\t\t\t\t\tclassName=\"d-flex align-items-center justify-content-center\"\n\t\t\t\t\t\t\t\tmd={5}\n\t\t\t\t\t\t\t\tsm={12}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t<div className=\"user-avatar mb-auto mr-3\">\n\t\t\t\t\t\t\t\t\t<div className=\"rounded-circle d-flex bg-dark2 align-items-center justify-content-center img-lg\">\n\t\t\t\t\t\t\t\t\t\t<i className=\"mdi mdi-file display-1 text-primary\"></i>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t\t<Col md={7} sm={12}>\n\t\t\t\t\t\t\t\t<div className=\"wrapper\">\n\t\t\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center flex-column\">\n\t\t\t\t\t\t\t\t\t\t<h4 className=\"mb-1 font-weight-medium\">\n\t\t\t\t\t\t\t\t\t\t\t{filePost.fileName}\n\t\t\t\t\t\t\t\t\t\t</h4>\n\t\t\t\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center font-weight-medium text-light\">\n\t\t\t\t\t\t\t\t\t\t\t<i className=\"mdi mdi-account mr-2\"></i>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"mb-0\">{`${user.username}`}</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center font-weight-medium text-light\">\n\t\t\t\t\t\t\t\t\t\t\t<i className=\"mdi mdi-email-outline icon-sm mr-2\"></i>\n\t\t\t\t\t\t\t\t\t\t\t<p className=\"mb-0 font-weight-medium\">{user.email}</p>\n\t\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t</Col>\n\t\t\t\t\t\t</Row>\n\t\t\t\t\t</Col>\n\t\t\t\t\t<Col className=\"d-flex align-items-center\" md={3} sm={5} xs={12}>\n\t\t\t\t\t\t<div className=\"d-flex align-items-center flex-column text-center\">\n\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center font-weight-medium text-light\">\n\t\t\t\t\t\t\t\t{Array(Math.floor(Number(filePost.total_rating)))\n\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ color: \"#19a2f7\", fontSize: \"1.7rem\" }}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2\"\n\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{Array(5 - Math.floor(Number(filePost.total_rating)))\n\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: \"1.7rem\" }}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2\"\n\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center font-weight-medium text-light\">\n\t\t\t\t\t\t\t\t{filePost.total_rating > 0 && (\n\t\t\t\t\t\t\t\t\t<p className=\"mb-0 display-5 font-weight-medium\">{`${filePost.total_rating} Star Rating`}</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t{filePost.total_rating == 0 && (\n\t\t\t\t\t\t\t\t\t<p className=\"mb-0 display-5 font-weight-medium\">\n\t\t\t\t\t\t\t\t\t\tNo ratings\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{filePost.total_rating > 0 && (\n\t\t\t\t\t\t\t\t<div className=\"wrapper d-flex align-items-center font-weight-medium text-light\">\n\t\t\t\t\t\t\t\t\t<p\n\t\t\t\t\t\t\t\t\t\tonClick={() => setShowRatingsModal(true)}\n\t\t\t\t\t\t\t\t\t\tclassName=\"mb-0 text-primary cursor-pointer\"\n\t\t\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t\t\tView all ratings\n\t\t\t\t\t\t\t\t\t</p>\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t</Col>\n\t\t\t\t\t<Col md={4} sm={7} xs={12}>\n\t\t\t\t\t\t<div\n\t\t\t\t\t\t\tstyle={{ height: \"100%\" }}\n\t\t\t\t\t\t\tclassName=\"d-flex align-items-center text-center\"\n\t\t\t\t\t\t>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tdisabled={\n\t\t\t\t\t\t\t\t\tcurrUser.userPublicId == user.public_id ? true : false\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\tonClick={() => setShowRating(true)}\n\t\t\t\t\t\t\t\tclassName=\"btn btn-primary rounded-0 mr-3 p-2 h3\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tAdd Your Rating\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t\t<Button\n\t\t\t\t\t\t\t\tonClick={() => setShowFileModal(true)}\n\t\t\t\t\t\t\t\tclassName=\"btn btn-primary rounded-0 py-2 px-3 h3\"\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\tOpen File\n\t\t\t\t\t\t\t</Button>\n\t\t\t\t\t\t</div>\n\t\t\t\t\t\t<RatingModal\n\t\t\t\t\t\t\tshow={showRating}\n\t\t\t\t\t\t\tsetShow={setShowRating}\n\t\t\t\t\t\t\tauth={currUser}\n\t\t\t\t\t\t\tdispatch={dispatch}\n\t\t\t\t\t\t\tsetIsFetchPosts={setIsFetchPosts}\n\t\t\t\t\t\t\tfilePost={filePost}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<ShowRatingsModal\n\t\t\t\t\t\t\tshow={showRatingsModal}\n\t\t\t\t\t\t\tsetShow={setShowRatingsModal}\n\t\t\t\t\t\t\tratings={filePost.all_ratings}\n\t\t\t\t\t\t/>\n\t\t\t\t\t\t<OpenFileModal\n\t\t\t\t\t\t\tshowFileModal={showFileModal}\n\t\t\t\t\t\t\tsetShowFileModal={setShowFileModal}\n\t\t\t\t\t\t\tfileUrl={filePost.fileUrl}\n\t\t\t\t\t\t\tfilePost={filePost}\n\t\t\t\t\t\t/>\n\t\t\t\t\t</Col>\n\t\t\t\t</Row>\n\t\t\t)}\n\t\t</Card>\n\t);\n}\n\nfunction RatingModal({\n\tfilePost,\n\tshow,\n\tsetShow,\n\tauth,\n\tdispatch,\n\tsetIsFetchPosts,\n}) {\n\tconst handleClose = () => {\n\t\tsetShow(false);\n\t};\n\tconst [message, setMessage] = useState(\"\");\n\tconst [rating, setRating] = useState(0);\n\tconst [review, setReview] = useState(\"\");\n\n\tconst handleRating = async () => {\n\t\ttry {\n\t\t\tconst result = await axios.post(\n\t\t\t\t`${BASE_URL_DEV}/rating/create`,\n\t\t\t\t{\n\t\t\t\t\trating,\n\t\t\t\t\treview,\n\t\t\t\t\tpost_id: filePost.id,\n\t\t\t\t},\n\t\t\t\t{\n\t\t\t\t\theaders: {\n\t\t\t\t\t\t\"x-access-token\": auth.authToken,\n\t\t\t\t\t},\n\t\t\t\t}\n\t\t\t);\n\t\t\tconsole.log(result.data);\n\t\t\tsetIsFetchPosts(true);\n\t\t\thandleClose();\n\t\t} catch (error) {\n\t\t\tconsole.log(error);\n\t\t\tif (error.response && error.response.data.message)\n\t\t\t\tsetMessage(error.response.data.message);\n\t\t\telse setMessage(error.message);\n\t\t}\n\t};\n\n\tconst isRated = filePost.all_ratings\n\t\t? !!filePost.all_ratings.filter((rating) => rating.user_id === auth.userId)\n\t\t\t.length\n\t\t: false;\n\n\treturn (\n\t\t<>\n\t\t\t<Modal\n\t\t\t\tshow={show}\n\t\t\t\tonHide={handleClose}\n\t\t\t\tbackdrop=\"static\"\n\t\t\t\tkeyboard={false}\n\t\t\t>\n\t\t\t\t<Modal.Body>\n\t\t\t\t\t{!isRated ? (\n\t\t\t\t\t\t<div>\n\t\t\t\t\t\t\t<div className=\"h3 text-dark my-3\">\n\t\t\t\t\t\t\t\t{Array(rating)\n\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: \"1.7rem\", color: \"#19a2f7\" }}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setRating(idx + 1)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2 cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t{Array(5 - rating)\n\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: \"1.7rem\" }}\n\t\t\t\t\t\t\t\t\t\t\tonClick={() => setRating(rating + idx + 1)}\n\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2 cursor-pointer\"\n\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t<div className=\"form-group w-100\">\n\t\t\t\t\t\t\t\t<label className=\"text-dark\">Add Review</label>\n\t\t\t\t\t\t\t\t<textarea\n\t\t\t\t\t\t\t\t\tonChange={(e) => setReview(e.target.value)}\n\t\t\t\t\t\t\t\t\tclassName=\"form-control text-light\"\n\t\t\t\t\t\t\t\t\tvalue={review}\n\t\t\t\t\t\t\t\t\trows=\"3\"\n\t\t\t\t\t\t\t\t></textarea>\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t{message && (\n\t\t\t\t\t\t\t\t<div className=\"text-center text-dark my-3\">{message}</div>\n\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t</div>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<div className=\"h4 text-center text-dark\">\n\t\t\t\t\t\t\tYou already rated this post!\n\t\t\t\t\t\t</div>\n\t\t\t\t\t)}\n\t\t\t\t</Modal.Body>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Button variant=\"secondary\" onClick={handleClose}>\n\t\t\t\t\t\tClose\n\t\t\t\t\t</Button>\n\t\t\t\t\t{!isRated && (\n\t\t\t\t\t\t<Button variant=\"primary\" onClick={() => handleRating()}>\n\t\t\t\t\t\t\tAdd Rating\n\t\t\t\t\t\t</Button>\n\t\t\t\t\t)}\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</>\n\t);\n}\n\nfunction ShowRatingsModal({ ratings, show, setShow }) {\n\tconst handleClose = () => {\n\t\tsetShow(false);\n\t};\n\n\treturn (\n\t\t<>\n\t\t\t<Modal\n\t\t\t\tshow={show}\n\t\t\t\tonHide={handleClose}\n\t\t\t\tbackdrop=\"static\"\n\t\t\t\tkeyboard={false}\n\t\t\t>\n\t\t\t\t<Modal.Body>\n\t\t\t\t\t{ratings &&\n\t\t\t\t\t\tratings.map((item, i) => (\n\t\t\t\t\t\t\t<div key={i}>\n\t\t\t\t\t\t\t\t<div className=\"h4 text-dark mt-2\">\n\t\t\t\t\t\t\t\t\t{Array(item.rating)\n\t\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: \"1.7rem\", color: \"#19a2f7\" }}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2\"\n\t\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t\t{Array(5 - item.rating)\n\t\t\t\t\t\t\t\t\t\t.fill()\n\t\t\t\t\t\t\t\t\t\t.map((_, idx) => (\n\t\t\t\t\t\t\t\t\t\t\t<i\n\t\t\t\t\t\t\t\t\t\t\t\tkey={idx}\n\t\t\t\t\t\t\t\t\t\t\t\tstyle={{ fontSize: \"1.7rem\" }}\n\t\t\t\t\t\t\t\t\t\t\t\tclassName=\"mdi mdi-star icon-sm mr-2\"\n\t\t\t\t\t\t\t\t\t\t\t></i>\n\t\t\t\t\t\t\t\t\t\t))}\n\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t<div className=\"h4 mt-0 w-100 text-dark\">{item.review}</div>\n\t\t\t\t\t\t\t\t{(i !== (ratings.length - 1)) && <hr className=\"bg-dark2\" />}\n\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t))}\n\t\t\t\t</Modal.Body>\n\t\t\t\t<Modal.Footer>\n\t\t\t\t\t<Button variant=\"secondary\" onClick={handleClose}>\n\t\t\t\t\t\tClose\n\t\t\t\t\t</Button>\n\t\t\t\t</Modal.Footer>\n\t\t\t</Modal>\n\t\t</>\n\t);\n}\n\nexport default FeedView;\n"]},"metadata":{},"sourceType":"module"}