{"ast":null,"code":"var _jsxFileName = \"/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/src/Dashboard/Index.js\";\n// Based on https://github.com/agentcooper/react-pdf-highlighter/tree/master/packages/example\n// rewritten with hooks\nimport React, { useState, useEffect, useRef } from \"react\";\nimport axios from \"axios\";\nimport \"bootstrap/dist/css/bootstrap.min.css\";\nimport { PdfLoader, PdfHighlighter, Highlight, Popup, AreaHighlight } from \"react-pdf-highlighter\";\nimport Spinner from \"../shared/Spinner\";\nimport Tip from \"./Tip\";\nimport processMd from \"./markdown\";\nimport { Fragment } from \"react\";\nimport GraphFunc from \"./graphFunc\";\nimport PdfViewer from \"./PdfViewer\";\nimport DashboardView from \"./DashboardView\";\nimport ProfileView from \"./ProfileView\";\nimport FeedView from \"./FeedView\";\nimport LawsViewer from \"./LawsViewer\";\nimport TextAnonymizer from \"./TextAnonymizer\";\nimport GptView from \"./GptView\";\n\nconst getNextId = () => String(Math.random()).slice(2);\n\nconst parseIdFromHash = () => document.location.hash.slice(\"#highlight-\".length);\n\nconst resetHash = () => {\n  document.location.hash = \"\";\n};\n\nconst HighlightPopup = ({\n  comment\n}) => comment.text ? /*#__PURE__*/React.createElement(\"div\", {\n  className: \"Highlight__popup\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 41,\n    columnNumber: 3\n  }\n}, comment.emoji, \" \", processMd(comment.text)) : null; //const DEFAULT_URL = \"https://arxiv.org/pdf/1708.08021.pdf\";\n//const searchParams = new URLSearchParams(document.location.search);\n//const url = searchParams.get(\"url\") || DEFAULT_URL;\n\n\nfunction Dashboard({\n  showFileViewer,\n  showDashboardView,\n  showHighlight,\n  showProfileView,\n  showFeedView,\n  showTextAnonymizerView,\n  showGptView,\n  showLawsReader\n}) {\n  const [state, setState] = useState({\n    highlights: []\n  });\n  const [PdfUrl, setPdfUrl] = useState({\n    url: \"\"\n  });\n  useEffect(() => {\n    async function fetchData() {\n      axios.get('http://127.0.0.1:5000/api/v1/json').then(result_json => {\n        const pdf_name = Object.keys(result_json.data)[0];\n        setPdfUrl({\n          url: `http://127.0.0.1:5000/api/v1/pdf/${pdf_name}`\n        });\n        setState({\n          highlights: result_json.data[pdf_name]\n        });\n      }).catch(error => console.log('error: ' + error));\n    }\n\n    fetchData();\n  }, []); // not using the State type!\n  // Jumping to highlight\n  // This function was defined and changed later! I'm not sure why it was used instead of a ref\n  // let scrollViewerTo = (highlight: any) => { };\n  // https://stackoverflow.com/questions/24841855/how-to-access-component-methods-from-outside-in-reactjs\n\n  const pdfHighlighter = useRef(null);\n\n  const getHighlightById = id => state.highlights.find(highlight => highlight.id === id);\n\n  const scrollToHighlightFromHash = () => {\n    const highlight = getHighlightById(parseIdFromHash());\n\n    if (highlight) {\n      pdfHighlighter.current.scrollTo(highlight);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"hashchange\", scrollToHighlightFromHash, false);\n    return () => window.removeEventListener(\"hashchange\", scrollToHighlightFromHash);\n  });\n\n  function addHighlight(highlight) {\n    const {\n      highlights\n    } = state;\n    setState({\n      highlights: [{ ...highlight,\n        id: getNextId()\n      }, ...highlights]\n    });\n  }\n\n  function updateHighlight(highlightId, position, content) {\n    setState({\n      highlights: state.highlights.map(h => {\n        return h.id === highlightId ? { ...h,\n          position: { ...h.position,\n            ...position\n          },\n          content: { ...h.content,\n            ...content\n          }\n        } : h;\n      })\n    });\n  }\n\n  const {\n    highlights\n  } = state;\n  const {\n    url\n  } = PdfUrl;\n  return /*#__PURE__*/React.createElement(Fragment, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 123,\n      columnNumber: 3\n    }\n  }, showHighlight && /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(GraphFunc, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 6\n    }\n  }), url ? /*#__PURE__*/React.createElement(PdfLoader, {\n    url: url,\n    beforeLoad: /*#__PURE__*/React.createElement(Spinner, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 128,\n        columnNumber: 40\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 7\n    }\n  }, pdfDocument => /*#__PURE__*/React.createElement(PdfHighlighter, {\n    ref: pdfHighlighter,\n    pdfDocument: pdfDocument,\n    enableAreaSelection: event => event.altKey,\n    onScrollChange: resetHash,\n    scrollRef: scrollTo => {},\n    onSelectionFinished: (position, content, hideTipAndSelection, transformSelection) => /*#__PURE__*/React.createElement(Tip, {\n      onOpen: transformSelection,\n      onConfirm: comment => {\n        addHighlight({\n          content,\n          position,\n          comment\n        });\n        hideTipAndSelection();\n      },\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 142,\n        columnNumber: 11\n      }\n    }),\n    highlightTransform: (highlight, index, setTip, hideTip, viewportToScaled, screenshot, isScrolledTo) => {\n      const isTextHighlight = !Boolean(highlight.content && highlight.content.image);\n      const component = isTextHighlight ? /*#__PURE__*/React.createElement(Highlight, {\n        isScrolledTo: isScrolledTo,\n        position: highlight.position,\n        comment: highlight.comment,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 165,\n          columnNumber: 12\n        }\n      }) : /*#__PURE__*/React.createElement(AreaHighlight, {\n        highlight: highlight,\n        onChange: boundingRect => {\n          updateHighlight(highlight.id, {\n            boundingRect: viewportToScaled(boundingRect)\n          }, {\n            image: screenshot(boundingRect)\n          });\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 171,\n          columnNumber: 12\n        }\n      });\n      return /*#__PURE__*/React.createElement(Popup, {\n        popupContent: /*#__PURE__*/React.createElement(HighlightPopup, Object.assign({}, highlight, {\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 187,\n            columnNumber: 27\n          }\n        })),\n        onMouseOver: popupContent => setTip(highlight, highlight => popupContent),\n        onMouseOut: hideTip,\n        key: index,\n        children: component,\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 186,\n          columnNumber: 12\n        }\n      });\n    },\n    highlights: highlights,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 130,\n      columnNumber: 9\n    }\n  })) : /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 202,\n      columnNumber: 7\n    }\n  })), showFileViewer && /*#__PURE__*/React.createElement(PdfViewer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 206,\n      columnNumber: 23\n    }\n  }), showDashboardView && /*#__PURE__*/React.createElement(DashboardView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 207,\n      columnNumber: 26\n    }\n  }), showProfileView && /*#__PURE__*/React.createElement(ProfileView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 24\n    }\n  }), showFeedView && /*#__PURE__*/React.createElement(FeedView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 209,\n      columnNumber: 21\n    }\n  }), showLawsReader && /*#__PURE__*/React.createElement(LawsViewer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 210,\n      columnNumber: 23\n    }\n  }), showTextAnonymizerView && /*#__PURE__*/React.createElement(TextAnonymizer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 211,\n      columnNumber: 31\n    }\n  }), showGptView && /*#__PURE__*/React.createElement(GptView, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 20\n    }\n  }));\n}\n\nexport default Dashboard;","map":{"version":3,"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/src/Dashboard/Index.js"],"names":["React","useState","useEffect","useRef","axios","PdfLoader","PdfHighlighter","Highlight","Popup","AreaHighlight","Spinner","Tip","processMd","Fragment","GraphFunc","PdfViewer","DashboardView","ProfileView","FeedView","LawsViewer","TextAnonymizer","GptView","getNextId","String","Math","random","slice","parseIdFromHash","document","location","hash","length","resetHash","HighlightPopup","comment","text","emoji","Dashboard","showFileViewer","showDashboardView","showHighlight","showProfileView","showFeedView","showTextAnonymizerView","showGptView","showLawsReader","state","setState","highlights","PdfUrl","setPdfUrl","url","fetchData","get","then","result_json","pdf_name","Object","keys","data","catch","error","console","log","pdfHighlighter","getHighlightById","id","find","highlight","scrollToHighlightFromHash","current","scrollTo","window","addEventListener","removeEventListener","addHighlight","updateHighlight","highlightId","position","content","map","h","pdfDocument","event","altKey","hideTipAndSelection","transformSelection","index","setTip","hideTip","viewportToScaled","screenshot","isScrolledTo","isTextHighlight","Boolean","image","component","boundingRect","popupContent"],"mappings":"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","sourcesContent":["// @flow\r\n\r\n// Based on https://github.com/agentcooper/react-pdf-highlighter/tree/master/packages/example\r\n// rewritten with hooks\r\n\r\nimport React, { useState, useEffect, useRef } from \"react\";\r\nimport axios from \"axios\";\r\nimport \"bootstrap/dist/css/bootstrap.min.css\";\r\nimport {\r\n\tPdfLoader,\r\n\tPdfHighlighter,\r\n\tHighlight,\r\n\tPopup,\r\n\tAreaHighlight,\r\n} from \"react-pdf-highlighter\";\r\nimport Spinner from \"../shared/Spinner\";\r\nimport Tip from \"./Tip\";\r\nimport processMd from \"./markdown\";\r\nimport { Fragment } from \"react\";\r\nimport GraphFunc from \"./graphFunc\";\r\nimport PdfViewer from \"./PdfViewer\";\r\nimport DashboardView from \"./DashboardView\";\r\nimport ProfileView from \"./ProfileView\";\r\nimport FeedView from \"./FeedView\";\r\nimport LawsViewer from \"./LawsViewer\";\r\nimport TextAnonymizer from \"./TextAnonymizer\";\r\nimport GptView from \"./GptView\"\r\n\r\n\r\nconst getNextId = () => String(Math.random()).slice(2);\r\n\r\nconst parseIdFromHash = () =>\r\n\tdocument.location.hash.slice(\"#highlight-\".length);\r\n\r\nconst resetHash = () => {\r\n\tdocument.location.hash = \"\";\r\n};\r\n\r\nconst HighlightPopup = ({ comment }) =>\r\n\tcomment.text ? (\r\n\t\t<div className=\"Highlight__popup\">\r\n\t\t\t{comment.emoji} {processMd(comment.text)}\r\n\t\t</div>\r\n\t) : null;\r\n\r\n//const DEFAULT_URL = \"https://arxiv.org/pdf/1708.08021.pdf\";\r\n\r\n//const searchParams = new URLSearchParams(document.location.search);\r\n//const url = searchParams.get(\"url\") || DEFAULT_URL;\r\n\r\nfunction Dashboard({ showFileViewer, showDashboardView, showHighlight, showProfileView, showFeedView, showTextAnonymizerView, showGptView, showLawsReader }) {\r\n\tconst [state, setState] = useState({ highlights: [] });\r\n\tconst [PdfUrl, setPdfUrl] = useState({ url: \"\" });\r\n\r\n\r\n\tuseEffect(() => {\r\n\t\tasync function fetchData() {\r\n\t\t\taxios.get('http://127.0.0.1:5000/api/v1/json')\r\n\t\t\t\t.then(result_json => {\r\n\t\t\t\t\tconst pdf_name = Object.keys(result_json.data)[0];\r\n\t\t\t\t\tsetPdfUrl({ url: `http://127.0.0.1:5000/api/v1/pdf/${pdf_name}` });\r\n\t\t\t\t\tsetState({ highlights: result_json.data[pdf_name] });\r\n\t\t\t\t})\r\n\t\t\t\t.catch(error => console.log('error: ' + error));\r\n\t\t}\r\n\t\tfetchData();\r\n\t}, []);\r\n\t// not using the State type!\r\n\r\n\t// Jumping to highlight\r\n\r\n\t// This function was defined and changed later! I'm not sure why it was used instead of a ref\r\n\t// let scrollViewerTo = (highlight: any) => { };\r\n\t// https://stackoverflow.com/questions/24841855/how-to-access-component-methods-from-outside-in-reactjs\r\n\r\n\tconst pdfHighlighter = useRef(null);\r\n\tconst getHighlightById = (id) =>\r\n\t\tstate.highlights.find((highlight) => highlight.id === id);\r\n\tconst scrollToHighlightFromHash = () => {\r\n\t\tconst highlight = getHighlightById(parseIdFromHash());\r\n\t\tif (highlight) {\r\n\t\t\tpdfHighlighter.current.scrollTo(highlight);\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\twindow.addEventListener(\"hashchange\", scrollToHighlightFromHash, false);\r\n\r\n\t\treturn () =>\r\n\t\t\twindow.removeEventListener(\"hashchange\", scrollToHighlightFromHash);\r\n\t});\r\n\r\n\tfunction addHighlight(highlight) {\r\n\t\tconst { highlights } = state;\r\n\r\n\t\tsetState({\r\n\t\t\thighlights: [{ ...highlight, id: getNextId() }, ...highlights],\r\n\t\t});\r\n\t}\r\n\r\n\tfunction updateHighlight(\r\n\t\thighlightId,\r\n\t\tposition,\r\n\t\tcontent\r\n\t) {\r\n\t\tsetState({\r\n\t\t\thighlights: state.highlights.map((h) => {\r\n\t\t\t\treturn h.id === highlightId\r\n\t\t\t\t\t? {\r\n\t\t\t\t\t\t...h,\r\n\t\t\t\t\t\tposition: { ...h.position, ...position },\r\n\t\t\t\t\t\tcontent: { ...h.content, ...content },\r\n\t\t\t\t\t}\r\n\t\t\t\t\t: h;\r\n\t\t\t}),\r\n\t\t});\r\n\t}\r\n\r\n\tconst { highlights } = state;\r\n\tconst { url } = PdfUrl;\r\n\r\n\treturn (\r\n\t\t<Fragment>\r\n\t\t\t{showHighlight && (\r\n\t\t\t\t<>\r\n\t\t\t\t\t<GraphFunc />\r\n\t\t\t\t\t{url ? (\r\n\t\t\t\t\t\t<PdfLoader url={url} beforeLoad={<Spinner />}>\r\n\t\t\t\t\t\t\t{(pdfDocument) => (\r\n\t\t\t\t\t\t\t\t<PdfHighlighter\r\n\t\t\t\t\t\t\t\t\tref={pdfHighlighter}\r\n\t\t\t\t\t\t\t\t\tpdfDocument={pdfDocument}\r\n\t\t\t\t\t\t\t\t\tenableAreaSelection={(event) => event.altKey}\r\n\t\t\t\t\t\t\t\t\tonScrollChange={resetHash}\r\n\t\t\t\t\t\t\t\t\tscrollRef={(scrollTo) => { }}\r\n\t\t\t\t\t\t\t\t\tonSelectionFinished={(\r\n\t\t\t\t\t\t\t\t\t\tposition,\r\n\t\t\t\t\t\t\t\t\t\tcontent,\r\n\t\t\t\t\t\t\t\t\t\thideTipAndSelection,\r\n\t\t\t\t\t\t\t\t\t\ttransformSelection\r\n\t\t\t\t\t\t\t\t\t) => (\r\n\t\t\t\t\t\t\t\t\t\t<Tip\r\n\t\t\t\t\t\t\t\t\t\t\tonOpen={transformSelection}\r\n\t\t\t\t\t\t\t\t\t\t\tonConfirm={(comment) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\taddHighlight({ content, position, comment });\r\n\r\n\t\t\t\t\t\t\t\t\t\t\t\thideTipAndSelection();\r\n\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t\t\t\thighlightTransform={(\r\n\t\t\t\t\t\t\t\t\t\thighlight,\r\n\t\t\t\t\t\t\t\t\t\tindex,\r\n\t\t\t\t\t\t\t\t\t\tsetTip,\r\n\t\t\t\t\t\t\t\t\t\thideTip,\r\n\t\t\t\t\t\t\t\t\t\tviewportToScaled,\r\n\t\t\t\t\t\t\t\t\t\tscreenshot,\r\n\t\t\t\t\t\t\t\t\t\tisScrolledTo\r\n\t\t\t\t\t\t\t\t\t) => {\r\n\t\t\t\t\t\t\t\t\t\tconst isTextHighlight = !Boolean(\r\n\t\t\t\t\t\t\t\t\t\t\thighlight.content && highlight.content.image\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t\t\tconst component = isTextHighlight ? (\r\n\t\t\t\t\t\t\t\t\t\t\t<Highlight\r\n\t\t\t\t\t\t\t\t\t\t\t\tisScrolledTo={isScrolledTo}\r\n\t\t\t\t\t\t\t\t\t\t\t\tposition={highlight.position}\r\n\t\t\t\t\t\t\t\t\t\t\t\tcomment={highlight.comment}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t) : (\r\n\t\t\t\t\t\t\t\t\t\t\t<AreaHighlight\r\n\t\t\t\t\t\t\t\t\t\t\t\thighlight={highlight}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonChange={(boundingRect) => {\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tupdateHighlight(\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thighlight.id,\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tboundingRect: viewportToScaled(boundingRect),\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ image: screenshot(boundingRect) }\r\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\t\t\t\treturn (\r\n\t\t\t\t\t\t\t\t\t\t\t<Popup\r\n\t\t\t\t\t\t\t\t\t\t\t\tpopupContent={<HighlightPopup {...highlight} />}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonMouseOver={(popupContent) =>\r\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTip(highlight, (highlight) => popupContent)\r\n\t\t\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t\t\t\tonMouseOut={hideTip}\r\n\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\r\n\t\t\t\t\t\t\t\t\t\t\t\tchildren={component}\r\n\t\t\t\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t\t\t\t}}\r\n\t\t\t\t\t\t\t\t\thighlights={highlights}\r\n\t\t\t\t\t\t\t\t/>\r\n\t\t\t\t\t\t\t)}\r\n\t\t\t\t\t\t</PdfLoader>\r\n\t\t\t\t\t) : (\r\n\t\t\t\t\t\t<Spinner />\r\n\t\t\t\t\t)}\r\n\t\t\t\t</>\r\n\t\t\t)}\r\n\t\t\t{showFileViewer && <PdfViewer />}\r\n\t\t\t{showDashboardView && <DashboardView />}\r\n\t\t\t{showProfileView && <ProfileView />}\r\n\t\t\t{showFeedView && <FeedView />}\r\n\t\t\t{showLawsReader && <LawsViewer />}\r\n\t\t\t{showTextAnonymizerView && <TextAnonymizer />}\r\n\t\t\t{showGptView && <GptView />}\r\n\t\t</Fragment>\r\n\t);\r\n}\r\n\r\nexport default Dashboard;\r\n"]},"metadata":{},"sourceType":"module"}