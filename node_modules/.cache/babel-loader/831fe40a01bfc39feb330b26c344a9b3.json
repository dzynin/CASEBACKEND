{"ast":null,"code":"var _jsxFileName = \"/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/src/Dashboard/PdfViewer.js\";\nimport React, { useContext, useEffect, useState, useRef } from \"react\";\nimport { PdfLoader, PdfHighlighter, Highlight, Popup, AreaHighlight } from \"react-pdf-highlighter\";\nimport { Container } from \"react-bootstrap\";\nimport styled from \"styled-components\";\nimport Spinner from \"../shared/Spinner\";\nimport Tip from \"./Tip\";\nimport processMd from \"./markdown\";\nimport { UserContext } from \"../App\";\nimport { BASE_URL_DEV } from \"../utils\";\nimport PdfViewerSide from \"./PdfViewerSide\";\n\nconst getNextId = () => String(Math.random()).slice(2);\n\nconst parseIdFromHash = () => document.location.hash.slice(\"#pdf-highlight-\".length);\n\nconst resetHash = () => {\n  document.location.hash = \"\";\n};\n\nconst HighlightPopup = ({\n  comment\n}) => comment.text ? /*#__PURE__*/React.createElement(\"div\", {\n  className: \"Highlight__popup\",\n  __self: this,\n  __source: {\n    fileName: _jsxFileName,\n    lineNumber: 30,\n    columnNumber: 3\n  }\n}, comment.emoji, \" \", processMd(comment.text)) : null;\n\nconst Wrapper = styled.div`\n  .Highlight__part {\n    background: ${props => props.highlightColors.default || \"#000000\"};\n    /* border: 3px solid ${props => props.highlightColor || \"#000000\"}; */\n  }\n  .AreaHighlight {\n    border: 3px solid ${props => props.highlightColors.default || \"#000000\"};\n    /* background-color: ${props => props.highlightColor || \"#000000\"}; */\n  }\n  .Highlight__part.OTHER {\n    background: rgb(93, 115, 240);\n  }\n\n  .Highlight__part.LEGALTEST {\n    background: ${props => props.highlightColors.legalTest};\n  }\n\n  .Highlight__part.ISSUE {\n    background: ${props => props.highlightColors.issue};\n  }\n\n  .Highlight__part.CONCLUSION {\n    background: ${props => props.highlightColors.conclusion};\n  }\n`;\n\nfunction PdfViewer() {\n  const {\n    state,\n    dispatch\n  } = useContext(UserContext);\n  const [currFile, setCurrFile] = useState();\n  const [highlights, setHighlights] = useState([]);\n  useEffect(() => {\n    // console.log(highlights);\n    if (highlights && highlights.length > 0) {\n      dispatch({\n        type: \"SET_FILE_HIGHLIGHTS\",\n        payload: {\n          highlights,\n          name: state.currentFile && state.currentFile.name\n        }\n      });\n    }\n  }, [highlights]);\n  useEffect(() => {\n    setCurrFile(null); // console.log(state);\n\n    if (state.currentFile && state.currentFile.url) {\n      setTimeout(() => setCurrFile(`${BASE_URL_DEV}/${state.currentFile.url}`), 100);\n    } else {\n      let reader = new FileReader();\n      let file = state.currentFile;\n\n      reader.onload = () => {\n        // console.log(file.name);\n        setCurrFile(reader.result);\n      };\n\n      if (file) reader.readAsDataURL(file);\n    }\n  }, [state.currentFile]);\n  useEffect(() => {\n    if (state.currentFile) {\n      // console.log(state);\n      let highlightUpdated = false;\n      state.fileHighlights.forEach(item => {\n        if (item.name === state.currentFile.name) {\n          setHighlights(item.highlights);\n          highlightUpdated = true;\n        }\n      });\n      if (!highlightUpdated) setHighlights([]);\n    }\n  }, [state.currentFile, state.fileHighlights]);\n  const pdfHighlighter = useRef(null);\n\n  const getHighlightById = id => highlights.find(highlight => highlight.id === id);\n\n  const scrollToHighlightFromHash = () => {\n    const highlight = getHighlightById(parseIdFromHash()); // console.log(highlight);\n\n    if (highlight) {\n      pdfHighlighter.current.scrollTo(highlight);\n    }\n  };\n\n  useEffect(() => {\n    window.addEventListener(\"hashchange\", scrollToHighlightFromHash, false);\n    return () => window.removeEventListener(\"hashchange\", scrollToHighlightFromHash);\n  });\n\n  function addHighlight(highlight) {\n    // console.log(highlight);\n    setHighlights([{ ...highlight,\n      id: getNextId()\n    }, ...highlights]);\n  }\n\n  function updateHighlight(highlightId, position, content) {\n    setHighlights(highlights.map(h => h.id === highlightId ? { ...h,\n      position: { ...h.position,\n        ...position\n      },\n      content: { ...h.content,\n        ...content\n      }\n    } : h));\n  }\n\n  return /*#__PURE__*/React.createElement(Wrapper, {\n    highlightColors: state.highlightColors,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 152,\n      columnNumber: 3\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"d-flex\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 153,\n      columnNumber: 4\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    style: {\n      minHeight: \"calc(100vh - 70px)\",\n      color: \"#000000\",\n      width: \"80%\"\n    },\n    className: \"pdf-viewer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 154,\n      columnNumber: 5\n    }\n  }, currFile ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(PdfLoader, {\n    className: \"my-pdf-viewer\",\n    url: currFile,\n    beforeLoad: /*#__PURE__*/React.createElement(Spinner, {\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 167,\n        columnNumber: 21\n      }\n    }),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 164,\n      columnNumber: 8\n    }\n  }, pdfDocument => {\n    return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(PdfHighlighter, {\n      ref: pdfHighlighter,\n      pdfDocument: pdfDocument,\n      enableAreaSelection: event => event.altKey,\n      onScrollChange: resetHash,\n      scrollRef: scrollTo => {},\n      onSelectionFinished: (position, content, hideTipAndSelection, transformSelection) => /*#__PURE__*/React.createElement(Tip, {\n        onOpen: transformSelection,\n        onConfirm: comment => {\n          addHighlight({\n            content,\n            position,\n            comment\n          });\n          hideTipAndSelection();\n        },\n        __self: this,\n        __source: {\n          fileName: _jsxFileName,\n          lineNumber: 184,\n          columnNumber: 14\n        }\n      }),\n      highlightTransform: (highlight, index, setTip, hideTip, viewportToScaled, screenshot, isScrolledTo) => {\n        const isTextHighlight = !Boolean(highlight.content && highlight.content.image);\n        const component = isTextHighlight ? /*#__PURE__*/React.createElement(Highlight, {\n          isScrolledTo: isScrolledTo,\n          position: highlight.position,\n          comment: highlight.comment,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 207,\n            columnNumber: 15\n          }\n        }) : /*#__PURE__*/React.createElement(AreaHighlight, {\n          highlight: highlight,\n          onChange: boundingRect => {\n            updateHighlight(highlight.id, {\n              boundingRect: viewportToScaled(boundingRect)\n            }, {\n              image: screenshot(boundingRect)\n            });\n          },\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 213,\n            columnNumber: 15\n          }\n        });\n        return /*#__PURE__*/React.createElement(Popup, {\n          popupContent: /*#__PURE__*/React.createElement(HighlightPopup, Object.assign({}, highlight, {\n            __self: this,\n            __source: {\n              fileName: _jsxFileName,\n              lineNumber: 229,\n              columnNumber: 30\n            }\n          })),\n          onMouseOver: popupContent => setTip(highlight, highlight => popupContent),\n          onMouseOut: hideTip,\n          key: index,\n          children: component,\n          __self: this,\n          __source: {\n            fileName: _jsxFileName,\n            lineNumber: 228,\n            columnNumber: 15\n          }\n        });\n      },\n      highlights: highlights,\n      __self: this,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 172,\n        columnNumber: 12\n      }\n    }));\n  })) : state.files && state.files.length === 0 ? /*#__PURE__*/React.createElement(Container, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 247,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"div\", {\n    className: \"h3 text-center mt-5\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 248,\n      columnNumber: 8\n    }\n  }, \"No File Selected!!\")) : /*#__PURE__*/React.createElement(Spinner, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 251,\n      columnNumber: 7\n    }\n  })), /*#__PURE__*/React.createElement(PdfViewerSide, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 254,\n      columnNumber: 5\n    }\n  })));\n}\n\nexport default PdfViewer;","map":{"version":3,"sources":["/home/taymur/Documents/legal2/DATA/Highlight/newmerged/CASEFRONTt/src/Dashboard/PdfViewer.js"],"names":["React","useContext","useEffect","useState","useRef","PdfLoader","PdfHighlighter","Highlight","Popup","AreaHighlight","Container","styled","Spinner","Tip","processMd","UserContext","BASE_URL_DEV","PdfViewerSide","getNextId","String","Math","random","slice","parseIdFromHash","document","location","hash","length","resetHash","HighlightPopup","comment","text","emoji","Wrapper","div","props","highlightColors","default","highlightColor","legalTest","issue","conclusion","PdfViewer","state","dispatch","currFile","setCurrFile","highlights","setHighlights","type","payload","name","currentFile","url","setTimeout","reader","FileReader","file","onload","result","readAsDataURL","highlightUpdated","fileHighlights","forEach","item","pdfHighlighter","getHighlightById","id","find","highlight","scrollToHighlightFromHash","current","scrollTo","window","addEventListener","removeEventListener","addHighlight","updateHighlight","highlightId","position","content","map","h","minHeight","color","width","pdfDocument","event","altKey","hideTipAndSelection","transformSelection","index","setTip","hideTip","viewportToScaled","screenshot","isScrolledTo","isTextHighlight","Boolean","image","component","boundingRect","popupContent","files"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useState, useRef } from \"react\";\nimport {\n\tPdfLoader,\n\tPdfHighlighter,\n\tHighlight,\n\tPopup,\n\tAreaHighlight,\n} from \"react-pdf-highlighter\";\n\nimport { Container } from \"react-bootstrap\";\nimport styled from \"styled-components\";\nimport Spinner from \"../shared/Spinner\";\nimport Tip from \"./Tip\";\nimport processMd from \"./markdown\";\nimport { UserContext } from \"../App\";\nimport { BASE_URL_DEV } from \"../utils\";\nimport PdfViewerSide from \"./PdfViewerSide\";\n\nconst getNextId = () => String(Math.random()).slice(2);\n\nconst parseIdFromHash = () =>\n\tdocument.location.hash.slice(\"#pdf-highlight-\".length);\n\nconst resetHash = () => {\n\tdocument.location.hash = \"\";\n};\n\nconst HighlightPopup = ({ comment }) =>\n\tcomment.text ? (\n\t\t<div className=\"Highlight__popup\">\n\t\t\t{comment.emoji} {processMd(comment.text)}\n\t\t</div>\n\t) : null;\n\nconst Wrapper = styled.div`\n  .Highlight__part {\n    background: ${props => props.highlightColors.default || \"#000000\"};\n    /* border: 3px solid ${props => props.highlightColor || \"#000000\"}; */\n  }\n  .AreaHighlight {\n    border: 3px solid ${props => props.highlightColors.default || \"#000000\"};\n    /* background-color: ${props => props.highlightColor || \"#000000\"}; */\n  }\n  .Highlight__part.OTHER {\n    background: rgb(93, 115, 240);\n  }\n\n  .Highlight__part.LEGALTEST {\n    background: ${props => props.highlightColors.legalTest};\n  }\n\n  .Highlight__part.ISSUE {\n    background: ${props => props.highlightColors.issue};\n  }\n\n  .Highlight__part.CONCLUSION {\n    background: ${props => props.highlightColors.conclusion};\n  }\n`\n\nfunction PdfViewer() {\n\tconst { state, dispatch } = useContext(UserContext);\n\tconst [currFile, setCurrFile] = useState();\n\tconst [highlights, setHighlights] = useState([]);\n\n\tuseEffect(() => {\n\t\t// console.log(highlights);\n\t\tif (highlights && highlights.length > 0) {\n\t\t\tdispatch({\n\t\t\t\ttype: \"SET_FILE_HIGHLIGHTS\",\n\t\t\t\tpayload: {\n\t\t\t\t\thighlights,\n\t\t\t\t\tname: state.currentFile && state.currentFile.name,\n\t\t\t\t},\n\t\t\t});\n\t\t}\n\t}, [highlights]);\n\n\tuseEffect(() => {\n\t\tsetCurrFile(null);\n\t\t// console.log(state);\n\t\tif (state.currentFile && state.currentFile.url) {\n\t\t\t\tsetTimeout(\n\t\t\t\t\t() => setCurrFile(`${BASE_URL_DEV}/${state.currentFile.url}`),\n\t\t\t\t\t100\n\t\t\t\t);\n\t\t} else {\n\t\t\tlet reader = new FileReader();\n\t\t\tlet file = state.currentFile;\n\t\t\treader.onload = () => {\n\t\t\t\t// console.log(file.name);\n\t\t\t\tsetCurrFile(reader.result);\n\t\t\t};\n\n\t\t\tif (file) reader.readAsDataURL(file);\n\t\t}\n\t}, [state.currentFile]);\n\n\t\n\tuseEffect(() => {\n\t\tif (state.currentFile) {\n\t\t\t// console.log(state);\n\t\t\tlet highlightUpdated = false;\n\t\t\tstate.fileHighlights.forEach((item) => {\n\t\t\t\tif (item.name === state.currentFile.name) {\n\t\t\t\t\tsetHighlights(item.highlights);\n\t\t\t\t\thighlightUpdated = true;\n\t\t\t\t}\n\t\t\t});\n\t\t\tif (!highlightUpdated) setHighlights([]);\n\t\t}\n\t}, [state.currentFile, state.fileHighlights]);\n\n\tconst pdfHighlighter = useRef(null);\n\tconst getHighlightById = (id) =>\n\t\thighlights.find((highlight) => highlight.id === id);\n\tconst scrollToHighlightFromHash = () => {\n\t\tconst highlight = getHighlightById(parseIdFromHash());\n\t\t// console.log(highlight);\n\t\tif (highlight) {\n\t\t\tpdfHighlighter.current.scrollTo(highlight);\n\t\t}\n\t};\n\n\tuseEffect(() => {\n\t\twindow.addEventListener(\"hashchange\", scrollToHighlightFromHash, false);\n\n\t\treturn () =>\n\t\t\twindow.removeEventListener(\"hashchange\", scrollToHighlightFromHash);\n\t});\n\n\tfunction addHighlight(highlight) {\n\t\t// console.log(highlight);\n\t\tsetHighlights([{ ...highlight, id: getNextId() }, ...highlights]);\n\t}\n\n\tfunction updateHighlight(highlightId, position, content) {\n\t\tsetHighlights(\n\t\t\thighlights.map((h) =>\n\t\t\t\th.id === highlightId\n\t\t\t\t\t? {\n\t\t\t\t\t\t...h,\n\t\t\t\t\t\tposition: { ...h.position, ...position },\n\t\t\t\t\t\tcontent: { ...h.content, ...content },\n\t\t\t\t\t}\n\t\t\t\t\t: h\n\t\t\t)\n\t\t);\n\t}\n\n\treturn (\n\t\t<Wrapper highlightColors={state.highlightColors}>\n\t\t\t<div className=\"d-flex\">\n\t\t\t\t<div\n\t\t\t\t\tstyle={{\n\t\t\t\t\t\tminHeight: \"calc(100vh - 70px)\",\n\t\t\t\t\t\tcolor: \"#000000\",\n\t\t\t\t\t\twidth: \"80%\",\n\t\t\t\t\t}}\n\t\t\t\t\tclassName=\"pdf-viewer\"\n\t\t\t\t>\n\t\t\t\t\t{currFile ? (\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t<PdfLoader\n\t\t\t\t\t\t\t\tclassName=\"my-pdf-viewer\"\n\t\t\t\t\t\t\t\turl={currFile}\n\t\t\t\t\t\t\t\tbeforeLoad={<Spinner />}\n\t\t\t\t\t\t\t>\n\t\t\t\t\t\t\t\t{(pdfDocument) => {\n\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t\t\t\t\t<PdfHighlighter\n\t\t\t\t\t\t\t\t\t\t\t\tref={pdfHighlighter}\n\t\t\t\t\t\t\t\t\t\t\t\tpdfDocument={pdfDocument}\n\t\t\t\t\t\t\t\t\t\t\t\tenableAreaSelection={(event) => event.altKey}\n\t\t\t\t\t\t\t\t\t\t\t\tonScrollChange={resetHash}\n\t\t\t\t\t\t\t\t\t\t\t\tscrollRef={(scrollTo) => { }}\n\t\t\t\t\t\t\t\t\t\t\t\tonSelectionFinished={(\n\t\t\t\t\t\t\t\t\t\t\t\t\tposition,\n\t\t\t\t\t\t\t\t\t\t\t\t\tcontent,\n\t\t\t\t\t\t\t\t\t\t\t\t\thideTipAndSelection,\n\t\t\t\t\t\t\t\t\t\t\t\t\ttransformSelection\n\t\t\t\t\t\t\t\t\t\t\t\t) => (\n\t\t\t\t\t\t\t\t\t\t\t\t\t<Tip\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonOpen={transformSelection}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\tonConfirm={(comment) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\taddHighlight({ content, position, comment });\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thideTipAndSelection();\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t)}\n\t\t\t\t\t\t\t\t\t\t\t\thighlightTransform={(\n\t\t\t\t\t\t\t\t\t\t\t\t\thighlight,\n\t\t\t\t\t\t\t\t\t\t\t\t\tindex,\n\t\t\t\t\t\t\t\t\t\t\t\t\tsetTip,\n\t\t\t\t\t\t\t\t\t\t\t\t\thideTip,\n\t\t\t\t\t\t\t\t\t\t\t\t\tviewportToScaled,\n\t\t\t\t\t\t\t\t\t\t\t\t\tscreenshot,\n\t\t\t\t\t\t\t\t\t\t\t\t\tisScrolledTo\n\t\t\t\t\t\t\t\t\t\t\t\t) => {\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst isTextHighlight = !Boolean(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\thighlight.content && highlight.content.image\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\tconst component = isTextHighlight ? (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Highlight\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tisScrolledTo={isScrolledTo}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tposition={highlight.position}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tcomment={highlight.comment}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t) : (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<AreaHighlight\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thighlight={highlight}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonChange={(boundingRect) => {\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tupdateHighlight(\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\thighlight.id,\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tboundingRect: viewportToScaled(boundingRect),\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t},\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t{ image: screenshot(boundingRect) }\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\n\t\t\t\t\t\t\t\t\t\t\t\t\treturn (\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t<Popup\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tpopupContent={<HighlightPopup {...highlight} />}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonMouseOver={(popupContent) =>\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tsetTip(highlight, (highlight) => popupContent)\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tonMouseOut={hideTip}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tkey={index}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\tchildren={component}\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t\t\t\t);\n\t\t\t\t\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t\t\t\t\t\thighlights={highlights}\n\t\t\t\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t\t\t\t</>\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t}}\n\t\t\t\t\t\t\t</PdfLoader>\n\t\t\t\t\t\t</>\n\t\t\t\t\t) : state.files && state.files.length === 0 ? (\n\t\t\t\t\t\t<Container>\n\t\t\t\t\t\t\t<div className=\"h3 text-center mt-5\">No File Selected!!</div>\n\t\t\t\t\t\t</Container>\n\t\t\t\t\t) : (\n\t\t\t\t\t\t<Spinner />\n\t\t\t\t\t)}\n\t\t\t\t</div>\n\t\t\t\t<PdfViewerSide />\n\t\t\t</div>\n\t\t</Wrapper>\n\t);\n}\n\nexport default PdfViewer;\n"]},"metadata":{},"sourceType":"module"}